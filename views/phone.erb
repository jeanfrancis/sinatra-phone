    <div class="container phonebox">
      <form action="#phone" method="get" accept-charset="utf-8" class="form-signin form-horizontal">
        <h2 class="form-signin-heading">Make A Call</h2>
        <h4 id='fromuser'></h4>
        <label for="Number to Dial">Number to Dial</label>
          <input type="text" name="number_to_dial" value="1-800-444-4444" id="number_to_dial" class="input-block-level" placeholder="1-800-444-4444" autofocus>
        <button class="btn btn-large btn-primary input-block-level" type="submit" value="registering..." id="call" disabled="true"  class="btn btn-large btn-primary">
          <i class='icon-phone'></i> <span id="status">Registering...</span>
        </button>
            
      </form>
      <pre id='debuglog'>
        <ol id='debuglist'></ol>
      </pre>
          
    </div> <!-- /container -->
    
<script type="text/javascript" charset="utf-8">
  $(document).ready(function(){

    var accessToken = localStorage['access_token'];
    var selfNumber = localStorage.phone_number;
    var att;
    var call;
    
    att = $.att({
      version: '<%= @version || 'a3' %>',
      apiKey: accessToken,
      onReady: function() {
        $("#call").attr("disabled", false);
        console.log("att on ready...");
        $('#debuglist').append('<li>registered: <a href=sip:'+ att.sessionId+'>sip:'+ att.sessionId+'</a></li>');
        $('#status').html('ready');
      },
      onUnready: function() {
        console.log("att disconnected...");
      },
      
      // Phone API Configuration
      phone: {
        // Event Handlers
        onIncomingCall: function(event) {
          call = event.call;
          console.log("Incoming Call: " + call.id);
          call.bind({ 
            onHangup: function(event) { 
              console.log("Hangup Call...");
              toIdleState();
            }, 
            onError: function(event) { 
              alert("Incoming call error:" + event); 
            }
          });
          // Prepare to answer the call
          toAnswerState();
        },
        onError: function(event) {
          console.log("Phone error: " + e.reason);
        }
      }  //phone
    }); //att
    
    
    
    
    // register some call ui event handlers for dialing out.
    $("#call").click(function(event) {
      event.preventDefault();
      $("#status").html("Dialing");
      console.log($(this));
      $(this).click(function(){att.phone.hangup()});
      att.phone.dial($("#number_to_dial").val(), {
        onRing: function() {
          $("#status").html("Ringing");
        },
        onAnswer: function() {
          $("#status").html("Answered");
          $(".phonebox").addClass('active');
          cb.setState('active');
          $("#call").click(function() {att.phone.hangup()} )
        },
        onHangup: function() {
          $("#call").attr("disabled", false).val("Call");
          $(".phonebox").removeClass('active');
          $("#status").html("ready");
        }
      });
    });
    
  
  }); //ready
  </script>





  
    
  <script type="text/javascript" charset="utf-8">
    
    //     onReady: function() {
    //  
    //       $("#status").html( 'ready' );
    //       $('#debuglist').append('<li>registered: <a href=sip:'+ att.sessionId+'>sip:'+ phono.sessionId+'</a></li>');
    //       binderURL = 'http://binder.api.tfoundry.com/session/'+localStorage.phone_number+'/'+phono.sessionId;
    //       $.ajax({
    //               url:  binderURL,
    //               // data: {url: 'http://gw.att.io:8080/http-bind/session/'+your_number+'/'+phono.sessionId},
    //               type: "POST"
    //               }).done(function(data, status) {
    //                 console.log("Registerd " + binderURL);
    //                 $('#debuglist').append("<li>"+status+"</li>");
    //                 $('#debuglist').append("<li>"+data+"</li>");
    //                 $('#debuglist').append('<li>bound session to: '+ localStorage.phone_number +"</li>");
    //                 })
    //             }
    //   
    //     })
    // 
    //   $('.result').ajaxError(function(event, request, settings){
    //     $(this).append("<li>Error requesting page " + settings.url + "</li>");
    //   });
    // 
    // 
    // })
  </script>
  


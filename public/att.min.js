(function(){function n(){this.callbacks={}}function o(o){var t=this,e=o||{};return-1===["a1","a2","a3"].indexOf(e.version)&&(e.version="a1"),e.dependencyBaseUrl||(e.dependencyBaseUrl="//js.att.io"),e.version=r.getQueryParam("version")||e.version,n.call(this),"a1"===e.version||"a2"===e.version?$.getScript(e.dependencyBaseUrl+"/js/att."+e.version+".js",function(){t.create(e)}):$.getScript(e.dependencyBaseUrl+"/js/phono.06.js",function(){e.token=e.apiKey,e.apiKey="7826110523f1241fcfd001859a67128d",e.connectionUrl="http://gw.att.io:8080/http-bind",t.create(e)}),t}function t(o,t){var e=this;return this._att=o,this._call=t,this.id=t.id,n.call(this),this.on("*",function(n){e._att.emit(n,e)}),this._call.bind({onRing:function(){e.emit("ring")},onAnswer:function(){e.emit("callBegin")},onHangup:function(){e.emit("callEnd")},onError:function(){e.emit("error")}}),this}var e=this,i={},r=i.util={_uuidCounter:0,uuid:function(){return Math.random().toString(16).substring(2)+(r._uuidCounter++).toString(16)},slice:Array.prototype.slice,isFunc:function(n){return"[object Function]"==Object.prototype.toString.call(n)},extend:function(n){return this.slice.call(arguments,1).forEach(function(o){if(o)for(var t in o)n[t]=o[t]}),n},each:function(n,o){if(n)if(n instanceof Array)n.forEach(o);else for(var t in n)o(t,n[t])},getQueryParam:function(n){var o=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),t="[\\?&]"+o+"=([^&#]*)",e=RegExp(t),i=e.exec(window.location.search);return i?decodeURIComponent(i[1].replace(/\+/g," ")):void 0},h2sSupport:function(){return"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/536.4 (KHTML, like Gecko) Chrome/19.0.1077.0 Safari/536.4"==window.navigator.userAgent||"Mozilla/5.0 (iPhone; CPU iPhone OS 6_0_1 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Mobile/10A523"==window.navigator.userAgent||window.webkitPeerConnection00&&-1!==window.navigator.userAgent.indexOf("Chrome/24")}},a={};a.stringify=function(n){var o,t=a.parse(n),e=t.length,i="1"===t.charAt(0),r=t.split("");return e>(i?11:10)?t:!i&&4>e?t:(i&&r.splice(0,1),i?e>1&&(o=4-e,o=o>0?o:0,r.splice(0,0," ("),r.splice(4,0,Array(o+1).join(" ")+") "),e>7&&r.splice(8,0,"-")):e>7?(r.splice(0,0,"("),r.splice(4,0,") "),r.splice(8,0,"-")):e>3&&r.splice(3,0,"-"),(i?"1":"")+r.join(""))},a.parse=function(n){return(n+"").toUpperCase().replace(/[A-Z]/g,function(n){return 0|(n.charCodeAt(0)-65)/3+2-("SVYZ".indexOf(n)>-1)}).replace(/\D/g,"")},a.getCallable=function(n,o){var t=o||"us",e=a.parse(n);return 10!==e.length?"us"==t&&11===e.length&&"1"===e.charAt(0)?e:!1:"us"==t?"1"+e:void 0},i.phoneNumber=a,n.prototype.on=function(n){var o=3===arguments.length,t=o?arguments[1]:void 0,e=o?arguments[2]:arguments[1];return e._groupName=t,(this.callbacks[n]=this.callbacks[n]||[]).push(e),this},n.prototype.once=function(n,o){function t(){e.off(n,t),o.apply(this,arguments)}var e=this;return this.on(n,t),this},n.prototype.releaseGroup=function(n){var o,t,e,i;for(o in this.callbacks)for(i=this.callbacks[o],t=0,e=i.length;e>t;t++)i[t]._groupName===n&&(i.splice(t,1),t--,e--);return this},n.prototype.off=function(n,o){var t,e=this.callbacks[n];return e?1===arguments.length?(delete this.callbacks[n],this):(t=e.indexOf(o),e.splice(t,1),this):this},n.prototype.emit=function(n){var o,t,e=[].slice.call(arguments,1),i=this.callbacks[n],r=this.getWildcardCallbacks(n);if(i)for(o=0,t=i.length;t>o;++o)i[o].apply(this,e);if(r)for(o=0,t=r.length;t>o;++o)r[o].apply(this,[n].concat(e));return this},n.prototype.getWildcardCallbacks=function(n){var o,t,e=[];for(o in this.callbacks)t=o.split("*"),("*"===o||2===t.length&&n.slice(0,t[1].length)===t[1])&&(e=e.concat(this.callbacks[o]));return e},o.prototype=new n,o.prototype.create=function(n){var o=this,t=n||{},e=this.config={apiKey:"",user:r.uuid(),jid:"",log:!0,ringTone:"",ringbackTone:""},i={onReady:"ready",onUnReady:"unready",onError:"error",onCallBegin:"callBegin",onCallEnd:"callEnd",onOutgoingCall:"outgoingCall",onCalling:"calling"},a={onError:"error",onCallBegin:"callBegin",onCallEnd:"callEnd"},l=function(){return r.isFunc(n.onIncomingCall)?n.onIncomingCall:n.phone&&r.isFunc(n.phone.onIncomingCall)?n.phone.onIncomingCall:function(){}}();r.extend(this.config,t),this.config.incomingCallHandler=l,delete this.config.onIncomingCall,this.config.phone&&delete this.config.phone.onIncomingCall,this.phone=this,this.on("incomingCall",l),r.each(i,function(n,t){r.isFunc(o.config[n])&&(o.on(t,o.config[n]),o.config[n]=function(n){o.emit(t,n)})}),t.phone&&r.each(a,function(n,t){r.isFunc(o.config.phone[n])&&(o.on(t,o.config.phone[n]),o.config.phone[n]=function(n){o.emit(t,n)})}),this.config.log&&this.on("*",function(n,o){console.log("att.js event:",n,o)}),"a1"===this.config.version?r.h2sSupport()?(console.log("setting up wcgphono"),console.log(e.onReady),this.phono=$.wcgphono(r.extend(e,{phone:{onIncomingCall:o._normalizeNonPhonoCallHandlers.bind(o)},onReady:function(){o.emit("ready")}}))):alert("Please use the special Ericsson build of Chromium. It can be downloaded from: http://js.att.io/browsers"):"a2"===this.config.version?r.h2sSupport()?(console.log("setting up h2sphono"),this.phono=$.h2sphono(r.extend(e,{phone:{onIncomingCall:o._normalizeNonPhonoCallHandlers.bind(o)},onReady:function(){o.emit("ready")}}))):alert("Please use the special Ericsson build of Chromium. It can be downloaded from: http://js.att.io/browsers"):(console.log("setting up phono"),this.phono=$.phono(r.extend(e,{phone:{onIncomingCall:o._normalizeNonPhonoCallHandlers.bind(o)},onReady:function(){o.sessionId=this.sessionId,o.getMyNumber(function(n){o.bindNumberToPhonoSession(n,o.sessionId,function(){o.emit("ready")})})}})))},o.prototype.getMyNumber=function(n){var o=this;$.getJSON("https://auth.tfoundry.com/me.json?access_token="+this.config.token,function(t){var e;t?(e=t.conference_phone_number||t.phone_number,o.config.myNumber=e,n(e)):n("")})},o.prototype.bindNumberToPhonoSession=function(n,o,t){$.ajax({url:"https://api.foundry.att.com/a3/webrtc/bind/"+n+"/"+o+"?access_token="+this.config.token,type:"POST",success:function(){t()}})},o.prototype.disconnect=function(){this.phono.disconnect(),this.phono=null},o.prototype.connected=function(){return!!this.phono},o.prototype._normalizeNonPhonoCallHandlers=function(n){var o,e,r=n.call;r&&(o=new t(this,r),e=o.initiator||o._call.recipient||"",e=e.replace("tel:","").replace("sip:",""),o.call=o,this.emit("incomingCall",o,i.phoneNumber.parse(e)))},o.prototype.dial=function(n,o){var e,r,a=this,l=i.phoneNumber.getCallable(n);return this.emit("calling",n),e="a3"===this.config.version?this.phono.phone.dial("sip:"+l+"@12.208.176.26",{callerId:a.config.myNumber+"@phono06.tfoundry.com"}):this.phono.phone.dial(l,{}),r=new t(this,e),r.bind(o),this.emit("outgoingCall",r),r},t.prototype=new n,t.prototype.bind=function(n){var o=this,t={onRing:"ring",onAnswer:"callBegin",onHangup:"callEnd",onError:"error"},e=n||{};this._att,r.each(t,function(n,t){r.isFunc(e[n])&&o.on(t,e[n])})},t.prototype.answer=function(){return this._call.answer()},t.prototype.hangup=function(){return this._call.hangup()},t.prototype.digit=function(n){return this._call.digit(n)},t.prototype.pushToTalk=function(n){return this._call.pushToTalk(n)},t.prototype.talking=function(n){return this._call.talking(n)},t.prototype.mute=function(n){return this._call.mute(n)},t.prototype.hold=function(n){return this._call.hold(n)},t.prototype.volume=function(n){return this._call.volume(n)},t.prototype.gain=function(n){return this._call.gain(n)},t.prototype.__defineGetter__("initiator",function(){return this._call.initiator}),t.prototype.transferto=function(n){var o=i.phoneNumber.getCallable(n);this._call.transferto(o)},i.Phone=o,e.jQuery&&(e.jQuery.att=function(n){return new o(n)}),"undefined"!=typeof exports?module.exports=i:(e.ATT||(e.ATT={}),r.extend(e.ATT,i))}).call(this);
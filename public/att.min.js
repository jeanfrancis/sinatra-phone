function FABridge(e,t){return this.target=e,this.remoteTypeCache={},this.remoteInstanceCache={},this.remoteFunctionCache={},this.localFunctionCache={},this.bridgeID=FABridge.nextBridgeID++,this.name=t,this.nextLocalFuncID=0,FABridge.instances[this.name]=this,FABridge.idMap[this.bridgeID]=this,this}function instanceFactory(e){return this.fb_instance_id=e,this}function FABridge__invokeJSFunction(e){var t=e[0],n=e.concat();n.shift();var o=FABridge.extractBridgeFromID(t);return o.invokeLocalFunction(t,n)}function FABridge__bridgeInitialized(e){var t="bridgeName="+e;if(/Explorer/.test(navigator.appName)||/Opera/.test(navigator.appName)||/Netscape/.test(navigator.appName)||/Konqueror|Safari|KHTML/.test(navigator.appVersion)){var n=document.getElementsByTagName("object");if(1==n.length)FABridge.attachBridge(n[0],e);else for(var o=0;n.length>o;o++){for(var i=n[o],r=i.childNodes,s=!1,a=0;r.length>a;a++){var c=r[a];if(1==c.nodeType&&"param"==c.tagName.toLowerCase()&&"flashvars"==c.name.toLowerCase()&&c.value.indexOf(t)>=0){FABridge.attachBridge(i,e),s=!0;break}}if(s)break}}else{var n=document.getElementsByTagName("embed");if(1==n.length)FABridge.attachBridge(n[0],e);else for(var o=0;n.length>o;o++){var i=n[o],l=i.attributes.getNamedItem("flashVars").nodeValue;l.indexOf(t)>=0&&FABridge.attachBridge(i,e)}}return!0}(function(e){function t(t,n,o,i){var s=i;s||(s=t.createCall(n,{audio:!0,video:!0})),o||(o={}),e.extend(this,o),this.state="initial";var a=this;s.onstatechange=function(e){console.log("New state: "+e.state),e.state==Call.State.RINGING&&a.onRing&&(a.onRing(e),a.state="ringing"),e.state==Call.State.ONGOING&&a.onAnswer&&(a.onAnswer(e),a.state="connected"),e.state==Call.State.ENDED&&a.onHangup&&(console.log(a.onHangup),a.onHangup(e),a.state="disconnected"),e.state==Call.State.ERROR&&a.onError&&(a.onError(e),a.state="disconnected")},s.onaddstream=function(e){a.onAddStream&&a.onAddStream(e)},this.__defineGetter__("localStreams",function(){return s.localStreams}),this.__defineGetter__("remoteStreams",function(){return s.localStreams}),n||this.__defineGetter__("from",function(){return s.recipient}),this.id=r(),this.call=s,i||s.ring()}function n(t,n){this._ms=t,n||(n={}),this._config=n,e.extend(this,n),this.onError||(this.onError=function(){console.warn("Error occurred with no handler there")})}function o(t){t||(t={}),this._config=t,e.extend(this,t),this.user||(this.user=r()),this.server||(this.server="http://api.tfoundry.com/a1/H2SConference");var o=this,i=t.video?"audio,video":"audio";this._ms=new MediaServices(this.server,this.user,t.apiKey,i),this._ms.onready=function(){setTimeout(function(){o._ms.unregister()},500)},this._ms.onclose=function(){setTimeout(function(){o._ms=new MediaServices(o.server,o.user,t.apiKey,i),o._ms.turnConfig="NONE",o._ms.onclose=function(e){o.onUnready&&o.onUnready(e)},o._ms.onerror=function(e){o.onerror(e)},o._ms.oninvite=function(e){o.oninvite(e)},o._ms.onready=function(e){o.sessionId=o._ms.username,o.onReady&&o.onReady(e)},o.phone=new n(o._ms,t.phone)},500)}}var i=0,r=function(){return Math.random().toString(16).substring(2)+(i++).toString(16)};t.prototype.answer=function(){this.call.answer()},t.prototype.hangup=function(){this.call.end()},t.prototype.digit=function(){},t.prototype.pushToTalk=function(){},t.prototype.talking=function(){},t.prototype.mute=function(){},t.prototype.hold=function(){},t.prototype.volume=function(){},t.prototype.gain=function(){},n.prototype.dial=function(e,n){return n.video||(n.video=this.video),this.call=new t(this._ms,e,n),this.call},n.prototype.tones=function(){},n.prototype.headset=function(){},n.prototype.wideband=function(){},n.prototype.ringTone=function(){},n.prototype.ringbackTone=function(){},o.prototype.onerror=function(e){this.phone._call&&this.phone._call.onerror?this.phone._call.onerror(e):this.phone.onerror(e)},o.prototype.oninvite=function(e){e.call&&this.phone.onIncomingCall&&this.phone.onIncomingCall({call:new t(this._ms,null,null,e.call)})},e.extend({phono:function(e){return new o(e)}})})(jQuery),"undefined"==typeof Logs&&(Logs=!0),function(){function e(e,t){var n=e.mediaType.replace(/(\s)/g,"").split(","),o={};if(t===void 0||0==Object.keys(t).length)return-1!=n.indexOf("audio")&&(o.audio=!0),-1!=n.indexOf("video")&&(o.video=!0),o;if("object"!=typeof t||""==t)throw Error("Invalid media types");return t.audio&&1==t.audio&&-1!=n.indexOf("audio")&&(o.audio=!0),t.video&&1==t.video&&-1!=n.indexOf("video")&&(o.video=!0),o}function t(e){for(var t={},n=0;;n++)try{var o=e[n].m;-1!=o.search("audio")?t.audio=!0:-1!=o.search("video")&&(t.video=!0)}catch(i){break}return t}function n(e){return 0==e.indexOf("tel:+")?e.substring(5,e.length):0==e.indexOf("sip:")?e.substring(4,e.indexOf("@")):""}function o(e){var t=null;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}return e&&(t.o=t.open,t.open=function(t,n,o){this.o(t,n+"?access_token="+e,o)}),t}function r(i){var r=2e3,s=this,l=i;this.pollChannel=function(){var h=l._gwUrl+v;u.log("Querying channel...");var p=new o(i._accessToken);p.open("GET",h,!0),p.setRequestHeader("Accept","application/json, text/html"),p.send(null),p.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){u.log("Get channel successful: "+this.status+" "+this.statusText+" "+this.responseText);for(var o=JSON.parse(this.responseText),i=0;;i++){var h=null;try{h=o.events.list[i].eventObject}catch(p){break}var d=h["@type"],f=h.state,g=(h.reason,h.from);if("media-conference"==d){var v=h.sdp,_=h.resourceURL,S=_.split("/");"session-open"==f.toLowerCase()||"session-terminated"==f.toLowerCase()||"invitation-received"==f.toLowerCase()||"add-failed"==f.toLowerCase()||"remove-failed"==f.toLowerCase()||"mod-received"==f.toLowerCase()||u.log("Unhandled media conference channel event: "+d+" "+f)}else if("audiovideo"==d){var v=h.sdp,_=h.resourceURL,S=_.split("/");if("session-open"==f.toLowerCase()||"session-modified"==f.toLowerCase()){var E=S.indexOf("mediaconf"),T=S.indexOf("audiovideo");-1!=E?l._call.confID=S[E+1]:-1!=T&&(l._call._callID=S[T+1]);try{if(l._call._pc instanceof webkitDeprecatedPeerConnection){var b=S.indexOf("mod");if(-1!=b)if(l._call._modID=S[b+1],l._isModerator);else if(v){var C=l._call._DEPRECATEDroap.processRoapAnswer(l,v);l._call._pc.processSignalingMessage(C)}else{var C=l._call._DEPRECATEDroap.processRoapOK(l);l._call._pc.processSignalingMessage(C)}else if(l._isModerator||l._call instanceof Conference&&!l._isModerator){var C=l._call._DEPRECATEDroap.processRoapAnswer(l,v);l._call._pc.processSignalingMessage(C)}else{var C=l._call._DEPRECATEDroap.processRoapOK(l);l._call._pc.processSignalingMessage(C)}}else if(l._isModerator||l._call instanceof Conference&&!l._isModerator){var R=new SessionDescription(a(v)),w=c(R.toSdp());l._call._candidates=w,l._call._pc.setRemoteDescription(l._call._pc.SDP_ANSWER,R);for(N in w){var I=new IceCandidate(w[N].label,w[N].candidate);l._call._pc.processIceMessage(I)}}}catch(O){if(l._isModerator||l._call instanceof Conference&&!l._isModerator){var R=new SessionDescription(a(v)),w=c(R.toSdp());l._call._candidates=w,l._call._pc.setRemoteDescription(l._call._pc.SDP_ANSWER,R);for(N in w){var I=new IceCandidate(w[N].label,w[N].candidate);l._call._pc.processIceMessage(I)}}}}else if("session-terminated"==f.toLowerCase())l._call.state!=Call.State.ENDED&&(l._call&&l._call._pc&&l._call._pc.close&&(l._call._pc.close(),l._call._pc=null),l._isModerator=null,l._call.state=Call.State.ENDED);else if("invitation-received"==f.toLowerCase()){var N=S.indexOf("audiovideo"),x=t(v);l._isModerator=!1,x=e(l,x),l._call=new IncomingCall(l,g,x),l._call._url=l._gwUrl+m,l._call._callID=S[N+1],l._call._sdp.type="ANSWER",l._call._sdp.sdp=a(v),u.log(l._call._sdp.sdp),l._call._DEPRECATEDsdp=v,l._call._candidates=c(l._call._sdp.sdp),l._call.state=Call.State.RINGING}else if("mod-received"==f.toLowerCase()){var N=S.indexOf("mod");if(l._call._modID=S[N+1],l._isModerator||l._call instanceof Conference&&!l._isModerator){var C=l._call._DEPRECATEDroap.processRoapOffer(l,v);l._call._pc.processSignalingMessage(C)}}else u.log("Unhandled audio video channel event: "+d+" "+f)}else if("file-transfer"==d){var D=h.fileName,k=h.fileSize,L=h.contentType,F=h.ftId,U=null;if(l._ftp&&(U=l._ftp.get(F)),"session-open"==f.toLowerCase()&&U)U instanceof OutgoingFileTransfer?(u.log("Uploading..."),U._id=F,U._uploadFile()):(u.log("Downloading..."),U._downloadFile());else if("session-terminated"==f.toLowerCase()&&U){var M=h.code;if(u.log("session-terminated"),U.state!=FileTransfer.State.ERROR&&U.state!=FileTransfer.State.CANCELED)switch(M){case 487:case 603:U.state=FileTransfer.State.CANCELED;break;case 403:_InternalError(U,FileTransfer.Error.FILE_SIZE_LIMIT);break;case 486:_InternalError(U,FileTransfer.Error.TIMEOUT);break;case 480:case 500:_InternalError(U,FileTransfer.Error.INVALID_USER);break;default:}}else"invitation-received"==f.toLowerCase()&&(U?l._ftp.remove(F):(U=new IncomingFileTransfer(l,g),U._url=l._gwUrl+y,U._id=F,U._fileName=D,U._fileSize=k,U._fileType=L,U.state=FileTransfer.State.INVITATION_RECEIVED,l._ftp.put(F,U)))}else if("address-book"==d){var j=h.contacts;h.abId,l._contactList._syncId=h.syncId,j&&l._contactList._parseAddressBook(j)}else if("message"==d){var H=h.body,L=h.contentType,q=h.type;if("session-message"==q)if(-1==l._chat.contains(g)){var G=new Chat(l,g);G._url=l._gwUrl+A,G.state=Chat.State.ACTIVE;var B={chat:G,call:null,conf:null};l.oninvite(B);var W={from:g,message:H};G.onmessage(W),l._chat.put(g,G)}else{var J=l._chat.get(g);J.state!=Chat.State.ACTIVE&&(J.state=Chat.State.ACTIVE);var B={from:g,message:H};J.onmessage(B)}else"message"==q&&u.log("PAGER MODE MESSAGE")}else if("composing"==d){var $=h.refresh,J=l._chat.get(g),B={from:g,state:f,refresh:$};J.oncomposing(B)}else if("media-message"==d){var g=h.from,L=h.contentType,X=h.url;h.size;var J=l._chat.get(g);J.state=Chat.State.ACTIVE;var V=X.substring(X.indexOf("fileRef")+8,X.length);J._getMedia(V,g)}else if("message-failure"==d){var z=h.to,M=(h.msgId,h.code),J=l._chat.get(z);switch(M){case 480:_InternalError(J,Chat.Error.USER_NOT_ONLINE);break;case 500:_InternalError(J,Chat.Error.INVALID_USER);break;case 404:default:_InternalError(J,Chat.Error.NETWORK_FAILURE)}}else if("conference-invite"==d){var Y=h.referredBy,K=h.confId,Q=h.subject,Z=h.members,et=new GroupChat(l,Q,Z,Y,K);et._url=l._gwUrl+P;var B={groupChat:et,chat:null,call:null,conf:null};l.oninvite(B)}else if("conference-info"==d){var tt=h.userCount,K=h.confId,nt=h.users,f=h.state;h.reason;var ot=l._chat.get(K);if(ot)if(0==tt||0==nt.length)ot.state=GroupChat.State.ENDED;else if(ot.state!=GroupChat.State.ENDED){ot.state!=GroupChat.State.IN_PROGRESS&&(ot.state=GroupChat.State.IN_PROGRESS);for(var it=0;nt.length>it;it++){for(var rt=0;ot.members.length>rt;rt++)if(l.username==nt[it].entity&&"disconnected"==nt[it].status&&(ot.state=GroupChat.State.ENDED),ot.members[rt].entity==nt[it].entity){ot.members[rt].status=nt[it].status;break}rt==ot.members.length&&ot.members.push(nt[it])}ot.state!=GroupChat.State.ENDED&&ot.onupdate({members:ot.members})}}else if("conference-message"==d){var g=h.from,K=h.confId,H=h.body;u.log("GroupChat message: confId: "+K+", from: "+g+", body: "+H);var ot=l._chat.get(K),B={confId:K,from:g,message:H};ot.onmessage(B)}else if("conference-media-message"==d){var g=h.from,K=h.confId,L=h.contentType,X=h.url;h.size;var ot=l._chat.get(K),V=X.substring(X.indexOf("fileRef")+8,X.length);ot._getMedia(V,g)}else if("conference-composing"==d){var g=h.from,K=h.confId,$=h.refresh,f=h.state,ot=l._chat.get(K),B={from:g,refresh:$,state:f};ot.oncomposing(B)}else if("contactlist"==d){var j=h.contacts;j&&l._contactList._parseContactList(j)}else if("presencelist"==d){var st=h.userPresences;st&&l._contactList._parsePresenceList(st)}else if("anonymous-subscription"==d)h.isIMSUser,h.services;else if("watcherlist"==d){var j=h.contacts;if(j){var at=[];for(var it in j){var ct=j[it].uri,lt=!1;for(var rt in l._contactList.contact)n(ct)==l._contactList.contact[rt]._id&&(at.push(l._contactList.contact[rt]),lt=!0);if(0==lt){var ut={numbers:[{number:j[it].uri}]},ht=new Contact(ut);ht._mediaServices=l,ht._url=l._gwUrl,ht._id=n(j[it].uri),at.push(ht)}}var B={contacts:at};l._contactList.onpresenceinvite(B)}}else u.log("Unhandled channel event: "+d+" "+f)}null!=l._channel&&(s.pollChannel(),r=2e3)}else 204==this.status?(u.log("Get channel successful: "+this.status+" "+this.statusText+" "+this.responseText),null!=l._channel&&(s.pollChannel(),r=2e3)):r>=128e3?l.unregister():null!=l._channel&&(r*=2,u.log("Get channel unsuccessful: "+this.responseText),setTimeout(function(){s.pollChannel()},r))}}}function s(e,t){var n={};n=e?{to:e,sdp:[]}:{sdp:[]};var o=JSON.stringify(t),i=/v=(.*?)(?=\\r\\n)/g,r=i.exec(o),s=/o=(.*?)(?=\\r\\n)/g,a=s.exec(o),c=/s=(.*?)(?=\\r\\n)/g,l=c.exec(o),h=/t=(.*?)(?=\\r\\n)/g,p=h.exec(o),d=/a=(.*?)(?=\\r\\n)/g,f=d.exec(o),g=/m=(.*)/g,m=g.exec(o),v=m[1],y=v.split("m=");for(var _ in y){var S="m="+y[_],E=S.split("\\r\\n");E.pop();var T={};T=0==_?{v:r[1],o:a[1],s:l[1],t:p[1],a:f[1],m:"",c:"",attributes:[]}:{m:"",c:"",attributes:[]};for(var b in E){var C=E[b];if("m"==C[0]&&(T.m=C.substring(2)),"c"==C[0]&&(T.c=C.substring(2)),"a"==C[0]){var R={a:C.substring(2)};T.attributes.push(R)}}n.sdp.push(T)}return u.log(JSON.stringify(n,null," ")),n}function a(e){var t="v=0\r\no=- 0 0 IN IP4 127.0.0.1\r\ns=\r\nt=0 0\r\na=group:BUNDLE audio video\r\n";for(mediaIndex in e){t+="m="+e[mediaIndex].m+"\r\n",t+="c="+e[mediaIndex].c+"\r\n";for(attributeIndex in e[mediaIndex].attributes)t+="a="+e[mediaIndex].attributes[attributeIndex].a+"\r\n"}return t}function c(e){var t=[],n=e.split("\r\n"),o=-1;for(i in n)0==n[i].indexOf("m=")?o++:0==n[i].indexOf("a=candidate")&&t.push({label:o,candidate:n[i]});return t}function l(){var e={messageType:"",SDP:[],offererSessionId:"",answererSessionId:"",reset:function(){messageType="",SDP=[],offererSessionId="",answererSessionId=""}};this.parseROAP=function(t){var n=JSON.parse(t.slice(t.indexOf("{")),t.lastIndexOf("}"));if(e.reset(),e.messageType=n.messageType,e.offererSessionId=n.offererSessionId,e.answererSessionId=n.answererSessionId,e.SDP=null,e.seq=n.seq,n.sdp){var o={v:"",o:"",s:"",t:"",sdp:[]},i=JSON.stringify(n.sdp),r=/v=(.*?)(?=\\r\\n)/g,s=r.exec(i);o.v=s[1];var a=/o=(.*?)(?=\\r\\n)/g,c=a.exec(i);o.o=c[1];var l=/s=(.*?)(?=\\r\\n)/g,u=l.exec(i);o.s=u[1];var h=/t=(.*?)(?=\\r\\n)/g,p=h.exec(i);o.t=p[1];var d=/m=(.*)/g,f=d.exec(i),g=f[1],m=g.split("m=");for(var v in m){var y="m="+m[v],_=y.split("\\r\\n");_.pop();var S={m:"",c:"",attributes:[]};for(var E in _){var T=_[E];if("m"==T[0]&&(S.m=T.substring(2)),"c"==T[0]&&(S.c=T.substring(2)),"a"==T[0]){var b={a:T.substring(2)};S.attributes.push(b)}}o.sdp.push(S)}e.SDP=o}return e},this.processRoapOffer=function(t,n){u.log("Processing an OFFER..."),this._lastSdp=n;var o=null,i=null,r=1;t._isModerator||t._call instanceof Conference&&!t._isModerator?(r=2,o=e.offererSessionId,i=e.answererSessionId):(o=this.idGenerator(),r=1);var s=this.tieBreakerGenerator(),a="v=0\r\no=- 0 0 IN IP4 127.0.0.1\r\ns=\r\nt=0 0\r\n";for(mediaIndex in n){a+="m="+n[mediaIndex].m+"\r\n",a+="c="+n[mediaIndex].c+"\r\n";for(attributeIndex in n[mediaIndex].attributes)a+="a="+n[mediaIndex].attributes[attributeIndex].a+"\r\n"}var c={messageType:"OFFER",offererSessionId:o,answererSessionId:i,sdp:a,seq:r,tieBreaker:s},l="SDP\n"+JSON.stringify(c);return l},this.processRoapAnswer=function(t,n,o){u.log("Processing an ANSWER..."),this._lastSdp=n;var i=null,r=null,s=2;t._isModerator||t._call instanceof Conference&&!t._isModerator?(s=1,i=e.offererSessionId,r=this.idGenerator()):(s=2,i=e.offererSessionId,r=e.answererSessionId),o&&(s=2,i=e.answererSessionId,r=e.offererSessionId,i=e.offererSessionId,r=e.answererSessionId);var a="v=0\r\no=- 0 0 IN IP4 127.0.0.1\r\ns=\r\nt=0 0\r\n";for(mediaIndex in n){a+="m="+n[mediaIndex].m+"\r\n",a+="c="+n[mediaIndex].c+"\r\n";for(attributeIndex in n[mediaIndex].attributes)a+="a="+n[mediaIndex].attributes[attributeIndex].a+"\r\n"}var c={messageType:"ANSWER",offererSessionId:i,answererSessionId:r,sdp:a,seq:s},l="SDP\n"+JSON.stringify(c);return l},this.processRoapOK=function(t){u.log("Processing an OK..."),e.answererSessionId||(e.answererSessionId=this.idGenerator());var n=e.answererSessionId,o=e.offererSessionId,i=1;i=t._isModerator?2:1;var r={messageType:"OK",offererSessionId:n,answererSessionId:o,seq:i},s="SDP\n"+JSON.stringify(r);return u.log("roap message: "+s),s},this.idGenerator=function(){var e=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+e()+e()+e()+e()+e()+e()},this.tieBreakerGenerator=function(){var e=Math.floor(9e4*Math.random())+1e9;return e}}var u={log:function(){},warn:function(){},error:function(){}};Logs&&(u=console);var h="session",p="register",d="mediaconf",f="add",g="remove",m="audiovideo",v="channels",y="filetransfer",_="sendfile",S="uploadfiledata",E="accept",T="terminate",b="getfiledata",C="ab",R="contacts",A="message",w="send",I="send-iscomposing",O="sendmedia?to=",N="getmedia?fileRef=",P="groupchat",x="create",D="leave",k="addparticipants",L="join",F="invite/accept",U="invite/decline",M="sendmedia?confId=";PRESENCE_RESOURCE="presence",PRESENCE_RESOURCE_USER="user",PRESENCE_RESOURCE_USER_SUBSCRIBE="subscribe",PRESENCE_RESOURCE_USER_PUBLISH="publish",PRESENCE_RESOURCE_USER_ANONYMOUS="anonymous",PRESENCE_RESOURCE_LIST="list",PRESENCE_RESOURCE_LIST_ADD="adduser",PRESENCE_RESOURCE_LIST_REMOVE="removeuser",PRESENCE_RESOURCE_LIST_BLOCK="blockuser",CONTENT_RESOURCE="content",CONTENT_RESOURCE_GETAVATAR="getavatar",CONTENT_RESOURCE_SETAVATAR="setavatar",CONTENT_RESOURCE_DELETEAVATAR="deleteavatar";var j={MESSAGING_STANDALONE:{serviceDescription:"org.3gpp.urn:urn-7:3gpp-application.ims.iari.rcs.sm",serviceVersion:"1.0"},MESSAGING_SESSION_MODE:{serviceDescription:"org.openmobilealliance:IM-session",serviceVersion:"1.0"},FILE_TRANSFER:{serviceDescription:"org.openmobilealliance:File-Transfer",serviceVersion:"1.0"},IMAGE_SHARE:{serviceDescription:"org.gsma.imageshare",serviceVersion:"1.0"},VIDEO_SHARE_1:{serviceDescription:"org.gsma.videoshare",serviceVersion:"1.0"},VIDEO_SHARE_2:{serviceDescription:"org.gsma.videoshare",serviceVersion:"2.0"},SOCIAL_PRESENCE:{serviceDescription:"org.3gpp.urn:urn-7:3gpp-application.ims.iari.rcse.sp",serviceVersion:"1.0"},CAPABILITY_DISCOVERY:{serviceDescription:"org.3gpp.urn:urn-7:3gpp-application.ims.iari.rcse.dp",serviceVersion:"1.0"},VOICE_CALL:{serviceDescription:"org.3gpp.urn:urn-7:3gpp-service.ims.icsi.mmtel",serviceVersion:"1.0"},VIDEO_CALL:{serviceDescription:"org.3gpp.urn:urn-7:3gpp-service.ims.icsi.mmtel",serviceVersion:"1.0"},GEOLOCATION_PUSH:{serviceDescription:"org.3gpp.urn:urn-7:3gpp-application.ims.iari.rcs.geopush",serviceVersion:"1.0"},GEOLOCATION_PULL:{serviceDescription:"org.3gpp.urn:urn-7:3gpp-application.ims.iari.rcs.geopull",serviceVersion:"1.0"}},H=51200;MediaServices=function(e,t,n,o){var i=MediaServices.State.INITIALISED,r=o,s="NONE",a=t;this._gwUrl="/"==e.substr(-1)?e:e+"/",this._channel=null,this._isModerator=null,this._call=null,this._isSipUser=0==t.indexOf("sip:")?!0:!1,this._ftp=new q,this._sessionID=null,this._contactList=null,this._chat=new q,this._willingness,this._tagline="",this._homepage="",this._accessToken=0==n.indexOf("oauth ")?n.substring(6,n.length):null,Object.defineProperty(this,"state",{get:function(){return i},set:function(e){var t={type:"statechange",oldState:i,state:e};i=e,"function"==typeof this.onstatechange&&this.onstatechange(t),e==MediaServices.State.READY&&"function"==typeof this.onready?this.onready(t):e==MediaServices.State.CLOSED&&"function"==typeof this.onclose&&this.onclose(t)}}),Object.defineProperty(this,"mediaType",{get:function(){return r}}),Object.defineProperty(this,"turnConfig",{get:function(){return s},set:function(e){s=e}}),Object.defineProperty(this,"contactList",{get:function(){return this._contactList}}),Object.defineProperty(this,"willingness",{get:function(){return this._willingness},set:function(e){this._willingness=e,this._publish({willingness:e})}}),Object.defineProperty(this,"tagline",{get:function(){return this._tagline},set:function(e){this._tagline=e,this._publish({freeText:e})}}),Object.defineProperty(this,"homepage",{get:function(){return this._homepage},set:function(e){this._homepage=e,e.url&&e.label&&this._publish({homepage:e})}}),Object.defineProperty(this,"username",{get:function(){return a}}),this._register(t,n)},MediaServices.prototype._getVersion=function(){var e=this._gwUrl+"application/version",t=new o(this._accessToken);t.open("GET",e,!0),t.setRequestHeader("Accept","application/json, text/html"),t.send(null),t.onreadystatechange=function(){4==this.readyState&&200==this.status&&u.log(this.responseText)}},MediaServices.prototype._getInfo=function(){var e=this._gwUrl+"application/info",t=new o(this._accessToken);t.open("GET",e,!0),t.setRequestHeader("Accept","application/json, text/html"),t.send(null),t.onreadystatechange=function(){4==this.readyState&&200==this.status&&u.log(this.responseText)}},MediaServices.prototype._register=function(e,t){var n=this,i=this._gwUrl+p;if(u.log("Media service initialised"),"string"!=typeof e||""==e)throw Error(MediaServices.Error.INVALID_CREDENTIALS);if("string"!=typeof this.mediaType)throw new TypeError(MediaServices.Error.INVALID_SERVICES);for(var s=[],a=this.mediaType.toLowerCase().replace(/(\s)/g,"").split(","),c=0;a.length>c;c++)"audio"==a[c]?s.push("ip_voice_call"):"video"==a[c]?s.push("ip_video_call"):"ftp"==a[c]?s.push("file_transfer"):"chat"==a[c]&&s.push("im_chat");if(1>s.length)throw Error("Invalid user services");var l=null;l=this._isSipUser?{username:e,password:t,mediaType:"rtmp",services:s}:{username:e,mediaType:"rtmp",services:s};var d=new o(this._accessToken);d.open("POST",i,!0),d.setRequestHeader("Content-Type","application/json"),d.setRequestHeader("Accept","application/json, text/html"),d.send(JSON.stringify(l,null," ")),d.onreadystatechange=function(){if(4==this.readyState)if(n.state=MediaServices.State.REGISTERING,u.log("Registering..."),201==this.status){var e=JSON.parse(this.responseText),t=e.resourceURL.split("/"),o=t.indexOf("session");n._sessionID=t[o+1],n._gwUrl+=h+"/"+n._sessionID+"/",n._channel=new r(n),n._channel.pollChannel(),u.log("Registration successful"),n.state=MediaServices.State.READY}else switch(u.log("Registration unsuccessful: "+this.status+" "+this.statusText),this.status){case 401:case 403:_InternalError(n,MediaServices.Error.INVALID_CREDENTIALS);break;default:_InternalError(n,MediaServices.Error.NETWORK_FAILURE)}}},MediaServices.State={},MediaServices.State.INITIALISED=0,MediaServices.State.REGISTERING=1,MediaServices.State.READY=2,MediaServices.State.UNREGISTERING=3,MediaServices.State.CLOSED=4,MediaServices.State.ERROR=5,MediaServices.Error={},MediaServices.Error.NETWORK_FAILURE=0,MediaServices.Error.INVALID_CREDENTIALS=1,MediaServices.Error.INVALID_SERVICES=2,MediaServices.prototype.reregister=function(){var e=this,t=e._gwUrl+p;u.log("Reregistering..."),this.state=MediaServices.State.REGISTERING;var n=new o(this._accessToken);n.open("PUT",t,!0),n.setRequestHeader("X-http-method-override","PUT"),n.setRequestHeader("Accept","application/json, text/html"),n.send(null),n.onreadystatechange=function(){if(4==this.readyState){var t=JSON.parse(this.responseText);200==this.status?(u.log("Reregistration successful "+t.expires),e.state=MediaServices.State.READY):(u.log("Reregistration unsuccessful: "+this.status+" "+this.statusText),_InternalError(e,MediaServices.Error.NETWORK_FAILURE))}}},MediaServices.prototype.unregister=function(){var e=this,t=e._gwUrl+p;u.log("Deregistering..."),this.state=MediaServices.State.UNREGISTERING;var n=new o(this._accessToken);n.open("DELETE",t,!0),n.setRequestHeader("X-http-method-override","DELETE"),n.setRequestHeader("Accept","application/json, text/html"),n.send(null),n.onreadystatechange=function(){4==this.readyState&&(204==this.status?(e._clean(),u.log("Deregistration successful"),e.state=MediaServices.State.CLOSED):(u.log("Deregistration unsuccessful: "+this.status+" "+this.statusText),_InternalError(e,MediaServices.Error.NETWORK_FAILURE)))}},MediaServices.prototype.anonymousSubscribe=function(){var e=this,t=this._gwUrl+PRESENCE_RESOURCE+"/"+PRESENCE_RESOURCE_USER+"/"+PRESENCE_RESOURCE_USER_ANONYMOUS+"/"+PRESENCE_RESOURCE_USER_SUBSCRIBE;u.log("Anonymous subscribing...");var n=[];if(this._contactList)for(var i in this._contactList.contact)n.push("tel:+"+this._contactList.contact[i]._id);if(0==n.length)return u.log("No one to subscribe to"),void 0;var r={entities:n},s=new o(this._accessToken);s.open("POST",t,!0),s.setRequestHeader("Accept","application/json, text/html"),s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(r,null," ")),s.onreadystatechange=function(){if(4==s.readyState)if(202==s.status)u.log("Anonymous subscribe successful");else{var t=JSON.parse(s.responseText);u.log("Anonymous subscribe failed: "+t.reason),_InternalError(e,MediaServices.Error.NETWORK_FAILURE)}}},MediaServices.prototype.subscribe=function(){var e=this,t=this._gwUrl+PRESENCE_RESOURCE+"/"+PRESENCE_RESOURCE_USER+"/"+PRESENCE_RESOURCE_USER_SUBSCRIBE;u.log("Subscribing...");var n=new o(this._accessToken);n.open("POST",t,!0),n.setRequestHeader("Accept","application/json, text/html"),n.send(null),n.onreadystatechange=function(){if(4==n.readyState)if(201==n.status)u.log("Subscribe successful");else{var t=JSON.parse(n.responseText);u.log("Subscribe failed: "+t.reason),_InternalError(e,MediaServices.Error.NETWORK_FAILURE)}}},MediaServices.prototype._publish=function(e){var t=this,n=this._gwUrl+PRESENCE_RESOURCE+"/"+PRESENCE_RESOURCE_USER+"/"+PRESENCE_RESOURCE_USER_PUBLISH;u.log("Publishing services...");var i={person:e},r=new o(this._accessToken);r.open("POST",n,!0),r.setRequestHeader("Accept","application/json, text/html"),r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify(i,null," ")),r.onreadystatechange=function(){if(4==r.readyState)if(201==r.status)u.log("Publish services successful");else{var e=JSON.parse(r.responseText);u.log("Publish services failed: "+e.reason),_InternalError(t,MediaServices.Error.NETWORK_FAILURE)}}},MediaServices.prototype.setAvatar=function(e,t){if(!(e instanceof File))throw new TypeError("Invalid avatar file");if(0!=e.type.indexOf("image"))throw new TypeError("Invalid avatar file");var n=this._gwUrl+CONTENT_RESOURCE+"/"+CONTENT_RESOURCE_SETAVATAR,i=new FormData;i.append("Filename",e.name),i.append("ClientId",this._sessionID),i.append("Filedata",e),i.append("Upload","Submit Query");var r=new o(this._accessToken);r.open("POST",n,!0),r.setRequestHeader("Accept","application/json, text/html"),r.send(i),r.onreadystatechange=function(){if(4==r.readyState){var e=!1;switch(r.status){case 201:case 204:if(u.log("Set avatar successful"),e=!0,"function"==typeof t){var n={success:!0,failure:!1};t(n)}break;default:var o=JSON.parse(r.responseText);if(u.log("Set avatar failed: "+o.reason),"function"==typeof t){var n={success:!1,failure:!0};t(n)}}}}},MediaServices.prototype.deleteAvatar=function(){var e=this,t=this._gwUrl+CONTENT_RESOURCE+"/"+CONTENT_RESOURCE_DELETEAVATAR,n=new o(this._accessToken);n.open("DELETE",t,!0),n.setRequestHeader("Accept","application/json, text/html"),n.send(null),n.onreadystatechange=function(){if(4==n.readyState)if(204==n.status)u.log("Delete avatar successful");else{var t=JSON.parse(n.responseText);u.log("Delete avatar unsuccessful"+t.reason),_InternalError(e,MediaServices.Error.NETWORK_FAILURE)}}},MediaServices.prototype._publishServices=function(){var e=this,t=this._gwUrl+PRESENCE_RESOURCE+"/"+PRESENCE_RESOURCE_USER+"/"+PRESENCE_RESOURCE_USER_PUBLISH;u.log("Publishing services...");for(var n=[],i=this.mediaType.replace(/(\s)/g,"").split(","),r=0;i.length>r;r++)if("audio"==i[r]){var s=j.VOICE_CALL;s.serviceStatus="open",n.push(s)}else if("video"==i[r]){var s=j.VIDEO_CALL;s.serviceStatus="open",n.push(s)}else if("ftp"==i[r]){var s=j.FILE_TRANSFER;s.serviceStatus="open",n.push(s)}else{if("chat"!=i[r]){n=[];break}var s=j.MESSAGING_SESSION_MODE;s.serviceStatus="open",n.push(s)}if(1>n.length)throw Error("Invalid user services");var a={services:n},c=new o(this._accessToken);c.open("POST",t,!0),c.setRequestHeader("Accept","application/json, text/html"),c.setRequestHeader("Content-Type","application/json"),c.send(JSON.stringify(a,null," ")),c.onreadystatechange=function(){if(4==c.readyState)if(201==c.status)u.log("Publish services successful");else{var t=JSON.parse(c.responseText);u.log("Publish services failed: "+t.reason),_InternalError(e,MediaServices.Error.NETWORK_FAILURE)}}},MediaServices.prototype._clean=function(){this._channel=null,this._call&&(this._call._pc&&this._call._pc.close&&(this._call._pc.close(),this._call._pc=null),delete this._call,this._call=null),this._ftp&&(this._ftp.clear(),delete this._ftp,this._ftp=null),this._contactList&&(delete this._contactList,this._contactList=null),this._chat&&(this._chat.clear(),delete this._chat,this._chat=null)},MediaServices.prototype.createCall=function(t,n){if("string"!=typeof t||""==t)throw Error("Recipient must be defined, and must be a string");return u.log("MediaServices.prototype.createCall.... "),n=e(this,n),this._isModerator=!0,this._call=new OutgoingCall(this,t,n),this._call._url=this._gwUrl+m,this._call},MediaServices.prototype.createConference=function(t,n){t=e(this,t);var o=this._gwUrl+d;return this._call=new Conference(this,n,o,t),this._isModerator=!0,this._call},MediaServices.prototype.createFileTransfer=function(e){if("string"!=typeof e||""==e)throw Error("Invalid destination");var t=new OutgoingFileTransfer(this,e);return t._url=this._gwUrl+y,t},MediaServices.prototype.createChat=function(e){if("string"!=typeof e||""==e||e==this.username)throw Error("Invalid recipient");var t=new Chat(this,e);return t._url=this._gwUrl+A,t},MediaServices.prototype.createGroupChat=function(e,t){if("string"!=typeof e||""==e)throw Error("Invalid subject");if("object"!=typeof t||!t||0==t.length)throw Error("Invalid recipients");if(t.indexOf(this.username)>-1&&(t.splice(t.indexOf(this.username),1),0==t.length))throw Error("No recipients");var n=new GroupChat(this,e,t,this.username);return n._url=this._gwUrl+P,n._isOwner=!0,n},MediaServices.prototype.onready=function(){},MediaServices.prototype.onerror=function(){},MediaServices.prototype.onclose=function(){},MediaServices.prototype.onstatechange=function(){},MediaServices.prototype.oninvite=function(){},Call=function(e,t,n){var o;Object.defineProperty(this,"mediaType",{get:function(){return n},set:function(e){if(null!=this._pc)throw"Cannot change media type after established media.";n=e}}),Object.defineProperty(this,"state",{get:function(){return o},set:function(t){var n={type:"statechange",oldState:o,state:t};switch(o=t,"function"==typeof this.onstatechange&&this.onstatechange(n),t){case Call.State.RINGING:if(this instanceof IncomingCall){var n={call:this,conf:null};"function"==typeof e.oninvite&&e.oninvite(n)}break;case Call.State.ENDED:case Conference.State.ENDED:"function"==typeof this.onend&&this.onend(n);break;case Call.State.ONGOING:case Conference.State.IN_PROGRESS:"function"==typeof this.onbegin&&this.onbegin(n);break;default:}}}),Object.defineProperty(this,"remoteStreams",{get:function(){return this._pc?this._pc.remoteStreams:[]}}),Object.defineProperty(this,"localStreams",{get:function(){return this._pc?this._pc.localStreams:[]}}),this.recipient=t,this._mediaServices=e,this._url=null,this._pc=null,this._callID=null,this._sdp={},this._candidates=[],this._isSignalingSent=!1,this._DEPRECATEDmodID=null,this._DEPRECATEDroap=new l},Call.State={},Call.State.READY=0,Call.State.RINGING=1,Call.State.ONGOING=2,Call.State.ENDED=3,Call.State.ERROR=4,Call.Error={},Call.Error.NETWORK_FAILURE=0,Call.Error.PEER_CONNECTION=1,Call.Error.USER_MEDIA=2,Call.prototype.getStringState=function(e){switch(e){case Call.State.READY:return"READY";case Call.State.RINGING:return"RINGING";
case Call.State.ONGOING:return"ONGOING";case Call.State.ENDED:return"ENDED";default:return"ERROR"}},Call.prototype.end=function(){var e=this,t=this._url+"/"+this._callID;u.log("Leaving call...");var n=new o(this._mediaServices._accessToken);n.open("DELETE",t,!0),n.setRequestHeader("X-http-method-override","DELETE"),n.send(null),n.onreadystatechange=function(){if(4==n.readyState)if(204==n.status)u.log("Leave call successful"),e._mediaServices._isModerator=null,e.state=Call.State.ENDED;else{var t=JSON.parse(n.responseText);if(u.log("Leave call unsuccessful: "+t.reason),403==n.status)throw Error("No active call to end");_InternalError(e,Call.Error.NETWORK_FAILURE)}},this._pc&&this._pc.close&&this._pc.close(),this._pc=null},Call.prototype._createPeerConnection=function(e){var t=this;if(u.log("in createPeerConnection "),"undefined"==typeof webkitPeerConnection00)throw"This is not Chrome 21+";navigator.webkitGetUserMedia(t.mediaType,function(n){t._pc=new webkitPeerConnection00(t._mediaServices.turnConfig,function(e,n){e&&t._sdp.sdp.addCandidate(e),n||t._isSignalingSent||(t._sendSignaling(t._sdp.type,t._sdp.sdp.toSdp()),t._isSignalingSent=!0)}),t._pc.addStream(n),t._pc.onaddstream=function(e){"function"==typeof t.onaddstream&&(e.call=t,t.onaddstream(e))},t._pc.onremovestream=function(e){u.log("ONREMOVESTREAM"),"function"==typeof t.onremovestream&&(e.call=t,t.onremovestream(e))},t._pc.onclose=function(){t.onend()},t._pc.onopen=function(){t.state=Call.State.ONGOING},"function"==typeof e&&e()},function(e){u.log("Error obtaining user media: "+(""+e));var n=t instanceof Conference?Conference:Call;_InternalError(n,n.Error.USER_MEDIA)})},Call.prototype._sendSignaling=function(e,t){var n=this,i=this._url;if("OFFER"==e)if(u.log("Sending OFFER"),this instanceof Conference&&!this.confID){var r=s(null,t),a=new o(this._mediaServices._accessToken);a.open("POST",i,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Accept","application/json, text/html"),a.send(JSON.stringify(r,null," ")),a.onreadystatechange=function(){if(4==a.readyState){var e=JSON.parse(a.responseText);if(202==a.status){var t=e.resourceURL.split("/"),o=t.indexOf("mediaconf");n.confID=t[o+1]}else _InternalError(n,n.Error.NETWORK_FAILURE)}}}else{var r=s(this.recipient,t),a=new o(this._mediaServices._accessToken);a.open("POST",i,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Accept","application/json, text/html"),a.send(JSON.stringify(r,null," ")),a.onreadystatechange=function(){if(4==a.readyState){var e=JSON.parse(a.responseText);if(201==a.status)u.log("Audio video invite: "+e.state);else if(202==a.status);else{if(u.log("Audio video invite unsuccessful: "+e.reason),400==a.status)throw Error("User not found");_InternalError(n,n.Error.NETWORK_FAILURE)}}}}else if("ANSWER"==e){u.log("Sending ANSWER"),i+=this instanceof Conference?"/"+this.confID:"/"+this._callID;var r=s(null,t),a=new o(this._mediaServices._accessToken);a.open("POST",i,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Accept","application/json, text/html"),a.send(JSON.stringify(r,null," ")),a.onreadystatechange=function(){if(4==this.readyState){var e=JSON.parse(a.responseText);200==a.status?u.log("Accept invite: "+e.state):(u.log("Accept invite unsuccessful: "+e.reason),_InternalError(n,n.Error.NETWORK_FAILURE))}}}},Call.prototype._doOffer=function(){var e=this._pc.createOffer(this.mediaType);this._pc.setLocalDescription(this._pc.SDP_OFFER,e),this._pc.startIce(),this._sdp.type="OFFER",this._sdp.sdp=e},Call.prototype._doAnswer=function(){var e=new SessionDescription(this._sdp.sdp);this._pc.setRemoteDescription(this._pc.SDP_OFFER,e);var t=this._pc.createAnswer(this._pc.remoteDescription.toSdp(),this.mediaType);this._pc.setLocalDescription(this._pc.SDP_ANSWER,t),this._pc.startIce(),this._sdp.type="ANSWER",this._sdp.sdp=t;for(index in this._candidates){var n=new IceCandidate(this._candidates[index].label,this._candidates[index].candidate);this._pc.processIceMessage(n)}},Call.prototype._DEPRECATEDcreatePeerConnection=function(e,t){var n=this;console.log("Creating DEPRECATED PC"),"Google Inc."!=navigator.vendor&&(console.log("Non-google vendor"),n._pc=new webkitDeprecatedPeerConnection(n._mediaServices.turnConfig,function(t){u.log("turnConfig: "+n._mediaServices.turnConfig+"   sig: "+t),n._DEPRECATEDsendSignaling(t,function(t){"function"==typeof e&&e(t)})}));var o=function(){navigator.webkitGetUserMedia(n.mediaType.video?"audio,video":"audio",function(o){try{"Google Inc."==navigator.vendor&&(console.log("Google vendor"),n._pc=new webkitDeprecatedPeerConnection(n._mediaServices.turnConfig,function(t){u.log("turnConfig: "+n._mediaServices.turnConfig+"   sig: "+t),n._DEPRECATEDsendSignaling(t,function(t){"function"==typeof e&&e(t)})}))}catch(i){n._pc=new webkitPeerConnection00(n._mediaServices.turnConfig,function(t){u.log("turnConfig: "+n._mediaServices.turnConfig+"   sig: "+t),n._DEPRECATEDsendSignaling(t,function(t){"function"==typeof e&&e(t)})})}console.log("Add local stream"),n._pc.addStream(o),n._pc.onaddstream=function(e){"function"==typeof n.onaddstream&&(e.call=n,n.onaddstream(e))},n._pc.onremovestream=function(e){u.log("ONREMOVESTREAM"),"function"==typeof n.onremovestream&&(e.call=n,n.onremovestream(e))},n._pc.onclose=function(){n.onend()},n._pc.onopen=function(){n.state=Call.State.ONGOING},u.log("Event propagated"),t&&(console.log("Submitting signalling"),n._pc.processSignalingMessage(t))},function(e){u.log("Error obtaining user media: "+(""+e));var t=n instanceof Conference?Conference:Call;_InternalError(n,t.Error.USER_MEDIA)})};"Google Inc."!=navigator.vendor?setTimeout(o,0):o()},Call.prototype._DEPRECATEDsendSignaling=function(e,t){var n=this,i=this._DEPRECATEDroap.parseROAP(e),r=this._url,s=n instanceof Conference?Conference:Call;if(u.log("Roap Message Type: "+i.messageType),"OFFER"==i.messageType){if(u.log("Got OFFER"),2==i.seq){u.log("SEQ == 2; should generate auto-answer (I guess?)");var a=n._DEPRECATEDroap.processRoapAnswer(n._mediaServices,n._DEPRECATEDroap._lastSdp,!0);return n._pc.processSignalingMessage(a),void 0}if(this instanceof Conference&&!this.confID){var c=new o(this._mediaServices._accessToken);c.open("POST",r,!0),c.setRequestHeader("Content-Type","application/json"),c.setRequestHeader("Accept","application/json, text/html"),c.send(JSON.stringify(i.SDP,null," ")),c.onreadystatechange=function(){if(4==c.readyState){var e=JSON.parse(c.responseText);if(202==c.status){var o=e.resourceURL.split("/"),i=o.indexOf("mediaconf");n.confID=o[i+1];var r={success:!0,failure:!1};t(r)}else{var r={success:!1,failure:!0};t(r)}}}}else{var l={to:this.recipient,sdp:i.SDP.sdp,v:i.SDP.sdp.v,o:i.SDP.sdp.o,s:i.SDP.sdp.s,t:i.SDP.sdp.t},c=new o(this._mediaServices._accessToken),h=JSON.stringify(l,null," ");c.open("POST",r,!0),c.setRequestHeader("Content-Type","application/json"),c.setRequestHeader("Accept","application/json, text/html"),c.send(h),c.onreadystatechange=function(){if(4==c.readyState){var e=JSON.parse(c.responseText);if(202==c.status||201==c.status)u.log("Audio video invite: "+e.state);else{if(u.log("Audio video invite unsuccessful: "+c.status+" "+e.reason),400==c.status)throw Error("User not found");_InternalError(n,s.Error.NETWORK_FAILURE)}}}}}else if("ANSWER"==i.messageType){u.log("Got ANSWER"),r+=this instanceof Conference?"/"+this.confID:"/"+this._callID,this._modID&&(r+="/mod/"+this._modID);var c=new o(this._mediaServices._accessToken),h=JSON.stringify(i.SDP,null," ");c.open("POST",r,!0),c.setRequestHeader("Content-Type","application/json"),c.setRequestHeader("Accept","application/json, text/html"),c.send(h),c.onreadystatechange=function(){if(4==this.readyState){var e=JSON.parse(c.responseText);200==c.status?u.log("Accept invite: "+e.state):(u.log("Accept invite unsuccessful: "+e.reason),_InternalError(n,s.Error.NETWORK_FAILURE))}}}else{if("OK"!=i.messageType)throw u.log("Got ERROR"),u.log(i),Error("Failed to setup peer connection");u.log("Got OK"),n.state=n instanceof Conference?s.State.IN_PROGRESS:s.State.ONGOING}},Call.prototype.onstatechange=function(){},Call.prototype.onbegin=function(){},Call.prototype.onend=function(){},Call.prototype.onaddstream=function(){},Call.prototype.onremovestream=function(){},Call.prototype.onerror=function(){},OutgoingCall=function(e,t,n){Call.prototype.constructor.call(this,e,t,n),this.state=Call.State.READY,u.log("OutgoingCall created")},OutgoingCall.prototype=new Call,OutgoingCall.prototype.constructor=OutgoingCall,OutgoingCall.prototype.ring=function(){var e=this;u.log("OutgoingCall ringing...");try{this._createPeerConnection(function(){e._doOffer()})}catch(t){console.log(t),this._DEPRECATEDcreatePeerConnection()}this.state=Call.State.RINGING},IncomingCall=function(e,t,n){e._isModerator=!1,Call.prototype.constructor.call(this,e,t,n),this._DEPRECATEDsdp=null,this.state=Call.State.READY,u.log("IncomingCall created")},IncomingCall.prototype=new Call,IncomingCall.prototype.constructor=IncomingCall,IncomingCall.prototype.answer=function(){var e=this;try{this._createPeerConnection(function(){e._doAnswer()})}catch(t){var n=this._DEPRECATEDroap.processRoapOffer(this._mediaServices,this._DEPRECATEDsdp);this._DEPRECATEDcreatePeerConnection(null,n)}},Conference=function(e,t,n,o){Object.defineProperty(this,"confID",{get:function(){return t},set:function(e){t=e}}),Call.prototype.constructor.call(this,e,t,o),this._url=n,this.state=Conference.State.NEW,u.log("Conference created")},Conference.State={},Conference.State.NEW=0,Conference.State.IN_PROGRESS=2,Conference.State.ENDED=3,Conference.State.ERROR=4,Conference.Error={},Conference.Error.NETWORK_FAILURE=0,Conference.Error.PEER_CONNECTION=1,Conference.prototype=new Call,Conference.prototype.constructor=Conference,Conference.prototype.leave=function(){var e=this,t=this._url+"/"+this.confID;u.log("Leaving conference: "+this.confID+"...");var n=new o(this._mediaServices._accessToken);n.open("DELETE",t,!0),n.setRequestHeader("X-http-method-override","DELETE"),n.send(null),n.onreadystatechange=function(){if(4==n.readyState)if(204==n.status)u.log("End conference successful!"),e.state=Conference.State.ENDED;else{var t=JSON.parse(n.responseText);if(u.log("End conference unsuccessful: "+t.reason),403==n.status)throw Error("No active conference to leave");_InternalError(e,Conference.Error.NETWORK_FAILURE)}},this._pc&&this._pc.close&&this._pc.close(),this._pc=null},Conference.prototype.join=function(){var e=this;if(u.log("Joining conference: "+this.confID+"..."),""==this.confID||"string"!=typeof this.confID)throw Error("Invalid conference ID");this.recipient="conf:"+this.confID;try{this._createPeerConnection(function(){e._doAnswer()})}catch(t){this._DEPRECATEDcreatePeerConnection()}},Conference.prototype.end=function(){this.leave()},Conference.prototype.removeUser=function(e,t){var n=this._url+"/"+this.confID+"/"+g;if(u.log("Removing participant "+e+" from conference "+this.confID+"..."),"string"!=typeof e)throw new TypeError("Invalid user");var i={members:[e]},r=new o(this._mediaServices._accessToken);r.open("POST",n,!0),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Accept","application/json, text/html"),r.send(JSON.stringify(i,null," ")),r.onreadystatechange=function(){if(4==r.readyState)if(202==r.status){if(u.log("Remove participant successful!"),"function"==typeof t){var e={success:!0,failure:!1};t(e)}}else{var n=JSON.parse(r.responseText);if(u.log("Remove participant unsuccessful: "+n.reason),"function"==typeof t){var e={success:!1,failure:!0};t(e)}}}},Conference.prototype.addUser=function(e,t){var n=this._url+"/"+this.confID+"/"+f;if(u.log("Adding participant "+e+" to conference "+this.confID+"..."),"string"!=typeof e||""==e)throw Error("Invalid user");var i={members:[e]},r=new o(this._mediaServices._accessToken);r.open("POST",n,!0),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Accept","application/json, text/html"),r.send(JSON.stringify(i,null," ")),r.onreadystatechange=function(){if(4==r.readyState)if(202==r.status){if(u.log("Add participant successful"),"function"==typeof t){var e={success:!0,failure:!1};t(e)}}else{var n=JSON.parse(r.responseText);if(u.log("Add participant unsuccessful: "+n.reason),"function"==typeof t){var e={success:!1,failure:!0};t(e)}}}},Conference.prototype.begin=function(e){u.log("Conference beginning...");var t=this;try{this._createPeerConnection(function(){t._doOffer()})}catch(n){this._DEPRECATEDcreatePeerConnection(function(t){"function"==typeof e&&e(t)})}},FileTransfer=function(e){var t=FileTransfer.State.IDLE;this._url=null,this._mediaServices=e,this._fileName=null,this._fileSize=null,this._fileType=null,this._id=null,Object.defineProperty(this,"state",{get:function(){return t},set:function(n){var o={type:"statechange",oldState:t,state:n};switch(t=n,"function"==typeof this.onstatechange&&this.onstatechange(o),n){case FileTransfer.State.INVITATION_RECEIVED:var o={call:null,conf:null,ftp:this};"function"==typeof e.oninvite&&e.oninvite(o);break;case FileTransfer.State.DOWNLOAD_COMPLETE:var o={ftp:this};"function"==typeof this.onreceivedfile&&this.onreceivedfile(o);default:}}}),Object.defineProperty(this,"name",{get:function(){return this._fileName}}),Object.defineProperty(this,"size",{get:function(){return this._fileSize}}),Object.defineProperty(this,"type",{get:function(){return this._fileType}})},FileTransfer.prototype.cancel=function(){var e=this._url+"/"+T+"/"+this._id,t=this;if(!this._id||this.state==FileTransfer.State.UPLOAD_COMPLETE||this.state==FileTransfer.State.DOWNLOAD_COMPLETE)throw Error("No active file transfer session");u.log("Terminating file transfer...");var n=new o(this._mediaServices._accessToken);n.open("GET",e,!0),n.setRequestHeader("Accept","application/json, text/html"),n.send(null),n.onreadystatechange=function(){if(4==n.readyState)if(204==n.status)u.log("File transfer terminated");else{var e=JSON.parse(n.responseText);u.log("File transfer termination failed: "+e.reason),_InternalError(t,FileTransfer.Error.NETWORK_FAILURE)}}},FileTransfer.prototype.onstatechange=function(){},FileTransfer.prototype.onerror=function(){},FileTransfer.State={},FileTransfer.State.IDLE=0,FileTransfer.State.INVITATION_SENT=1,FileTransfer.State.INVITATION_RECEIVED=2,FileTransfer.State.UPLOADING=3,FileTransfer.State.DOWNLOADING=4,FileTransfer.State.UPLOAD_COMPLETE=5,FileTransfer.State.DOWNLOAD_COMPLETE=6,FileTransfer.State.CANCELED=7,FileTransfer.State.ERROR=8,FileTransfer.Error={},FileTransfer.Error.NETWORK_FAILURE=0,FileTransfer.Error.FILE_SIZE_LIMIT=1,FileTransfer.Error.INVALID_USER=2,FileTransfer.Error.TIMEOUT=3,OutgoingFileTransfer=function(e,t){FileTransfer.prototype.constructor.call(this,e);var n=t;this._file=null,Object.defineProperty(this,"to",{get:function(){return n}}),Object.defineProperty(this,"file",{get:function(){return this._file}})},OutgoingFileTransfer.prototype.onuploadprogress=function(){},OutgoingFileTransfer.prototype=new FileTransfer,OutgoingFileTransfer.prototype.constructor=OutgoingCall,OutgoingFileTransfer.prototype.sendFile=function(e){if(!(e instanceof File))throw new TypeError("Invalid file");var t=this;this._file=e,this._fileType=e.type,this._fileName=e.name,this._fileSize=e.size;var n=this._url+"/"+_;u.log("Initiating file transfer...");var i={to:this.to,contentdisposition:"attachment",contenttype:this.type,filename:this.name,filesize:this.size},r=new o(this._mediaServices._accessToken);r.open("POST",n,!0),r.setRequestHeader("Accept","application/json, text/html"),r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify(i,null," ")),r.onreadystatechange=function(){if(4==r.readyState){var e=JSON.parse(r.responseText);202==r.status?(u.log("File invitation sent, ID: "+e.ftId+", state: "+e.state),t.state=FileTransfer.State.INVITATION_SENT,t._mediaServices._ftp.put(e.ftId,t)):(u.log("File invitation failed: "+e.reason),_InternalError(t,FileTransfer.Error.NETWORK_FAILURE))}}},OutgoingFileTransfer.prototype._uploadFile=function(){var e=this._url+"/"+S+"/"+this._id,t=this;t.state=FileTransfer.State.UPLOADING,u.log("Uploading file...");var n=new FormData;n.append("Filename",this._fileName),n.append("ClientId",this._mediaServices._sessionID),n.append("Filedata",this._file),n.append("Upload","Submit Query");var i=new o(this._mediaServices._accessToken);i.upload.addEventListener("progress",function(e){var n={loaded:e.loaded,total:e.total};t.onuploadprogress(n)},!1),i.open("POST",e,!0),i.setRequestHeader("Accept","application/json, text/html"),i.send(n),i.onreadystatechange=function(){if(4==i.readyState)if(204==i.status)u.log("File uploaded"),t.state!=FileTransfer.State.CANCELED&&(t.state=FileTransfer.State.UPLOAD_COMPLETE);else{var e=JSON.parse(i.responseText);u.log("File upload failed: "+e.reason),t.state!=FileTransfer.State.CANCELED&&t.state!=FileTransfer.State.ERROR&&(t.state=FileTransfer.State.CANCELED)}}},IncomingFileTransfer=function(e,t){FileTransfer.prototype.constructor.call(this,e),this._from=t,this._rawData=null,this._data=null,Object.defineProperty(this,"rawData",{get:function(){return this._rawData}}),Object.defineProperty(this,"data",{get:function(){return this._data}}),Object.defineProperty(this,"from",{get:function(){return this._from}})},IncomingFileTransfer.prototype.ondownloadprogress=function(){},IncomingFileTransfer.prototype.onreceivedfile=function(){},IncomingFileTransfer.prototype=new FileTransfer,IncomingFileTransfer.prototype.constructor=IncomingFileTransfer,IncomingFileTransfer.prototype.accept=function(){if(this.state==FileTransfer.State.UPLOAD_COMPLETE||this.state==FileTransfer.State.DOWNLOAD_COMPLETE)throw Error("No active file transfer session");var e=this._url+"/"+E+"/"+this._id,t=this;u.log("IncomingFileTransfer accepting...");var n=new o(this._mediaServices._accessToken);n.open("GET",e,!0),n.setRequestHeader("Accept","application/json, text/html"),n.send(null),n.onreadystatechange=function(){if(4==n.readyState)if(201==n.status)u.log("IncomingFileTransfer accepted");else{var e=JSON.parse(n.responseText);u.log("IncomingFileTransfer accept failed: "+e.reason),_InternalError(t,FileTransfer.Error.NETWORK_FAILURE)}}},IncomingFileTransfer.prototype._downloadFile=function(){var e=this._url+"/"+b+"/"+this._id,t=this,n=null;t.state=FileTransfer.State.DOWNLOADING,u.log("Downloading file...");var i=new o(this._mediaServices._accessToken);i.addEventListener("progress",function(e){var o={loaded:e.loaded,total:t.size};n=e.loaded,t.ondownloadprogress(o)},!1),i.open("GET",e,!0),i.overrideMimeType("text/plain; charset=x-user-defined"),i.send(null),i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status)t.state!=FileTransfer.State.CANCELED&&t.state!=FileTransfer.State.ERROR&&(i.responseText&&n==t.size?(t._rawData=i.responseText,t._data="data:"+t.type+";base64,"+_Base64encode(i.responseText),t.state=FileTransfer.State.DOWNLOAD_COMPLETE):t.state!=FileTransfer.State.CANCELED&&t.state!=FileTransfer.State.ERROR&&(t.state=FileTransfer.State.CANCELED));else{var e=JSON.parse(i.responseText);u.log("Downloading file failed: "+e.reason),_InternalError(t,FileTransfer.Error.NETWORK_FAILURE)}}},Chat=function(e,t){var n=Chat.State.NEW;this._mediaServices=e,Object.defineProperty(this,"state",{get:function(){return n},set:function(e){var t={type:"statechange",oldState:n,state:e};n=e,"function"==typeof this.onstatechange&&this.onstatechange(t),e!=Chat.State.ACTIVE&&e!=GroupChat.State.IN_PROGRESS||"function"!=typeof this.onbegin||this.onbegin(t),e==GroupChat.State.ENDED&&"function"==typeof this.onend&&this.onend(t)}}),Object.defineProperty(this,"recipient",{get:function(){return this._recipient}}),this._recipient=t,this._composingWait=!1,this._url=null},Chat.State={},Chat.State.NEW=0,Chat.State.ACTIVE=1,Chat.State.ERROR=3,Chat.Error={},Chat.Error.NETWORK_FAILURE=0,Chat.Error.INVALID_USER=1,Chat.Error.USER_NOT_ONLINE=2,Chat.prototype.send=function(e){var t=this;if(!e||"string"!=typeof e)throw Error("No body");u.log("Sending message...");var n=this._url+"/"+w;t._composingWait=!1;var i=new o(this._mediaServices._accessToken),r=null;r=this instanceof GroupChat?{confId:this.confID,body:e}:{to:this.recipient,body:e,contentType:"text/plain",type:"session-message"},i.open("POST",n,!0),i.setRequestHeader("Accept","application/json, text/html"),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(r,null," ")),i.onreadystatechange=function(){if(4==i.readyState){var e=JSON.parse(i.responseText);200==i.status?(u.log("Send message successful: msgId "+e.msgId),t.recipient&&(t._mediaServices._chat.get(t.recipient)||t._mediaServices._chat.put(t.recipient,t))):202==i.status?u.log("Send message successful: msgId "+e.msgId):400==i.status?_InternalError(t,Chat.Error.INVALID_USER):_InternalError(t,Chat.Error.NETWORK_FAILURE)}}},Chat.prototype.typing=function(){this._composingWait||this.state!=Chat.State.ACTIVE&&this.state!=GroupChat.State.IN_PROGRESS||(this._composingWait=!0,this._sendComposing("active",10))},Chat.prototype.idle=function(){!this._composingWait||this.state!=Chat.State.ACTIVE&&this.state!=GroupChat.State.IN_PROGRESS||(this._sendComposing("idle",10),this._composingWait=!1)},Chat.prototype._sendComposing=function(e,t){var n=this;if(this.state!=Chat.State.ACTIVE)throw Error("Unable to send composing event until the chat session is active");if("active"!=e&&"idle"!=e)throw Error("Invalid state");var i=this._url+"/"+I;u.log("Sending is-composing...");var r=new o(this._mediaServices._accessToken),s=null;s=this instanceof GroupChat?{confId:this.confID,state:e,refresh:t}:{to:this.recipient,state:e,refresh:t,contentType:"text/plain"},r.open("POST",i,!0),r.setRequestHeader("Accept","application/json, text/html"),r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify(s,null," ")),r.onreadystatechange=function(){if(4==r.readyState)if(204==r.status)u.log("Sending is-composing successful"),setTimeout(function(){n._composingWait=!1},1e3*t);else{u.log("Sending is-composing unsuccessful");var e=JSON.parse(r.responseText);if(403==r.status&&"no active session"==e.reason)throw Error("No active chat session");_InternalError(n,Chat.Error.NETWORK_FAILURE)}}},Chat.prototype.sendMedia=function(e){var t=this;if(!(e instanceof File))throw new TypeError("Invalid file type");if(this.state!=Chat.State.ACTIVE||this.state!=GroupChat.State.IN_PROGRESS)throw Error("Unable to send a media message until the chat session is active");if(-1==e.type.indexOf("image"))throw new TypeError("Invalid file type");if(e.size>H)throw Error("Media size too large, maximum: "+H+" current: "+e.size);u.log("Sending media message...");var n="";n=this instanceof GroupChat?this._url+"/"+M+this.confID:this._url+"/"+O+this.recipient;var i=new FormData;i.append("Filename",e.name),i.append("ClientId",this._mediaServices._sessionID),i.append("Filedata",e),i.append("Upload","Submit Query");var r=new o(this._mediaServices._accessToken);r.open("POST",n,!0),r.setRequestHeader("Accept","application/json, text/html"),r.send(i),r.onreadystatechange=function(){if(4==r.readyState){var e=JSON.parse(r.responseText);if(200==r.status)u.log("Send media message successful: msgId "+e.msgId);else if(202==r.status)u.log("Send media message successful: msgId "+e.msgId);else{if(u.log("Send media message unsuccessful"),403==r.status)throw Error("No active chat session");if(413==r.status)throw Error(e.reason);_InternalError(t,Chat.Error.NETWORK_FAILURE)}}}},Chat.prototype._getMedia=function(e,t){var n=this,i=this._url+"/"+N+e;u.log("Getting media message...");var r=new o(this._mediaServices._accessToken);r.open("GET",i,!0),r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(null),r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){u.log("Get media message successful");var e=r.getResponseHeader("Content-Type"),o={from:t,type:e,media:"data:"+e+";base64,"+_Base64encode(r.responseText),size:r.getResponseHeader("Content-Length")};n.onmessage(o)}else{var i=JSON.parse(r.responseText);u.log("Get media message unsuccessful: "+i.reason),_InternalError(_chat,Chat.Error.NETWORK_FAILURE)}}},Chat.prototype.onstatechange=function(){},Chat.prototype.onbegin=function(){},Chat.prototype.onmessage=function(){},Chat.prototype.onmessagefailure=function(){},Chat.prototype.oncomposing=function(){},Chat.prototype.onerror=function(){},GroupChat=function(e,t,n,o,i){var r=t,s=i;this._members=[],this._isOwner=!1,Chat.prototype.constructor.call(this,e,n),Object.defineProperty(this,"isOwner",{get:function(){return this._isOwner}}),Object.defineProperty(this,"subject",{get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"confID",{get:function(){return s},set:function(e){s=e}}),Object.defineProperty(this,"members",{get:function(){return this._members}})},GroupChat.prototype=new Chat,GroupChat.prototype.constructor=GroupChat,GroupChat.State={},GroupChat.State.NEW=0,GroupChat.State.IN_PROGRESS=1,GroupChat.State.ENDED=2,GroupChat.State.ERROR=3,GroupChat.Error={},GroupChat.Error.NETWORK_FAILURE=0,GroupChat.prototype.start=function(){var e=this,t=this._url+"/"+x,n=new o(this._mediaServices._accessToken),i={members:this.recipient,subject:this.subject};n.open("POST",t,!0),n.setRequestHeader("Accept","application/json, text/html"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(i,null," ")),n.onreadystatechange=function(){if(4==n.readyState)if(202==n.status){var t=JSON.parse(n.responseText),o=t.confId;e.confID=o,e._mediaServices._chat.put(o,e);for(var i=0;e.recipient.length>i;i++)e.members.push({entity:e.recipient[i],status:"invited"})}else{var t=JSON.parse(n.responseText);u.log("Create group chat fail reason: "+t.reason),_InternalError(e,GroupChat.Error.NETWORK_FAILURE)}}},GroupChat.prototype.leave=function(){var e=this;if(!this.confID)throw Error("No active group chat session to leave");var t=this._url+"/"+D;u.log("Leaving group chat...");var n=new o(this._mediaServices._accessToken),i={confId:this.confID};n.open("POST",t,!0),n.setRequestHeader("Accept","application/json, text/html"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(i,null," ")),n.onreadystatechange=function(){if(4==n.readyState)if(204==n.status)e.state=GroupChat.State.ENDED,e._mediaServices._chat.remove(e.confID),u.log("Leave group chat successful");else{var t=JSON.parse(n.responseText);u.log("Leave group chat unsuccessful: "+t.reason),_InternalError(e,GroupChat.Error.NETWORK_FAILURE)}}},GroupChat.prototype.add=function(e){var t=this;if("object"!=typeof e||!e||0==e.length)throw Error("Failed to add member in an ongoing group chat session, no new member defined");if(!this._isOwner)throw Error("Not allowed to add participant you are not the owner of the conference");for(var n=[],i=0;e.length>i;i++)for(var r=e[i],s=0;this.members.length>s;s++)if(-1==this.members[s].entity.indexOf(r)){n.push(r);break}if(0==n.length)throw Error("Unable to add existing member to chat");u.log("Adding participants to group chat");var a=this._url+"/"+k,c=new o(this._mediaServices._accessToken),l={confId:this.confID,members:n};c.open("POST",a,!0),c.setRequestHeader("Accept","application/json, text/html"),c.setRequestHeader("Content-Type","application/json"),c.send(JSON.stringify(l,null," ")),c.onreadystatechange=function(){if(4==c.readyState)if(204==c.status)u.log("Add participant successful");else{var e=JSON.parse(c.responseText);u.log("Add participant unsuccessful: "+e.reason),_InternalError(t,GroupChat.Error.NETWORK_FAILURE)}}},GroupChat.prototype.join=function(){var e=this;if(!this.confID||"string"!=typeof this.confID)throw Error("Invalid conference ID");u.log("Joining group chat "+this.confID+"...");var t=this._url+"/"+L,n=new o(this._mediaServices._accessToken),i={confId:this.confID};n.open("POST",t,!0),n.setRequestHeader("Accept","application/json, text/html"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(i,null," ")),n.onreadystatechange=function(){if(4==n.readyState)if(202==n.status)u.log("Join successful"),e.state=GroupChat.State.IN_PROGRESS,e._mediaServices._chat.put(e.confID,e);else{var t=JSON.parse(n.responseText);u.log("Join unsuccessful: "+t.reason),_InternalError(e,GroupChat.Error.NETWORK_FAILURE)}}},GroupChat.prototype.accept=function(){var e=this;if(!this.confID)throw Error("Unable to join group chat with invalid ID");u.log("Accepting...");var t=this._url+"/"+F,n=new o(this._mediaServices._accessToken),i={confId:this.confID};n.open("POST",t,!0),n.setRequestHeader("Accept","application/json, text/html"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(i,null," ")),n.onreadystatechange=function(){if(4==n.readyState)if(201==n.status)u.log("Accept successful"),e._mediaServices._chat.put(e.confID,e);else{var t=JSON.parse(n.responseText);u.log("Accept unsuccessful: "+t.reason),_InternalError(e,GroupChat.Error.NETWORK_FAILURE)}}},GroupChat.prototype.decline=function(){var e=this;if(!this.confID)throw Error("Failed to decline invitation to group chat, no conferenceID");u.log("Declining group chat invite...");var t=this._url+"/"+U,n=new o(this._mediaServices._accessToken),i={confId:this.confID};n.open("POST",t,!0),n.setRequestHeader("Accept","application/json, text/html"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(i,null," ")),n.onreadystatechange=function(){if(4==n.readyState)if(204==n.status)e.state=GroupChat.State.ENDED,u.log("Decline group chat invite successful"),e._mediaServices._chat.remove(e.confID);else{var t=JSON.parse(n.responseText);u.log("Decline group chat invite unsuccessful: "+t.reason),_InternalError(_groupChat,GroupChat.Error.NETWORK_FAILURE)}}},GroupChat.prototype.onend=function(){},GroupChat.prototype.onupdate=function(){},ContactList=function(e){var t=ContactList.State.NEW;this._url=null,this._contacts=[],this._syncId=null,this._mediaServices=e,Object.defineProperty(this,"size",{get:function(){return this._contacts.length}}),Object.defineProperty(this,"contact",{get:function(){return this._contacts}}),Object.defineProperty(this,"state",{get:function(){return t},set:function(e){var n={type:"statechange",oldState:t,state:e};t=e,"function"==typeof this.onstatechange&&this.onstatechange(n),e==ContactList.State.READY&&"function"==typeof this.onready&&this.onready({contactList:this})}})},ContactList.State={},ContactList.State.NEW=0,ContactList.State.READY=1,ContactList.State.ERROR=2,ContactList.prototype.update=function(){var e=this._url+C+"/"+R;this._syncId,u.log("Updating contact list...");var t=new o(this._mediaServices._accessToken);t.open("GET",e,!0),t.setRequestHeader("Accept","application/json, text/html"),t.send(null),t.onreadystatechange=function(){if(4==t.readyState)if(202==t.status)u.log("Update contact list finished");else{var e=JSON.parse(t.responseText);u.log("Update contact list failed: "+e.reason)}}},ContactList.prototype._parseContactList=function(e){for(var t=this.size,o=!1,i=0;;i++)try{for(var r=e[i],s=!1,a=0;this.size>a;a++)this.contact[a]._id==n(r.uri)&&(this.contact[a]._presenceState=r.state,s=!0,o=!0);if(!s){var c={numbers:[{number:r.uri}]},l=new Contact(c);l._mediaServices=this._mediaServices,l._url=this._url,l._id=n(r.uri),"true"==r.self&&(l._isSelf=!0),this.contact.push(l)}}catch(u){break}(this.size!=t||o)&&(this.state=ContactList.State.READY)},ContactList.prototype._parseAddressBook=function(e){for(var t=!1,o=0;;o++)try{var i=e[o],r=null;this._contacts[i.contactId]?(r=this._contacts[i.contactId],r.state=Contact.State.UPDATING,i.vcard&&(r.name=i.vcard.name,r.emails=i.vcard.emails,r.addresses=i.vcard.addresses,r.note=i.vcard.note,r.numbers=i.vcard.numbers,i.vcard.photo&&(r.photo="data:image/"+i.vcard.photoType+";base64,"+i.vcard.photo))):(r=new Contact(i.vcard),r._url=this._url,r._mediaServices=this._mediaServices),r._contactId=i.contactId;var s=n(this._mediaServices.username);if(i.vcard.numbers){var a=null;for(var c in i.vcard.numbers)i.vcard.numbers[c].primary&&(a=n("tel:"+i.vcard.numbers[c].number),a!=s||r._id||(r._isSelf=!0,r._id=n("tel:"+i.vcard.numbers[c].number)));
null==a&&(a=n("tel:"+i.vcard.numbers[0].number),a==s&&(r._isSelf=!0)),r._id||(r._id=a)}this._contacts[i.contactId]||(this._contacts[i.contactId]=r),r.state=Contact.State.UPDATED,t=!0}catch(l){break}t&&(this.state=ContactList.State.READY)},ContactList.prototype._parsePresenceList=function(e){for(var t=this,o=!1,i=0;;i++)try{var r=e[i];if(r===void 0)break;for(var s=n(r.entity),a=0;this.size>a;a++)this.contact[a]._id==s&&(this.contact[a].state=Contact.State.UPDATING,"0"==r.person.statusIconEtag?(this.contact[a]._avatar=null,t.state=ContactList.State.READY):r.person.statusIconEtag&&(this.contact[a].avatar&&r.person.statusIconEtag==this.contact[a].presence.statusIconEtag||(this.contact[a].presence=r.person,this.contact[a].presence.statusIconUrl=r.person.statusIconUrl.substring(r.person.statusIconUrl.indexOf("content/getavatar/"),r.person.statusIconUrl.length),this.contact[a].services=r.services,this.contact[a].getAvatar(function(e){1==e.success&&(t.state=ContactList.State.READY)}))),this.contact[a].presence=r.person,this.contact[a].services=r.services,"true"==r.self&&(this.contact[a]._isSelf=!0,this._mediaServices._tagline=r.person.freeText,this._mediaServices._homepage=r.person.homepage,this._mediaServices._willingness=r.person.willingness),this.contact[a].state=Contact.State.UPDATED);o=!0}catch(c){break}o&&(this.state=ContactList.State.READY)},ContactList.prototype.add=function(e){if(!(e&&e instanceof Contact))throw Error("Invalid contact");var t=this._url+C+"/"+R,n=this;u.log("Adding contact...");var i={vcard:{name:e.name,numbers:e.numbers,emails:e.emails,addresses:e.addresses,note:e.note},syncId:this._syncId},r=new o(this._mediaServices._accessToken);r.open("POST",t,!0),r.setRequestHeader("Accept","application/json, text/html"),r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify(i,null," ")),r.onreadystatechange=function(){if(4==r.readyState){var t=JSON.parse(r.responseText);201==r.status?(u.log("Add contact successful"),n._syncId=t.syncId,e._contactId=t.contactId,n.contact[e._contactId]=e):u.log("Add contact failed: "+t.reason)}}},ContactList.prototype.remove=function(e){if(!(e&&e instanceof Contact))throw Error("Invalid contact");if(e.isSelf)throw Error("Unable to perform action to self");if(e.unfollow(),""===e._contactId){var t=this.contact.indexOf(e);if(-1!=t)return this.contact.splice(t,1),u.log("Remove contact successful"),void 0;throw Error("Invalid contact")}var n=this._url+C+"/"+R+"/"+e._contactId;u.log("Removing contact...");var i={syncId:this._syncId},r=new o(this._mediaServices._accessToken);r.open("DELETE",n,!0),r.setRequestHeader("Accept","application/json, text/html"),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("X-http-method-override","DELETE"),r.send(JSON.stringify(i,null," ")),r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status)u.log("Remove contact successful");else{var e=JSON.parse(r.responseText);u.log("Remove contact failed: "+e.reason)}}},ContactList.prototype.modify=function(e){if(!(e&&e instanceof Contact))throw Error("Invalid contact");if(e.isSelf)throw Error("Unable to perform action to self");var t=this._url+C+"/"+R+"/"+e._contactId;u.log("Modifying contact...");var n={vcard:{name:e.name,numbers:e.numbers,emails:e.emails,addresses:e.addresses,note:e.note},syncId:this._syncId},i=new o(this._mediaServices._accessToken);i.open("POST",t,!0),i.setRequestHeader("Accept","application/json, text/html"),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(n,null," ")),i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status)u.log("Modify contact successful");else{var e=JSON.parse(i.responseText);u.log("Modify contact failed: "+e.reason)}}},ContactList.prototype.getAllAvatars=function(){for(var e=this,t=0;e.contact.length>t;t++)e.contact[t].presence&&e.contact[t].getAvatar(function(t){1==t.success&&(e.state=ContactList.State.READY)})},ContactList.prototype.onstatechange=function(){},ContactList.prototype.onready=function(){},ContactList.prototype.onpresenceinvite=function(){},ContactList.prototype.onerror=function(){},Contact=function(e){var t=Contact.State.NEW,n=null,o=[],i=[],r=[],s="",a="",c="",l="",u="",h=null,p=null;e&&(n=e.name,o=e.numbers,i=e.emails,r=e.addresses,s=e.note,a=e.org,c=e.title,l=e.birthday,e.photo&&(u="data:image/"+e.photoType+";base64,"+e.photo)),this._mediaServices=null,this._url=null,this._isSelf=!1,this._id="",this._contactId="",this._presenceState="",this._avatar=null,Object.defineProperty(this,"state",{get:function(){return t},set:function(e){t=e,e==Contact.State.UPDATING&&"function"==typeof this.onupdating?this.onupdating({contact:this}):e==Contact.State.UPDATED&&"function"==typeof this.onupdate&&this.onupdate({contact:this})}}),Object.defineProperty(this,"name",{get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"numbers",{get:function(){return o},set:function(e){o=e}}),Object.defineProperty(this,"emails",{get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"addresses",{get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"note",{get:function(){return s},set:function(e){s=e}}),Object.defineProperty(this,"org",{get:function(){return a},set:function(e){a=e}}),Object.defineProperty(this,"title",{get:function(){return c},set:function(e){c=e}}),Object.defineProperty(this,"birthday",{get:function(){return l},set:function(e){l=e}}),Object.defineProperty(this,"photo",{get:function(){return u},set:function(e){u=e}}),Object.defineProperty(this,"presenceState",{get:function(){return this._presenceState}}),Object.defineProperty(this,"presence",{get:function(){return h},set:function(e){h=e}}),Object.defineProperty(this,"services",{get:function(){return p},set:function(e){p=e}}),Object.defineProperty(this,"isSelf",{get:function(){return this._isSelf}}),Object.defineProperty(this,"avatar",{get:function(){return this._avatar}})},Contact.State={},Contact.State.NEW=0,Contact.State.UPDATING=1,Contact.State.UPDATED=2,Contact.prototype.follow=function(){if(this.isSelf)throw Error("Unable to perform action to self");var e=this._url+PRESENCE_RESOURCE+"/"+PRESENCE_RESOURCE_LIST+"/"+PRESENCE_RESOURCE_LIST_ADD;u.log("Following contact...");var t={username:"tel:+"+this._id},n=new o(this._mediaServices._accessToken);n.open("POST",e,!0),n.setRequestHeader("Accept","application/json, text/html"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t,null," ")),n.onreadystatechange=function(){if(4==n.readyState)if(204==n.status)u.log("Follow contact request sent");else{var e=JSON.parse(n.responseText);u.log("Follow contact failed: "+e.reason)}}},Contact.prototype.unfollow=function(){if(this.isSelf)throw Error("Unable to perform action to self");var e=this._url+PRESENCE_RESOURCE+"/"+PRESENCE_RESOURCE_LIST+"/"+PRESENCE_RESOURCE_LIST_REMOVE;u.log("Unfollowing contact...");var t={username:"tel:+"+this._id},n=new o(this._mediaServices._accessToken);n.open("POST",e,!0),n.setRequestHeader("Accept","application/json, text/html"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t,null," ")),n.onreadystatechange=function(){if(4==n.readyState)if(204==n.status)u.log("Unfollow contact successful");else{var e=JSON.parse(n.responseText);u.log("Unfollow contact failed: "+e.reason)}}},Contact.prototype.block=function(){if(this.isSelf)throw Error("Unable to perform action to self");var e=this._url+PRESENCE_RESOURCE+"/"+PRESENCE_RESOURCE_LIST+"/"+PRESENCE_RESOURCE_LIST_BLOCK;u.log("Blocking contact...");var t={username:"tel:+"+this._id},n=new o(this._mediaServices._accessToken);n.open("POST",e,!0),n.setRequestHeader("Accept","application/json, text/html"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t,null," ")),n.onreadystatechange=function(){if(4==n.readyState)if(204==n.status)u.log("Block contact successful");else{var e=JSON.parse(n.responseText);u.log("Block contact failed: "+e.reason)}}},Contact.prototype.getAvatar=function(e){var t=this;if(!this.presence.statusIconUrl)throw Error("User has no avatar");var n=this._url+this.presence.statusIconUrl;u.log("Getting avatar of "+this._id);var i=new o(this._mediaServices._accessToken);i.open("GET",n,!0),i.setRequestHeader("Accept","application/json, text/html"),i.overrideMimeType("text/plain; charset=x-user-defined"),i.send(null),i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status){u.log("Get avatar successful"),i.responseText;var n=i.getResponseHeader("Content-Type"),o="data:"+n+";base64,"+_Base64encode(i.responseText);if(t._avatar!=o){if(t.state=Contact.State.UPDATING,t._avatar=o,"function"==typeof e){var r={success:!0,failure:!1};e(r)}t.state=Contact.State.UPDATED}}else{var s=JSON.parse(i.responseText);if(u.log("Get avatar failed: "+s.reason),"function"==typeof e){var r={success:!1,failure:!0};e(r)}}}},Contact.prototype.onupdate=function(){},Contact.prototype.onupdating=function(){},_InternalError=function(e,t){try{if(e instanceof MediaServices?e.state=MediaServices.State.ERROR:e instanceof Conference?e.state=Conference.State.ERROR:e instanceof Call?e.state=Call.State.ERROR:e instanceof FileTransfer?e.state=FileTransfer.State.ERROR:e instanceof Chat?e.state=Chat.State.ERROR:e instanceof GroupChat?e.state=GroupChat.State.ERROR:e instanceof ContactList?e.state=ContactList.State.ERROR:e instanceof Contact&&(e.state=Contact.State.ERROR),"function"==typeof e.onerror){var n={type:"error",reason:t,target:e};e.onerror(n)}}catch(o){u.log("Invalid ERROR")}},_Base64encode=function(e){var t,n,o,i,r,s,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(o=e.length,n=0,t="";o>n;){if(i=255&e.charCodeAt(n++),n==o){t+=a.charAt(i>>2),t+=a.charAt((3&i)<<4),t+="==";break}if(r=e.charCodeAt(n++),n==o){t+=a.charAt(i>>2),t+=a.charAt((3&i)<<4|(240&r)>>4),t+=a.charAt((15&r)<<2),t+="=";break}s=e.charCodeAt(n++),t+=a.charAt(i>>2),t+=a.charAt((3&i)<<4|(240&r)>>4),t+=a.charAt((15&r)<<2|(192&s)>>6),t+=a.charAt(63&s)}return t};var q=function(){var e=[];return e.size=function(){return this.length},e.isEmpty=function(){return 0==this.length},e.contains=function(e){for(i in this)if(this[i].key==e)return i;return-1},e.get=function(e){var t=this.contains(e);return-1!==t?this[t].value:void 0},e.put=function(e,t){return-1==this.contains(e)?(this.push({key:e,value:t}),!0):!1},e.clear=function(){for(i in this)this.pop(i)},e.remove=function(e){var t=this.contains(e);t&&this.splice(t,1)},e.getAll=function(){return this},e}}(window),FABridge.TYPE_ASINSTANCE=1,FABridge.TYPE_ASFUNCTION=2,FABridge.TYPE_JSFUNCTION=3,FABridge.TYPE_ANONYMOUS=4,FABridge.initCallbacks={},FABridge.userTypes={},FABridge.addToUserTypes=function(){for(var e=0;arguments.length>e;e++)FABridge.userTypes[arguments[e]]={typeName:arguments[e],enriched:!1}},FABridge.argsToArray=function(e){for(var t=[],n=0;e.length>n;n++)t[n]=e[n];return t},FABridge.addInitializationCallback=function(e,t){var n=FABridge.instances[e];if(void 0!=n)return t.call(n),void 0;var o=FABridge.initCallbacks[e];null==o&&(FABridge.initCallbacks[e]=o=[]),o.push(t)},FABridge.nextBridgeID=0,FABridge.instances={},FABridge.idMap={},FABridge.refCount=0,FABridge.extractBridgeFromID=function(e){var t=e>>16;return FABridge.idMap[t]},FABridge.attachBridge=function(e,t){var n=new FABridge(e,t);FABridge[t]=n;var o=FABridge.initCallbacks[t];if(null!=o){for(var i=0;o.length>i;i++)o[i].call(n);delete FABridge.initCallbacks[t]}},FABridge.blockedMethods={toString:!0,get:!0,set:!0,call:!0},FABridge.prototype={root:function(){return this.deserialize(this.target.getRoot())},releaseASObjects:function(){return this.target.releaseASObjects()},releaseNamedASObject:function(e){if("object"!=typeof e)return!1;var t=this.target.releaseNamedASObject(e.fb_instance_id);return t},create:function(e){return this.deserialize(this.target.create(e))},makeID:function(e){return(this.bridgeID<<16)+e},getPropertyFromAS:function(e,t){if(FABridge.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");return FABridge.refCount++,retVal=this.target.getPropFromAS(e,t),retVal=this.handleError(retVal),FABridge.refCount--,retVal},setPropertyInAS:function(e,t,n){if(FABridge.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");return FABridge.refCount++,retVal=this.target.setPropInAS(e,t,this.serialize(n)),retVal=this.handleError(retVal),FABridge.refCount--,retVal},callASFunction:function(e,t){if(FABridge.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");return FABridge.refCount++,retVal=this.target.invokeASFunction(e,this.serialize(t)),retVal=this.handleError(retVal),FABridge.refCount--,retVal},callASMethod:function(e,t,n){if(FABridge.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");return FABridge.refCount++,n=this.serialize(n),retVal=this.target.invokeASMethod(e,t,n),retVal=this.handleError(retVal),FABridge.refCount--,retVal},invokeLocalFunction:function(e,t){var n,o=this.localFunctionCache[e];return void 0!=o&&(n=this.serialize(o.apply(null,this.deserialize(t)))),n},getUserTypeDescriptor:function(e){var t=e.replace(/^([^:]*)\:\:([^:]*)$/,"$2"),n="function"==typeof window[t]&&FABridge.userTypes[t]!==void 0,o=!1;n&&(o=FABridge.userTypes[t].enriched);var i={simpleType:t,isUserProto:n,protoEnriched:o};return i},getTypeFromName:function(e){var t=this.getUserTypeDescriptor(e),n=this.remoteTypeCache[e];if(t.isUserProto&&!t.protoEnriched){for(i in window[t.simpleType].prototype)n[i]=window[t.simpleType].prototype[i];window[t.simpleType].prototype=n,this.remoteTypeCache[e]=n,FABridge.userTypes[t.simpleType].enriched=!0}return n},createProxy:function(e,t){var n=this.getUserTypeDescriptor(t),o=this.getTypeFromName(t);if(n.isUserProto){var i=window[n.simpleType],r=new i(this.name,e);r.fb_instance_id=e}else{instanceFactory.prototype=o;var r=new instanceFactory(e)}return this.remoteInstanceCache[e]=r,r},getProxy:function(e){return this.remoteInstanceCache[e]},addTypeDataToCache:function(e){newType=new ASProxy(this,e.name);for(var t=e.accessors,n=0;t.length>n;n++)this.addPropertyToType(newType,t[n]);for(var o=e.methods,n=0;o.length>n;n++)void 0==FABridge.blockedMethods[o[n]]&&this.addMethodToType(newType,o[n]);return this.remoteTypeCache[newType.typeName]=newType,newType},addPropertyToType:function(e,t){var n,o,i=t.charAt(0);i>="a"&&"z">=i?(o="get"+i.toUpperCase()+t.substr(1),n="set"+i.toUpperCase()+t.substr(1)):(o="get"+t,n="set"+t),e[n]=function(e){this.bridge.setPropertyInAS(this.fb_instance_id,t,e)},e[o]=function(){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,t))}},addMethodToType:function(e,t){e[t]=function(){return this.bridge.deserialize(this.bridge.callASMethod(this.fb_instance_id,t,FABridge.argsToArray(arguments)))}},getFunctionProxy:function(e){var t=this;return null==this.remoteFunctionCache[e]&&(this.remoteFunctionCache[e]=function(){t.callASFunction(e,FABridge.argsToArray(arguments))}),this.remoteFunctionCache[e]},getFunctionID:function(e){return void 0==e.__bridge_id__&&(e.__bridge_id__=this.makeID(this.nextLocalFuncID++),this.localFunctionCache[e.__bridge_id__]=e),e.__bridge_id__},serialize:function(e){var t={},n=typeof e;if("number"==n||"string"==n||"boolean"==n||null==n||void 0==n)t=e;else if(e instanceof Array){t=[];for(var o=0;e.length>o;o++)t[o]=this.serialize(e[o])}else"function"==n?(t.type=FABridge.TYPE_JSFUNCTION,t.value=this.getFunctionID(e)):e instanceof ASProxy?(t.type=FABridge.TYPE_ASINSTANCE,t.value=e.fb_instance_id):(t.type=FABridge.TYPE_ANONYMOUS,t.value=e);return t},deserialize:function(e){var t,n=typeof e;if("number"==n||"string"==n||"boolean"==n||null==e||void 0==e)t=this.handleError(e);else if(e instanceof Array){t=[];for(var o=0;e.length>o;o++)t[o]=this.deserialize(e[o])}else if("object"==n){for(var o=0;e.newTypes.length>o;o++)this.addTypeDataToCache(e.newTypes[o]);for(var i in e.newRefs)this.createProxy(i,e.newRefs[i]);e.type==FABridge.TYPE_PRIMITIVE?t=e.value:e.type==FABridge.TYPE_ASFUNCTION?t=this.getFunctionProxy(e.value):e.type==FABridge.TYPE_ASINSTANCE?t=this.getProxy(e.value):e.type==FABridge.TYPE_ANONYMOUS&&(t=e.value)}return t},addRef:function(e){this.target.incRef(e.fb_instance_id)},release:function(e){this.target.releaseRef(e.fb_instance_id)},handleError:function(e){if("string"==typeof e&&0==e.indexOf("__FLASHERROR")){var t=e.split("||");throw FABridge.refCount>0&&FABridge.refCount--,Error(t[1])}return e}},ASProxy=function(e,t){return this.bridge=e,this.typeName=t,this},ASProxy.prototype={get:function(e){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,e))},set:function(e,t){this.bridge.setPropertyInAS(this.fb_instance_id,e,t)},call:function(e,t){this.bridge.callASMethod(this.fb_instance_id,e,t)},addRef:function(){this.bridge.addRef(this)},release:function(){this.bridge.release(this)}};var flensed={base_path:"//s.phono.com/deps/flensed/1.0/"};(function($){function Phono(e){if(this.config=Phono.util.extend({gateway:"gw-v4.d.phono.com",connectionUrl:window.location.protocol+"//app.phono.com/http-bind"},e),0==this.config.connectionUrl.indexOf("file:")&&(this.config.connectionUrl="https://app.phono.com/http-bind"),Phono.events.bind(this,e),!e.apiKey&&(this.config.apiKey=prompt("Please enter your Phono API Key.\n\nTo get a new one sign up for a free account at: http://www.phono.com"),!this.config.apiKey)){var t="A Phono API Key is required. Please get one at http://www.phono.com";throw Phono.events.trigger(this,"error",{reason:t}),t}this.sessionId=null,Phono.log.debug("ConnectionUrl: "+this.config.connectionUrl),this.connection=new Strophe.Connection(this.config.connectionUrl),navigator.appName.indexOf("Internet Explorer")>0?(xmlSerializer={},xmlSerializer.serializeToString=function(e){return e.xml}):xmlSerializer=new XMLSerializer,this.connection.xmlInput=function(e){Phono.log.debug("[WIRE] (i) "+xmlSerializer.serializeToString(e))},this.connection.xmlOutput=function(e){Phono.log.debug("[WIRE] (o) "+xmlSerializer.serializeToString(e))},Phono.util.loggify("Phono",this),this.connect()}(function(){function PluginManager(e,t,n){this.index=0,this.readyHandler=n,this.config=t,this.phono=e,this.pluginNames=Array();for(pluginName in Phono.plugins)this.pluginNames.push(pluginName)}Phono.util={guid:function(){return MD5.hexdigest(new String((new Date).getTime()))},escapeXmppNode:function(e){var t=e;return t=t.replace(/\\/g,"\\5c"),t=t.replace(/ /g,"\\20"),t=t.replace(/\"/,"\\22"),t=t.replace(/&/g,"\\26"),t=t.replace(/\'/,"\\27"),t=t.replace(/\//g,"\\2f"),t=t.replace(/:/g,"\\3a"),t=t.replace(/</g,"\\3c"),t=t.replace(/>/g,"\\3e"),t=t.replace(/@/g,"\\40")},each:function(e,t,n){var o,i=0,r=e.length,s=void 0===r||$.isFunction(e);if(n)if(s){for(o in e)if(t.apply(e[o],n)===!1)break}else for(;r>i&&t.apply(e[i++],n)!==!1;);else if(s){for(o in e)if(t.call(e[o],o,e[o])===!1)break}else for(var a=e[0];r>i&&t.call(a,i,a)!==!1;a=e[++i]);return e},isFunction:function(e){return"[object Function]"===toString.call(e)},isArray:function(e){return"[object Array]"===toString.call(e)},isPlainObject:function(e){if(!e||"[object Object]"!==toString.call(e)||e.nodeType||e.setInterval)return!1;if(e.constructor&&!hasOwnProperty.call(e,"constructor")&&!hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1;var t;for(t in e);return void 0===t||hasOwnProperty.call(e,t)},extend:function(){var e,t,n,o,i=arguments[0]||{},r=1,s=arguments.length,a=!1;for("boolean"==typeof i&&(a=i,i=arguments[1]||{},r=2),"object"==typeof i||$.isFunction(i)||(i={}),s===r&&(i=this,--r);s>r;r++)if(null!=(e=arguments[r]))for(t in e)if(n=i[t],o=e[t],i!==o)if(a&&o&&($.isPlainObject(o)||$.isArray(o))){var c=n&&($.isPlainObject(n)||$.isArray(n))?n:$.isArray(o)?[]:{};i[t]=$.extend(a,c,o)}else void 0!==o&&(i[t]=o);return i},eventCounter:1,addEvent:function(e,t,n){n.$$guid||(n.$$guid=this.eventCounter++),e.events||(e.events={});var o=e.events[t];o||(o=e.events[t]={},e["on"+t]&&(o[0]=e["on"+t])),o[n.$$guid]=n,e["on"+t]=handleEvent},removeEvent:function(e,t,n){e.events&&e.events[t]&&delete e.events[t][n.$$guid]},handleEvent:function(e){var t=!0,n=this.events[e.type];for(var o in n)this.$$handleEvent=n[o],this.$$handleEvent(e)===!1&&(t=!1);return t},parseUri:function(e){for(var t=["source","protocol","authority","domain","port","path","directoryPath","fileName","query","anchor"],n=RegExp("^(?:([^:/?#.]+):)?(?://)?(([^:/?#]*)(?::(\\d*))?)?((/(?:[^?#](?![^?#/]*\\.[^?#/.]+(?:[\\?#]|$)))*/?)?([^?#/]*))?(?:\\?([^#]*))?(?:#(.*))?").exec(e),o={},i=0;10>i;i++)o[t[i]]=n[i]?n[i]:"";return o.directoryPath.length>0&&(o.directoryPath=o.directoryPath.replace(/\/?$/,"/")),o},filterWideband:function(e,t){var n=Array();return Phono.util.each(e,function(){t?n.push(this):"G722"!=this.name.toUpperCase()&&"16000"!=this.rate&&n.push(this)}),n},isIOS:function(){var e=window.navigator.userAgent;return e.match(/iPad/i)||e.match(/iPhone/i)?!0:!1},isAndroid:function(){var e=window.navigator.userAgent;return e.match(/Android/i)?!0:!1},getIEVersion:function(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,n=RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=n.exec(t)&&(e=parseFloat(RegExp.$1))}return console.log("IE Version = "+e),e},localUri:function(e){var t=e.split(":");return t[0]+":"+t[1]+":"+t[2]},loggify:function(e,t){for(prop in t)"function"==typeof t[prop]&&Phono.util.loggyFunction(e,t,prop);return t},loggyFunction:function(e,t,n){var o=t[n];t[n]=function(){for(var i="",r="",s=0;arguments.length>s;s++)r+=i+arguments[s],i=",";return Phono.log.debug("[INVOKE] "+e+"."+n+"("+r+")"),o.apply(t,arguments)}},padWithZeroes:function(e,t){for(var n=""+e;t>n.length;)n="0"+n;return n},padWithSpaces:function(e,t){for(;t>e.length;)e+=" ";return e},srtpProps:function(e,t,n,o,i){var r="";return void 0!=t&&(r=r+"crypto-suite="+"'"+t+"' \n"),void 0!=e&&(r=r+"tag="+"'"+e+"' \n"),void 0!=n&&(r=r+"key-params="+"'"+n+"' \n"),void 0!=o&&(r=r+"session-params="+"'"+sessionprams+"' \n"),void 0!=i&&(r=r+"required="+"'"+i+"' \n"),r},genKey:function(e){var t,n="";for(t=0;e>t;t++)n+=String.fromCharCode(256*Math.random());return Base64.encode(n)}};var PhonoLogger=function(){var e=this;e.eventQueue=[],e.initialized=!1,$(document).ready(function(){("undefined"==typeof console||console.log===void 0)&&(console={},console.log=function(){}),console.log("Phono Logger Initialized"),e.initialized=!0,e.flushEventQueue()})};(function(){function e(e){return e.message?e.message:e.description?e.description:toStr(e)}function t(e){var t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return e.substr(t+1)}function n(n){if(n){var o="Exception: "+e(n);try{n.lineNumber&&(o+=" on line number "+n.lineNumber),n.fileName&&(o+=" in file "+t(n.fileName))}catch(r){}return showStackTraces&&n.stack&&(o+=i+"Stack trace:"+i+n.stack),o}return null}function o(e){return e instanceof Error}var i="\r\n",r=function(e,t,n,o){this.timeStamp=e,this.level=t,this.messages=n,this.exception=o};r.prototype={getThrowableStrRep:function(){return this.exception?n(this.exception):""},getCombinedMessages:function(){return 1===this.messages.length?this.messages[0]:this.messages.join(i)}};var s=function(e,t){this.level=e,this.name=t};s.prototype={toString:function(){return this.name},equals:function(e){return this.level==e.level},isGreaterOrEqual:function(e){return this.level>=e.level}},s.ALL=new s(Number.MIN_VALUE,"ALL"),s.TRACE=new s(1e4,"TRACE"),s.DEBUG=new s(2e4,"DEBUG"),s.INFO=new s(3e4,"INFO"),s.WARN=new s(4e4,"WARN"),s.ERROR=new s(5e4,"ERROR"),s.FATAL=new s(6e4,"FATAL"),s.OFF=new s(Number.MAX_VALUE,"OFF"),PhonoLogger.prototype.log=function(e,t){var n,i=t.length-1,s=t[t.length-1];t.length>1&&o(s)&&(n=s,i--);for(var a=[],c=0;i>=c;c++)a[c]=t[c];var l=new r(new Date,e,a,n);this.eventQueue.push(l),this.flushEventQueue()},PhonoLogger.prototype.flushEventQueue=function(){if(this.initialized){var e=this;Phono.util.each(this.eventQueue,function(t,n){Phono.events.trigger(e,"log",n)}),this.eventQueue=[]}},PhonoLogger.prototype.debug=function(){this.log(s.DEBUG,arguments)},PhonoLogger.prototype.info=function(){this.log(s.INFO,arguments)},PhonoLogger.prototype.warn=function(){this.log(s.WARN,arguments)},PhonoLogger.prototype.error=function(){this.log(s.ERROR,arguments)}})(),Phono.version="0.5",Phono.log=new PhonoLogger,Phono.registerPlugin=function(e,t){Phono.plugins||(Phono.plugins={}),Phono.plugins[e]=t},Phono.prototype.connect=function(){if(!this.connection.connected){var e=this;this.connection.connect(e.config.gateway,null,function(t){t===Strophe.Status.CONNECTED?(e.connection.send($iq({type:"set"}).c("apikey",{xmlns:"http://phono.com/apikey"}).t(e.config.apiKey)),e.handleConnect()):t===Strophe.Status.DISCONNECTED?e.handleDisconnect():(t===Strophe.Status.ERROR||t===Strophe.Status.CONNFAIL||t===Strophe.Status.CONNFAIL||t===Strophe.Status.AUTHFAIL)&&e.handleError()},50)}},Phono.prototype.disconnect=function(){this.connection.disconnect()},Phono.prototype.connected=function(){return this.connection.connected},Phono.prototype.handleConnect=function(){this.sessionId=Strophe.getBareJidFromJid(this.connection.jid),new PluginManager(this,this.config,function(){Phono.events.trigger(this,"ready")}).init()},Phono.prototype.handleError=function(){Phono.events.trigger(this,"error",{reason:"Error connecting to XMPP server"})},Phono.prototype.handleDisconnect=function(){Phono.events.trigger(this,"unready")},function(e){var t=e,n=e.document,o="undefined",i=!0,r=!1,s="",a="object",c="function",l="string",u="div",h="onunload",p=null,d=null,f=null,g=null,m=0,v=[],y=null,_=null,S="flXHR.js",E="flensed.js",T="flXHR.vbs",b="checkplayer.js",C="flXHR.swf",R=e.parseInt,A=e.setTimeout,w=e.clearTimeout,I=(e.setInterval,e.clearInterval,"instanceId"),O="readyState",N="onreadystatechange",P="ontimeout",x="onerror",D="binaryResponseBody",k="xmlResponseText",L="loadPolicyURL",F="noCacheHeader",U="sendTimeout",M="appendToId",j="swfIdPrefix";typeof e.flensed===o&&(e.flensed={}),typeof e.flensed.flXHR===o&&(d=e.flensed,A(function(){function a(e,t,i){for(var r=0;m>r&&!(typeof p[r].src!==o&&p[r].src.indexOf(e)>=0);r++);var s=n.createElement("script");s.setAttribute("src",d.base_path+e),typeof t!==o&&s.setAttribute("type",t),typeof i!==o&&s.setAttribute("language",i),n.getElementsByTagName("head")[0].appendChild(s)}function c(){w(I);try{t.detachEvent(h,c)}catch(e){}}function l(){w(N);try{t.detachEvent(h,l)}catch(e){}}var u=r,p=n.getElementsByTagName("script"),m=p.length;try{d.base_path.toLowerCase(),u=i}catch(v){d.base_path=s}if(typeof p!==o&&null!==p&&!u)for(var y=0,C=0;m>C;C++)if(typeof p[C].src!==o&&((y=p[C].src.indexOf(E))>=0||(y=p[C].src.indexOf(S))>=0)){d.base_path=p[C].src.substr(0,y);break}try{d.checkplayer.module_ready()}catch(R){a(b,"text/javascript")}var I=null;if(function(){try{d.ua.pv.join(".")}catch(n){return I=A(arguments.callee,25),void 0}d.ua.win&&d.ua.ie&&a(T,"text/vbscript","vbscript"),d.binaryToString=function(e,t){if(t=d.ua.win&&d.ua.ie&&typeof t!==o?!!t:!(d.ua.win&&d.ua.ie),!t)try{return flXHR_vb_BinaryToString(e)}catch(n){}var i=s,r=[];try{for(var a=0;e.length>a;a++)r[r.length]=String.fromCharCode(e[a]);i=r.join(s)}catch(c){}return i},d.bindEvent(t,h,function(){try{e.flensed.unbindEvent(t,h,arguments.callee);for(var n in _)if(_[n]!==Object.prototype[n])try{_[n]=null}catch(o){}d.flXHR=null,_=null,d=null,g=null,f=null}catch(i){}})}(),null!==I)try{t.attachEvent(h,c)}catch(O){}var N=null;try{t.attachEvent(h,l)}catch(P){}N=A(function(){l();try{d.checkplayer.module_ready()}catch(t){throw new e.Error("flXHR dependencies failed to load.")}},2e4)},0),d.flXHR=function(S){function E(){Rt=null===Ft?n.getElementsByTagName("body")[0]:d.getObjectById(Ft);try{Rt.nodeName.toLowerCase(),d.checkplayer.module_ready(),f=d.checkplayer}catch(e){return pt=A(E,25),void 0}if(null===g&&typeof f._ins===o)try{g=new f(_.MIN_PLAYER_VERSION,Z,r,et)}catch(t){return W(_.DEPENDENCY_ERROR,"flXHR: checkplayer Init Failed","The initialization of the 'checkplayer' library failed to complete."),void 0}else g=f._ins,T()}function T(){if(null===g||!g.checkPassed)return pt=A(T,25),void 0;null===y&&null===Ft&&(d.createCSS("."+Lt,"left:-1px;top:0px;width:1px;height:1px;position:absolute;"),y=i);var e=n.createElement(u);e.id=gt,e.className=Lt,Rt.appendChild(e),Rt=null;var t={},o={allowScriptAccess:"always"},r={id:gt,name:gt,styleclass:Lt},s={swfCB:b,swfEICheck:"reset"};try{g.DoSWF(d.base_path+C,gt,"1","1",t,o,r,s)}catch(a){return W(_.DEPENDENCY_ERROR,"flXHR: checkplayer Call Failed","A call to the 'checkplayer' library failed to complete."),void 0}}function b(e){if(e.status===f.SWF_EI_READY){if($(),bt=d.getObjectById(gt),bt.setId(gt),Mt!==s&&bt.loadPolicy(Mt),bt.autoNoCacheHeader(Nt),bt.returnBinaryResponseBody(Pt),bt.doOnReadyStateChange=G,bt.doOnError=W,bt.sendProcessed=tt,bt.chunkResponse=q,mt=0,K(),Y(),typeof jt===c)try{jt(Ct)}catch(t){return W(_.HANDLER_ERROR,"flXHR::onreadystatechange(): Error","An error occurred in the handler function. ("+t.message+")"),void 0}z()}}function H(){try{e.flensed.unbindEvent(t,h,H)}catch(n){}try{for(var i=0;v.length>i;i++)v[i]===Ct&&(v[i]=r)}catch(s){}try{for(var a in Ct)if(Ct[a]!==Object.prototype[a])try{Ct[a]=null}catch(c){}}catch(l){}if(Ct=null,$(),typeof bt!==o&&null!==bt){try{bt.abort()}catch(u){}try{bt.doOnReadyStateChange=null,G=null}catch(p){}try{bt.doOnError=null,doOnError=null}catch(d){}try{bt.sendProcessed=null,tt=null}catch(f){}try{bt.chunkResponse=null,q=null}catch(g){}bt=null;try{e.swfobject.removeSWF(gt)}catch(m){}}V(),jt=null,Ht=null,qt=null,St=null,yt=null,At=null,Rt=null}function q(){Pt&&typeof arguments[0]!==o?(At=null!==At?At:[],At=At.concat(arguments[0])):typeof arguments[0]===l&&(At=null!==At?At:s,At+=arguments[0])}function G(){if(typeof arguments[0]!==o&&(mt=arguments[0]),4===mt){if($(),Pt&&null!==At)try{_t=d.binaryToString(At,i);try{yt=flXHR_vb_StringToBinary(_t)}catch(e){yt=At}}catch(t){}else _t=At;if(At=null,_t!==s&&xt)try{St=d.parseXMLString(_t)}catch(n){St={}}}typeof arguments[1]!==o&&(Et=arguments[1]),typeof arguments[2]!==o&&(Tt=arguments[2]),B(mt)}function B(e){if(vt=e,K(),Y(),Ct[O]=Math.max(0,e),typeof jt===c)try{jt(Ct)}catch(t){return W(_.HANDLER_ERROR,"flXHR::onreadystatechange(): Error","An error occurred in the handler function. ("+t.message+")"),void 0}}function W(){function e(){function e(){return t+", "+n+", "+o}this.number=0,this.name="flXHR Error: Unknown",this.description="Unknown error from 'flXHR' library.",this.message=this.description,this.srcElement=Ct;var t=this.number,n=this.name,o=this.description;this.toString=e}function t(){function e(){return t+", "+n+", "+o}this.number=_.HANDLER_ERROR,this.name="flXHR::onerror(): Error",this.description="An error occured in the handler function. ("+a.message+")\nPrevious:["+l+"]",this.message=this.description,this.srcElement=Ct;var t=this.number,n=this.name,o=this.description;this.toString=e}$(),V(),It=i;var n;try{n=new d.error(arguments[0],arguments[1],arguments[2],Ct)}catch(o){n=new e}var s=r;try{typeof Ht===c&&(Ht(n),s=i)}catch(a){var l=""+n;n=new t}s||A(function(){d.throwUnhandledError(""+n)},1)}function J(){if(nt(),It=i,typeof qt===c)try{qt(Ct)}catch(e){return W(_.HANDLER_ERROR,"flXHR::ontimeout(): Error","An error occurred in the handler function. ("+e.message+")"),void 0}else W(_.TIMEOUT_ERROR,"flXHR: Operation Timed out","The requested operation timed out.")}function $(){w(pt),pt=null,w(ft),ft=null,w(dt),dt=null}function X(e,t,n){ht[ht.length]={func:e,funcName:t,args:n},wt=r}function V(){if(!wt){wt=i;for(var e=ht.length,t=0;e>t;t++)try{ht[t]=r}catch(n){}ht=[]
}}function z(){if(0>mt)return dt=A(z,25),void 0;if(!wt){for(var e=0;ht.length>e;e++)try{ht[e]!==r&&(ht[e].func.apply(Ct,ht[e].args),ht[e]=r)}catch(t){return W(_.HANDLER_ERROR,"flXHR::"+ht[e].funcName+"(): Error","An error occurred in the "+ht[e].funcName+"() function."),void 0}wt=i}}function Y(){try{Ct[I]=Ot,Ct[O]=vt,Ct.status=Et,Ct.statusText=Tt,Ct.responseText=_t,Ct.responseXML=St,Ct.responseBody=yt,Ct[N]=jt,Ct[x]=Ht,Ct[P]=qt,Ct[L]=Mt,Ct[F]=Nt,Ct[D]=Pt,Ct[k]=xt}catch(e){}}function K(){try{Ot=Ct[I],null!==Ct.timeout&&(p=R(Ct.timeout,10))>0&&(Ut=p),jt=Ct[N],Ht=Ct[x],qt=Ct[P],null!==Ct[L]&&(Ct[L]!==Mt&&mt>=0&&bt.loadPolicy(Ct[L]),Mt=Ct[L]),null!==Ct[F]&&(Ct[F]!==Nt&&mt>=0&&bt.autoNoCacheHeader(Ct[F]),Nt=Ct[F]),null!==Ct[D]&&(Ct[D]!==Pt&&mt>=0&&bt.returnBinaryResponseBody(Ct[D]),Pt=Ct[D]),null!==xt&&(xt=!!Ct[k])}catch(e){}}function Q(){nt();try{bt.reset()}catch(e){}Et=null,Tt=null,_t=null,St=null,yt=null,At=null,It=r,Y(),Mt=s,K()}function Z(e){e.checkPassed?T():Dt?g.UpdatePlayer():W(_.PLAYER_VERSION_ERROR,"flXHR: Insufficient Flash Player Version","The Flash Player was either not detected, or the detected version ("+e.playerVersionDetected+") was not at least the minimum version ("+_.MIN_PLAYER_VERSION+") needed by the 'flXHR' library.")}function et(e){e.updateStatus===f.UPDATE_CANCELED?W(_.PLAYER_VERSION_ERROR,"flXHR: Flash Player Update Canceled","The Flash Player was not updated."):e.updateStatus===f.UPDATE_FAILED&&W(_.PLAYER_VERSION_ERROR,"flXHR: Flash Player Update Failed","The Flash Player was either not detected or could not be updated.")}function tt(){null!==Ut&&Ut>0&&(ft=A(J,Ut))}function nt(){$(),V(),K(),mt=0,vt=0;try{bt.abort()}catch(e){W(_.CALL_ERROR,"flXHR::abort(): Failed","The abort() call failed to complete.")}Y()}function ot(){if(K(),typeof arguments[0]===o||typeof arguments[1]===o)W(_.CALL_ERROR,"flXHR::open(): Failed","The open() call requires 'method' and 'url' parameters.");else{(mt>0||It)&&Q(),0===vt?G(1):mt=1;var e=arguments[0],t=arguments[1],n=typeof arguments[2]!==o?arguments[2]:i,r=typeof arguments[3]!==o?arguments[3]:s,a=typeof arguments[4]!==o?arguments[4]:s;try{bt.autoNoCacheHeader(Nt),bt.open(e,t,n,r,a)}catch(c){W(_.CALL_ERROR,"flXHR::open(): Failed","The open() call failed to complete.")}}}function it(){if(K(),1>=mt&&!It){var e=typeof arguments[0]!==o?arguments[0]:s;1===vt?G(2):mt=2;try{bt.autoNoCacheHeader(Nt),bt.send(e)}catch(t){W(_.CALL_ERROR,"flXHR::send(): Failed","The send() call failed to complete.")}}else W(_.CALL_ERROR,"flXHR::send(): Failed","The send() call cannot be made at this time.")}function rt(){if(K(),typeof arguments[0]===o||typeof arguments[1]===o)W(_.CALL_ERROR,"flXHR::setRequestHeader(): Failed","The setRequestHeader() call requires 'name' and 'value' parameters.");else if(!It){var e=typeof arguments[0]!==o?arguments[0]:s,t=typeof arguments[1]!==o?arguments[1]:s;try{bt.setRequestHeader(e,t)}catch(n){W(_.CALL_ERROR,"flXHR::setRequestHeader(): Failed","The setRequestHeader() call failed to complete.")}}}function st(){return K(),s}function at(){return K(),[]}var ct=r;if(null!==S&&typeof S===a&&typeof S.instancePooling!==o&&(ct=!!S.instancePooling)){var lt=function(){for(var e=0;v.length>e;e++){var t=v[e];if(4===t[O])return t.Reset(),t.Configure(S),t}return null}();if(null!==lt)return lt}var ut=++m,ht=[],pt=null,dt=null,ft=null,gt=null,mt=-1,vt=0,yt=null,_t=null,St=null,Et=null,Tt=null,bt=null,Ct=null,Rt=null,At=null,wt=i,It=r,Ot="flXHR_"+ut,Nt=i,Pt=r,xt=i,Dt=r,kt="flXHR_swf",Lt="flXHRhideSwf",Ft=null,Ut=-1,Mt=s,jt=null,Ht=null,qt=null;return function(){function e(){w(pt);try{t.detachEvent(h,e)}catch(n){}}typeof S===a&&null!==S&&(typeof S[I]!==o&&null!==S[I]&&S[I]!==s&&(Ot=S[I]),typeof S[j]!==o&&null!==S[j]&&S[j]!==s&&(kt=S[j]),typeof S[M]!==o&&null!==S[M]&&S[M]!==s&&(Ft=S[M]),typeof S[L]!==o&&null!==S[L]&&S[L]!==s&&(Mt=S[L]),typeof S[F]!==o&&(Nt=!!S[F]),typeof S[D]!==o&&(Pt=!!S[D]),typeof S[k]!==o&&(xt=!!S[k]),typeof S.autoUpdatePlayer!==o&&(Dt=!!S.autoUpdatePlayer),typeof S[U]!==o&&(p=R(S[U],10))>0&&(Ut=p),typeof S[N]!==o&&null!==S[N]&&(jt=S[N]),typeof S[x]!==o&&null!==S[x]&&(Ht=S[x]),typeof S[P]!==o&&null!==S[P]&&(qt=S[P])),gt=kt+"_"+ut;try{t.attachEvent(h,e)}catch(n){}(function(){try{d.bindEvent(t,h,H)}catch(n){return pt=A(arguments.callee,25),void 0}e(),pt=A(E,1)})()}(),Ct={readyState:vt,responseBody:yt,responseText:_t,responseXML:St,status:Et,statusText:Tt,timeout:Ut,open:function(){return K(),0===Ct[O]&&B(1),!wt||0>mt?(X(ot,"open",arguments),void 0):(ot.apply({},arguments),void 0)},send:function(){return K(),1===Ct[O]&&B(2),!wt||0>mt?(X(it,"send",arguments),void 0):(it.apply({},arguments),void 0)},abort:nt,setRequestHeader:function(){return K(),!wt||0>mt?(X(rt,"setRequestHeader",arguments),void 0):(rt.apply({},arguments),void 0)},getResponseHeader:st,getAllResponseHeaders:at,onreadystatechange:jt,ontimeout:qt,instanceId:Ot,loadPolicyURL:Mt,noCacheHeader:Nt,binaryResponseBody:Pt,xmlResponseText:xt,onerror:Ht,Configure:function(e){typeof e===a&&null!==e&&(typeof e[I]!==o&&null!==e[I]&&e[I]!==s&&(Ot=e[I]),typeof e[F]!==o&&(Nt=!!e[F],mt>=0&&bt.autoNoCacheHeader(Nt)),typeof e[D]!==o&&(Pt=!!e[D],mt>=0&&bt.returnBinaryResponseBody(Pt)),typeof e[k]!==o&&(xt=!!e[k]),typeof e[N]!==o&&null!==e[N]&&(jt=e[N]),typeof e[x]!==o&&null!==e[x]&&(Ht=e[x]),typeof e[P]!==o&&null!==e[P]&&(qt=e[P]),typeof e[U]!==o&&(p=R(e[U],10))>0&&(Ut=p),typeof e[L]!==o&&null!==e[L]&&e[L]!==s&&e[L]!==Mt&&(Mt=e[L],mt>=0&&bt.loadPolicy(Mt)),Y())},Reset:Q,Destroy:H},ct&&(v[v.length]=Ct),Ct},_=d.flXHR,_.HANDLER_ERROR=10,_.CALL_ERROR=11,_.TIMEOUT_ERROR=12,_.DEPENDENCY_ERROR=13,_.PLAYER_VERSION_ERROR=14,_.SECURITY_ERROR=15,_.COMMUNICATION_ERROR=16,_.MIN_PLAYER_VERSION="9.0.124",_.module_ready=function(){})}(window);var Base64=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t={encode:function(t){var n,o,i,r,s,a,c,l="",u=0;do n=t.charCodeAt(u++),o=t.charCodeAt(u++),i=t.charCodeAt(u++),r=n>>2,s=(3&n)<<4|o>>4,a=(15&o)<<2|i>>6,c=63&i,isNaN(o)?a=c=64:isNaN(i)&&(c=64),l=l+e.charAt(r)+e.charAt(s)+e.charAt(a)+e.charAt(c);while(t.length>u);return l},decode:function(t){var n,o,i,r,s,a,c,l="",u=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=e.indexOf(t.charAt(u++)),s=e.indexOf(t.charAt(u++)),a=e.indexOf(t.charAt(u++)),c=e.indexOf(t.charAt(u++)),n=r<<2|s>>4,o=(15&s)<<4|a>>2,i=(3&a)<<6|c,l+=String.fromCharCode(n),64!=a&&(l+=String.fromCharCode(o)),64!=c&&(l+=String.fromCharCode(i));while(t.length>u);return l}};return t}(),MD5=function(){var e=0,t="",n=8,o=function(e,t){var n=(65535&e)+(65535&t),o=(e>>16)+(t>>16)+(n>>16);return o<<16|65535&n},i=function(e,t){return e<<t|e>>>32-t},r=function(e){for(var t=[],o=(1<<n)-1,i=0;e.length*n>i;i+=n)t[i>>5]|=(e.charCodeAt(i/n)&o)<<i%32;return t},s=function(e){for(var t="",o=(1<<n)-1,i=0;32*e.length>i;i+=n)t+=String.fromCharCode(e[i>>5]>>>i%32&o);return t},a=function(t){for(var n=e?"0123456789ABCDEF":"0123456789abcdef",o="",i=0;4*t.length>i;i++)o+=n.charAt(15&t[i>>2]>>8*(i%4)+4)+n.charAt(15&t[i>>2]>>8*(i%4));return o},c=function(e){for(var n,o,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",s=0;4*e.length>s;s+=3)for(n=(255&e[s>>2]>>8*(s%4))<<16|(255&e[s+1>>2]>>8*((s+1)%4))<<8|255&e[s+2>>2]>>8*((s+2)%4),o=0;4>o;o++)r+=8*s+6*o>32*e.length?t:i.charAt(63&n>>6*(3-o));return r},l=function(e,t,n,r,s,a){return o(i(o(o(t,e),o(r,a)),s),n)},u=function(e,t,n,o,i,r,s){return l(t&n|~t&o,e,t,i,r,s)},h=function(e,t,n,o,i,r,s){return l(t&o|n&~o,e,t,i,r,s)},p=function(e,t,n,o,i,r,s){return l(t^n^o,e,t,i,r,s)},d=function(e,t,n,o,i,r,s){return l(n^(t|~o),e,t,i,r,s)},f=function(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var n,i,r,s,a=1732584193,c=-271733879,l=-1732584194,f=271733878,g=0;e.length>g;g+=16)n=a,i=c,r=l,s=f,a=u(a,c,l,f,e[g+0],7,-680876936),f=u(f,a,c,l,e[g+1],12,-389564586),l=u(l,f,a,c,e[g+2],17,606105819),c=u(c,l,f,a,e[g+3],22,-1044525330),a=u(a,c,l,f,e[g+4],7,-176418897),f=u(f,a,c,l,e[g+5],12,1200080426),l=u(l,f,a,c,e[g+6],17,-1473231341),c=u(c,l,f,a,e[g+7],22,-45705983),a=u(a,c,l,f,e[g+8],7,1770035416),f=u(f,a,c,l,e[g+9],12,-1958414417),l=u(l,f,a,c,e[g+10],17,-42063),c=u(c,l,f,a,e[g+11],22,-1990404162),a=u(a,c,l,f,e[g+12],7,1804603682),f=u(f,a,c,l,e[g+13],12,-40341101),l=u(l,f,a,c,e[g+14],17,-1502002290),c=u(c,l,f,a,e[g+15],22,1236535329),a=h(a,c,l,f,e[g+1],5,-165796510),f=h(f,a,c,l,e[g+6],9,-1069501632),l=h(l,f,a,c,e[g+11],14,643717713),c=h(c,l,f,a,e[g+0],20,-373897302),a=h(a,c,l,f,e[g+5],5,-701558691),f=h(f,a,c,l,e[g+10],9,38016083),l=h(l,f,a,c,e[g+15],14,-660478335),c=h(c,l,f,a,e[g+4],20,-405537848),a=h(a,c,l,f,e[g+9],5,568446438),f=h(f,a,c,l,e[g+14],9,-1019803690),l=h(l,f,a,c,e[g+3],14,-187363961),c=h(c,l,f,a,e[g+8],20,1163531501),a=h(a,c,l,f,e[g+13],5,-1444681467),f=h(f,a,c,l,e[g+2],9,-51403784),l=h(l,f,a,c,e[g+7],14,1735328473),c=h(c,l,f,a,e[g+12],20,-1926607734),a=p(a,c,l,f,e[g+5],4,-378558),f=p(f,a,c,l,e[g+8],11,-2022574463),l=p(l,f,a,c,e[g+11],16,1839030562),c=p(c,l,f,a,e[g+14],23,-35309556),a=p(a,c,l,f,e[g+1],4,-1530992060),f=p(f,a,c,l,e[g+4],11,1272893353),l=p(l,f,a,c,e[g+7],16,-155497632),c=p(c,l,f,a,e[g+10],23,-1094730640),a=p(a,c,l,f,e[g+13],4,681279174),f=p(f,a,c,l,e[g+0],11,-358537222),l=p(l,f,a,c,e[g+3],16,-722521979),c=p(c,l,f,a,e[g+6],23,76029189),a=p(a,c,l,f,e[g+9],4,-640364487),f=p(f,a,c,l,e[g+12],11,-421815835),l=p(l,f,a,c,e[g+15],16,530742520),c=p(c,l,f,a,e[g+2],23,-995338651),a=d(a,c,l,f,e[g+0],6,-198630844),f=d(f,a,c,l,e[g+7],10,1126891415),l=d(l,f,a,c,e[g+14],15,-1416354905),c=d(c,l,f,a,e[g+5],21,-57434055),a=d(a,c,l,f,e[g+12],6,1700485571),f=d(f,a,c,l,e[g+3],10,-1894986606),l=d(l,f,a,c,e[g+10],15,-1051523),c=d(c,l,f,a,e[g+1],21,-2054922799),a=d(a,c,l,f,e[g+8],6,1873313359),f=d(f,a,c,l,e[g+15],10,-30611744),l=d(l,f,a,c,e[g+6],15,-1560198380),c=d(c,l,f,a,e[g+13],21,1309151649),a=d(a,c,l,f,e[g+4],6,-145523070),f=d(f,a,c,l,e[g+11],10,-1120210379),l=d(l,f,a,c,e[g+2],15,718787259),c=d(c,l,f,a,e[g+9],21,-343485551),a=o(a,n),c=o(c,i),l=o(l,r),f=o(f,s);return[a,c,l,f]},g=function(e,t){var o=r(e);o.length>16&&(o=f(o,e.length*n));for(var i=Array(16),s=Array(16),a=0;16>a;a++)i[a]=909522486^o[a],s[a]=1549556828^o[a];var c=f(i.concat(r(t)),512+t.length*n);return f(s.concat(c),640)},m={hexdigest:function(e){return a(f(r(e),e.length*n))},b64digest:function(e){return c(f(r(e),e.length*n))},hash:function(e){return s(f(r(e),e.length*n))},hmac_hexdigest:function(e,t){return a(g(e,t))},hmac_b64digest:function(e,t){return c(g(e,t))},hmac_hash:function(e,t){return s(g(e,t))},test:function(){return"900150983cd24fb0d6963f7d28e17f72"===MD5.hexdigest("abc")}};return m}();Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;return function(){return t.apply(e,arguments)}}),Function.prototype.prependArg||(Function.prototype.prependArg=function(e){var t=this;return function(){for(var n=[e],o=0;arguments.length>o;o++)n.push(arguments[o]);return t.apply(this,n)}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=t);t>n;n++)if(n in this&&this[n]===e)return n;return-1}),function(e){function t(e,t){return new r.Builder(e,t)}function n(e){return new r.Builder("message",e)}function o(e){return new r.Builder("iq",e)}function i(e){return new r.Builder("presence",e)}var r;r={VERSION:"1.0.1",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas"},addNamespace:function(e,t){r.NS[e]=t},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,forEachChild:function(e,t,n){var o,i;for(o=0;e.childNodes.length>o;o++)i=e.childNodes[o],i.nodeType!=r.ElementType.NORMAL||t&&!this.isTagEqual(i,t)||n(i)},isTagEqual:function(e,t){return e.tagName.toLowerCase()==t.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var e;return window.ActiveXObject?(e=new ActiveXObject("Microsoft.XMLDOM"),e.appendChild(e.createElement("strophe"))):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlElement:function(e){if(!e)return null;var t=null;r._xmlGenerator||(r._xmlGenerator=r._makeGenerator()),t=r._xmlGenerator.createElement(e);var n,o,i;for(n=1;arguments.length>n;n++)if(arguments[n])if("string"==typeof arguments[n]||"number"==typeof arguments[n])t.appendChild(r.xmlTextNode(arguments[n]));else if("object"==typeof arguments[n]&&"function"==typeof arguments[n].sort)for(o=0;arguments[n].length>o;o++)"object"==typeof arguments[n][o]&&"function"==typeof arguments[n][o].sort&&t.setAttribute(arguments[n][o][0],arguments[n][o][1]);else if("object"==typeof arguments[n])for(i in arguments[n])arguments[n].hasOwnProperty(i)&&t.setAttribute(i,arguments[n][i]);return t},xmlescape:function(e){return e=e.replace(/\&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;")},xmlTextNode:function(e){return e=r.xmlescape(e),r._xmlGenerator||(r._xmlGenerator=r._makeGenerator()),r._xmlGenerator.createTextNode(e)},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType==r.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;e.childNodes.length>n;n++)e.childNodes[n].nodeType==r.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return t},copyElement:function(e){var t,n;if(e.nodeType==r.ElementType.NORMAL){for(n=r.xmlElement(e.tagName),t=0;e.attributes.length>t;t++)n.setAttribute(e.attributes[t].nodeName.toLowerCase(),e.attributes[t].value);for(t=0;e.childNodes.length>t;t++)n.appendChild(r.copyElement(e.childNodes[t]))}else e.nodeType==r.ElementType.TEXT&&(n=r.xmlTextNode(e.nodeValue));return n},escapeNode:function(e){return e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return 0>e.indexOf("@")?null:e.split("@")[0]},getDomainFromJid:function(e){var t=r.getBareJidFromJid(e);if(0>t.indexOf("@"))return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return 2>t.length?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e.split("/")[0]},log:function(){},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){var t;if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var n,o,i=e.nodeName;for(e.getAttribute("_realname")&&(i=e.getAttribute("_realname")),t="<"+i,n=0;e.attributes.length>n;n++)"_realname"!=e.attributes[n].nodeName&&(t+=" "+e.attributes[n].nodeName.toLowerCase()+"='"+e.attributes[n].value.replace("&","&amp;").replace("'","&apos;").replace("<","&lt;")+"'");if(e.childNodes.length>0){for(t+=">",n=0;e.childNodes.length>n;n++)o=e.childNodes[n],o.nodeType==r.ElementType.NORMAL?t+=r.serialize(o):o.nodeType==r.ElementType.TEXT&&(t+=o.nodeValue);t+="</"+i+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){r._connectionPlugins[e]=t}},r.Builder=function(e,t){("presence"==e||"message"==e||"iq"==e)&&(t&&!t.xmlns?t.xmlns=r.NS.CLIENT:t||(t={xmlns:r.NS.CLIENT})),this.nodeTree=r.xmlElement(e,t),this.node=this.nodeTree},r.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return r.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(e){for(var t in e)e.hasOwnProperty(t)&&this.node.setAttribute(t,e[t]);return this},c:function(e,t){var n=r.xmlElement(e,t);return this.node.appendChild(n),this.node=n,this},cnode:function(e){return this.node.appendChild(e),this.node=e,this},t:function(e){var t=r.xmlTextNode(e);return this.node.appendChild(t),this}},r.Handler=function(e,t,n,o,i,s,a){this.handler=e,this.ns=t,this.name=n,this.type=o,this.id=i,this.options=a||{matchbare:!1},this.options.matchBare||(this.options.matchBare=!1),this.from=this.options.matchBare?r.getBareJidFromJid(s):s,this.user=!0},r.Handler.prototype={isMatch:function(e){var t,n=null;if(n=this.options.matchBare?r.getBareJidFromJid(e.getAttribute("from")):e.getAttribute("from"),t=!1,this.ns){var o=this;r.forEachChild(e,null,function(e){e.getAttribute("xmlns")==o.ns&&(t=!0)}),t=t||e.getAttribute("xmlns")==this.ns}else t=!0;return!t||this.name&&!r.isTagEqual(e,this.name)||this.type&&e.getAttribute("type")!==this.type||this.id&&e.getAttribute("id")!==this.id||this.from&&n!==this.from?!1:!0},run:function(e){var t=null;try{t=this.handler(e)}catch(n){throw n.sourceURL?r.fatal("error: "+this.handler+" "+n.sourceURL+":"+n.line+" - "+n.name+": "+n.message):n.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",n,n.message)),r.fatal("error: "+this.handler+" "+n.fileName+":"+n.lineNumber+" - "+n.name+": "+n.message)):r.fatal("error: "+this.handler),n}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},r.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},r.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},r.Request=function(e,t,n,o){this.id=++r._requestId,this.xmlData=e,this.data=r.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=0/0,this.sends=o||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var e=new Date;return(e-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var e=new Date;return(e-this.dead)/1e3},this.xhr=this._newXHR()},r.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"==e.tagName)throw r.error("invalid response received"),r.error("responseText: "+this.xhr.responseText),r.error("responseXML: "+r.serialize(this.xhr.responseXML)),"parsererror"}else this.xhr.responseText&&(r.error("invalid response received"),r.error("responseText: "+this.xhr.responseText),r.error("responseXML: "+r.serialize(this.xhr.responseXML)));return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.prependArg(this),e}},r.Connection=function(e){this.service=e,this.jid="",this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.streamId=null,this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this.paused=!1,this.hold=1,this.wait=60,this.window=5,this._data=[],this._requests=[],this._uniqueId=Math.round(1e4*Math.random()),this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var t in r._connectionPlugins)if(r._connectionPlugins.hasOwnProperty(t)){var n=r._connectionPlugins[t],o=function(){};o.prototype=n,this[t]=new o,this[t].init(this)}},r.Connection.prototype={reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.streamId=null,this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this._requests=[],this._uniqueId=Math.round(1e4*Math.random())},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){return"string"==typeof e||"number"==typeof e?++this._uniqueId+":"+e:++this._uniqueId+""},connect:function(e,t,n,o,i){this.jid=e,this.pass=t,this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.errors=0,this.wait=o||this.wait,this.hold=i||this.hold,this.domain=r.getDomainFromJid(this.jid);var s=this._buildBody().attrs({to:this.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":r.NS.BOSH});this._changeConnectStatus(r.Status.CONNECTING,null),this._requests.push(new r.Request(s.tree(),this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)),s.tree().getAttribute("rid"))),this._throttledRequestHandler()},attach:function(e,t,n,o,i,s,a){this.jid=e,this.sid=t,this.rid=n,this.connect_callback=o,this.domain=r.getDomainFromJid(this.jid),this.authenticated=!0,this.connected=!0,this.wait=i||this.wait,this.hold=s||this.hold,this.window=a||this.window,this._changeConnectStatus(r.Status.ATTACHED,null)},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;e.length>t;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._throttledRequestHandler(),clearTimeout(this._idleTimeout),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(e,t,n,o){var i=null,r=this;"function"==typeof e.tree&&(e=e.tree());var s=e.getAttribute("id");s||(s=this.getUniqueId("sendIQ"),e.setAttribute("id",s));var a=this.addHandler(function(e){i&&r.deleteTimedHandler(i);var o=e.getAttribute("type");if("result"===o)t&&t(e);else{if("error"!==o)throw{name:"StropheError",message:"Got bad IQ type of "+o};n&&n(e)}},null,"iq",null,s);return o&&(i=this.addTimedHandler(o,function(){return r.deleteHandler(a),n&&n(null),!1})),this.send(e),s},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(e)},_sendRestart:function(){this._data.push("restart"),this._throttledRequestHandler(),clearTimeout(this._idleTimeout),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(e,t){var n=new r.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,o,i,s,a){var c=new r.Handler(e,t,n,o,i,s,a);return this.addHandlers.push(c),c},deleteHandler:function(e){this.removeHandlers.push(e)},disconnect:function(e){if(this._changeConnectStatus(r.Status.DISCONNECTING,e),r.info("Disconnect was called because: "+e),this.connected){if(this._disconnectTimeout=this._addSysTimedHandler(3e4,this._onDisconnectTimeout.bind(this)),this._requests.length>0)for(var t=0;this._requests.length>t;t++)this._removeRequest(this._requests[t]);this._sendTerminate()}},_changeConnectStatus:function(e,t){for(var n in r._connectionPlugins)if(r._connectionPlugins.hasOwnProperty(n)){var o=this[n];if(o.statusChanged)try{o.statusChanged(e,t)}catch(i){r.error(""+n+" plugin caused an exception "+"changing status: "+i)}}if(this.connect_callback)try{this.connect_callback(e,t)}catch(s){r.error("User connection callback caused an exception: "+s)}},_buildBody:function(){var e=t("body",{rid:this.rid++,xmlns:r.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),e},_removeRequest:function(e){r.debug("removing request");var t;for(t=this._requests.length-1;t>=0;t--)e==this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_processRequest:function(e){var t=this._requests[e],n=-1;try{4==t.xhr.readyState&&(n=t.xhr.status)}catch(o){r.error("caught an error in _requests["+e+"], reqStatus: "+n)}n===void 0&&(n=-1);var i=t.age(),s=!isNaN(i)&&i>Math.floor(r.TIMEOUT*this.wait),a=null!==t.dead&&t.timeDead()>Math.floor(r.SECONDARY_TIMEOUT*this.wait),c=4==t.xhr.readyState&&(1>n||n>=500);if((s||a||c)&&(a&&r.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){},this._requests[e]=new r.Request(t.xmlData,t.origFunc,t.rid,t.sends),t=this._requests[e]),0===t.xhr.readyState){r.debug("request id "+t.id+"."+t.sends+" posting"),t.date=new Date;try{t.xhr.open("POST",this.service,!0)}catch(l){return r.error("XHR open failed."),this.connected||this._changeConnectStatus(r.Status.CONNFAIL,"bad-service"),this.disconnect(),void 0}var u=function(){t.xhr.send(t.data)};if(t.sends>1){var h=1e3*Math.pow(t.sends,3);setTimeout(u,h)}else u();t.sends++,this.xmlOutput(t.xmlData),this.rawOutput(t.data)}else r.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+t.xhr.readyState)},_throttledRequestHandler:function(){this._requests?r.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):r.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window-1&&this._processRequest(1))},_onRequestStateChange:function(e,t){if(r.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)return t.abort=!1,void 0;var n;if(4==t.xhr.readyState){n=0;try{n=t.xhr.status}catch(o){}if(n===void 0&&(n=0),this.disconnecting&&n>=400)return this._hitError(n),void 0;var i=this._requests[0]==t,s=this._requests[1]==t;(n>0&&500>n||t.sends>5)&&(this._removeRequest(t),r.debug("request id "+t.id+" should now be removed")),200==n?((s||i&&this._requests.length>0&&this._requests[0].age()>Math.floor(r.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),r.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0):(r.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),(0===n||n>=400&&600>n||n>=12e3)&&(this._hitError(n),n>=400&&500>n&&(this._changeConnectStatus(r.Status.DISCONNECTING,null),this._doDisconnect()))),n>0&&1e4>n||t.sends>5||this._throttledRequestHandler()}},_hitError:function(e){this.errors++,r.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._onDisconnectTimeout()},_doDisconnect:function(){r.info("_doDisconnect was called"),this.authenticated=!1,this.disconnecting=!1,this.sid=null,this.streamId=null,this.rid=Math.floor(4294967295*Math.random()),this.connected&&(this._changeConnectStatus(r.Status.DISCONNECTED,null),this.connected=!1),this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[]},_dataRecv:function(e){try{var t=e.getResponse()}catch(n){if("parsererror"!=n)throw n;this.disconnect("strophe-parsererror")}if(null!==t){this.xmlInput(t),this.rawInput(r.serialize(t));for(var o,i;this.removeHandlers.length>0;)i=this.removeHandlers.pop(),o=this.handlers.indexOf(i),o>=0&&this.handlers.splice(o,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&0===this._requests.length)return this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null,this._doDisconnect(),void 0;var s,a,c=t.getAttribute("type");if(null!==c&&"terminate"==c)return s=t.getAttribute("condition"),a=t.getElementsByTagName("conflict"),null!==s?("remote-stream-error"==s&&a.length>0&&(s="conflict"),this._changeConnectStatus(r.Status.CONNFAIL,s)):this._changeConnectStatus(r.Status.CONNFAIL,"unknown"),this.disconnect(),void 0;var l=this;r.forEachChild(t,null,function(e){var t,n;for(n=l.handlers,l.handlers=[],t=0;n.length>t;t++){var o=n[t];!o.isMatch(e)||!l.authenticated&&o.user?l.handlers.push(o):o.run(e)&&l.handlers.push(o)}})}},_sendTerminate:function(){r.info("_sendTerminate was called");var e=this._buildBody().attrs({type:"terminate"});this.authenticated&&e.c("presence",{xmlns:r.NS.CLIENT,type:"unavailable"}),this.disconnecting=!0;var t=new r.Request(e.tree(),this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)),e.tree().getAttribute("rid"));this._requests.push(t),this._throttledRequestHandler()},_connect_cb:function(e){r.info("_connect_cb was called"),this.connected=!0;var n=e.getResponse();if(n){this.xmlInput(n),this.rawInput(r.serialize(n));var i,s,a=n.getAttribute("type");if(null!==a&&"terminate"==a)return i=n.getAttribute("condition"),s=n.getElementsByTagName("conflict"),null!==i?("remote-stream-error"==i&&s.length>0&&(i="conflict"),this._changeConnectStatus(r.Status.CONNFAIL,i)):this._changeConnectStatus(r.Status.CONNFAIL,"unknown"),void 0;this.sid||(this.sid=n.getAttribute("sid")),this.stream_id||(this.stream_id=n.getAttribute("authid"));var c=n.getAttribute("requests");c&&(this.window=parseInt(c,10));var l=n.getAttribute("hold");l&&(this.hold=parseInt(l,10));var u=n.getAttribute("wait");u&&(this.wait=parseInt(u,10));var h,p,d,f,g=!1,m=!1,v=!1,y=n.getElementsByTagName("mechanism");if(!(y.length>0)){var _=this._buildBody();return this._requests.push(new r.Request(_.tree(),this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)),_.tree().getAttribute("rid"))),this._throttledRequestHandler(),void 0}for(h=0;y.length>h;h++)p=r.getText(y[h]),"DIGEST-MD5"==p?m=!0:"PLAIN"==p?g=!0:"ANONYMOUS"==p&&(v=!0);null===r.getNodeFromJid(this.jid)&&v?(this._changeConnectStatus(r.Status.AUTHENTICATING,null),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(t("auth",{xmlns:r.NS.SASL,mechanism:"ANONYMOUS"}).tree())):null===r.getNodeFromJid(this.jid)?(this._changeConnectStatus(r.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect()):m?(this._changeConnectStatus(r.Status.AUTHENTICATING,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge1_cb.bind(this),null,"challenge",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(t("auth",{xmlns:r.NS.SASL,mechanism:"DIGEST-MD5"}).tree())):g?(d=r.getBareJidFromJid(this.jid),d+="\0",d+=r.getNodeFromJid(this.jid),d+="\0",d+=this.pass,this._changeConnectStatus(r.Status.AUTHENTICATING,null),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),f=Base64.encode(d),this.send(t("auth",{xmlns:r.NS.SASL,mechanism:"PLAIN"}).t(f).tree())):(this._changeConnectStatus(r.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(o({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:r.NS.AUTH}).c("username",{}).t(r.getNodeFromJid(this.jid)).tree()))}},_sasl_challenge1_cb:function(e){var n,o=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,i=Base64.decode(r.getText(e)),s=MD5.hexdigest(1234567890*Math.random()),a="",c=null,l="",u="";
for(this.deleteHandler(this._sasl_failure_handler);i.match(o);)switch(n=i.match(o),i=i.replace(n[0],""),n[2]=n[2].replace(/^"(.+)"$/,"$1"),n[1]){case"realm":a=n[2];break;case"nonce":l=n[2];break;case"qop":u=n[2];break;case"host":c=n[2]}var h="xmpp/"+this.domain;null!==c&&(h=h+"/"+c);var p=MD5.hash(r.getNodeFromJid(this.jid)+":"+a+":"+this.pass)+":"+l+":"+s,d="AUTHENTICATE:"+h,f="";return f+="username="+this._quote(r.getNodeFromJid(this.jid))+",",f+="realm="+this._quote(a)+",",f+="nonce="+this._quote(l)+",",f+="cnonce="+this._quote(s)+",",f+='nc="00000001",',f+='qop="auth",',f+="digest-uri="+this._quote(h)+",",f+="response="+this._quote(MD5.hexdigest(MD5.hexdigest(p)+":"+l+":00000001:"+s+":auth:"+MD5.hexdigest(d)))+",",f+='charset="utf-8"',this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge2_cb.bind(this),null,"challenge",null,null),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(t("response",{xmlns:r.NS.SASL}).t(Base64.encode(f)).tree()),!1},_quote:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},_sasl_challenge2_cb:function(){return this.deleteHandler(this._sasl_success_handler),this.deleteHandler(this._sasl_failure_handler),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(t("response",{xmlns:r.NS.SASL}).tree()),!1},_auth1_cb:function(){var e=o({type:"set",id:"_auth_2"}).c("query",{xmlns:r.NS.AUTH}).c("username",{}).t(r.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return r.getResourceFromJid(this.jid)||(this.jid=r.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(r.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(){return r.info("SASL authentication succeeded."),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null),this._sendRestart(),!1},_sasl_auth1_cb:function(e){var t,n;for(t=0;e.childNodes.length>t;t++)n=e.childNodes[t],"bind"==n.nodeName&&(this.do_bind=!0),"session"==n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(r.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var i=r.getResourceFromJid(this.jid);return i?this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:r.NS.BIND}).c("resource",{}).t(i).tree()):this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:r.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){if("error"==e.getAttribute("type"))return r.info("SASL binding failed."),this._changeConnectStatus(r.Status.AUTHFAIL,null),!1;var t,n=e.getElementsByTagName("bind");return n.length>0?(t=n[0].getElementsByTagName("jid"),t.length>0&&(this.jid=r.getText(t[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(o({type:"set",id:"_session_auth_2"}).c("session",{xmlns:r.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(r.Status.CONNECTED,null))),void 0):(r.info("SASL binding failed."),this._changeConnectStatus(r.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(e){if("result"==e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(r.Status.CONNECTED,null);else if("error"==e.getAttribute("type"))return r.info("Session creation failed."),this._changeConnectStatus(r.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._changeConnectStatus(r.Status.AUTHFAIL,null),!1},_auth2_cb:function(e){return"result"==e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(r.Status.CONNECTED,null)):"error"==e.getAttribute("type")&&(this._changeConnectStatus(r.Status.AUTHFAIL,null),this.disconnect()),!1},_addSysTimedHandler:function(e,t){var n=new r.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,o,i){var s=new r.Handler(e,t,n,o,i);return s.user=!1,this.addHandlers.push(s),s},_onDisconnectTimeout:function(){r.info("_onDisconnectTimeout was called");for(var e;this._requests.length>0;)e=this._requests.pop(),e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){};return this._doDisconnect(),!1},_onIdle:function(){for(var e,t,n,o;this.removeTimeds.length>0;)t=this.removeTimeds.pop(),e=this.timedHandlers.indexOf(t),e>=0&&this.timedHandlers.splice(e,1);for(;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());var i=(new Date).getTime();for(o=[],e=0;this.timedHandlers.length>e;e++)t=this.timedHandlers[e],(this.authenticated||!t.user)&&(n=t.lastCalled+t.period,0>=n-i?t.run()&&o.push(t):o.push(t));this.timedHandlers=o;var s,a;if(this.authenticated&&0===this._requests.length&&0===this._data.length&&!this.disconnecting&&(r.info("no requests during idle cycle, sending blank request"),this._data.push(null)),2>this._requests.length&&this._data.length>0&&!this.paused){for(s=this._buildBody(),e=0;this._data.length>e;e++)null!==this._data[e]&&("restart"===this._data[e]?s.attrs({to:this.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":r.NS.BOSH}):s.cnode(this._data[e]).up());delete this._data,this._data=[],this._requests.push(new r.Request(s.tree(),this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)),s.tree().getAttribute("rid"))),this._processRequest(this._requests.length-1)}this._requests.length>0&&(a=this._requests[0].age(),null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(r.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),a>Math.floor(r.TIMEOUT*this.wait)&&(r.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(r.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())),clearTimeout(this._idleTimeout),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)}},e&&e(r,t,n,o,i)}(function(){window.Strophe=arguments[0],window.$build=arguments[1],window.$msg=arguments[2],window.$iq=arguments[3],window.$pres=arguments[4]}),Strophe.addConnectionPlugin("cors",{init:function(){if(window.XDomainRequest)Strophe.debug("CORS with IE"),Strophe.Request.prototype._newXHR=function(){var e=function(e,t){e.status=t,e.readyState=4;try{e.onreadystatechange()}catch(n){}e.readyState=0;try{e.onreadystatechange()}catch(n){}},t=new XDomainRequest;return t.readyState=0,t.onreadystatechange=this.func.prependArg(this),t.onload=function(){xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async="false",xmlDoc.loadXML(t.responseText),t.responseXML=xmlDoc,e(t,200)},t.onerror=function(){e(t,500)},t.ontimeout=function(){e(t,500)},t.sendFnc=t.send,t.send=function(e){return t.readyState=2,t.sendFnc(e)},t};else if(void 0!==(new XMLHttpRequest).withCredentials)Strophe.debug("CORS with Firefox/Safari/Chome");else if(flensed&&flensed.flXHR){Strophe.debug("CORS not supported, using flXHR");var e=!0;-1!=navigator.userAgent.indexOf("MSIE")&&(e=!1),Strophe.Request.prototype._newXHR=function(){var t=new flensed.flXHR({autoUpdatePlayer:!0,instancePooling:e,noCacheHeader:!1});return t.onreadystatechange=this.func.prependArg(this),t}}else Strophe.error("No CORS and no flXHR. You may experience cross domain turbulence.")}}),Phono.events={handlerCount:1,add:function(e,t,n){t=t.toLowerCase(),n.$$guid||(n.$$guid=this.handlerCount++),e.events||(e.events={});var o=e.events[t];o||(o=e.events[t]={},e["on"+t]&&(o[0]=e["on"+t])),o[n.$$guid]=n,e["on"+t]=this.handle},bind:function(e,t){for(k in t)k.match("^on")&&this.add(e,k.substr(2).toLowerCase(),t[k])},remove:function(e,t,n){t=t.toLowerCase(),e.events&&e.events[t]&&delete e.events[t][n.$$guid]},trigger:function(e,t,n,o){n=n||{},n.type=t;var i=e["on"+t.toLowerCase()];i&&("log"!=t.toLowerCase()&&Phono.log.info("[EVENT] "+t+"["+o+"]"),i.call(e,n,o))},handle:function(e,t){var n=this.events[e.type.toLowerCase()];e.source=this;var o=Array();if(o.push(e),t){var i;for(i=0;t.length>i;i++)o.push(t[i])}var r=this;Phono.util.each(n,function(){this.apply(r,o)})}},function(){function e(e,t){if(t)for(key in t)t.hasOwnProperty(key)&&(e[key]=t[key]);return e}function t(e,t){var n=[];for(var o in e)e.hasOwnProperty(o)&&(n[o]=t(e[o]));return n}function n(t,n,r){if(c.isSupported(n.version))t.innerHTML=c.getHTML(n,r);else if(n.expressInstall&&c.isSupported([6,65]))t.innerHTML=c.getHTML(e(n,{src:n.expressInstall}),{MMredirectURL:location.href,MMplayerType:"PlugIn",MMdoctitle:document.title});else if(t.innerHTML.replace(/\s/g,"")||(t.innerHTML="<h2>Flash version "+n.version+" or greater is required</h2><h3>"+(l[0]>0?"Your version is "+l:"You have no flash plugin installed")+"</h3>"+("A"==t.tagName?"<p>Click here to download latest version</p>":"<p>Download latest version from <a href='"+i+"'>here</a></p>"),"A"==t.tagName&&(t.onclick=function(){location.href=i})),n.onFail){var s=n.onFail.call(this);"string"==typeof s&&(t.innerHTML=s)}o&&(window[n.id]=document.getElementById(n.id)),e(this,{getRoot:function(){return t},getOptions:function(){return n},getConf:function(){return r},getApi:function(){return t.firstChild}})}var o=document.all,i="http://www.adobe.com/go/getflashplayer",r="function"==typeof $,s=/(\d+)[^\d]+(\d+)[^\d]*(\d*)/,a={width:"100%",height:"100%",id:"_"+(""+Math.random()).slice(9),allowfullscreen:!0,allowscriptaccess:"always",quality:"high",version:[3,0],onFail:null,expressInstall:null,w3c:!1,cachebusting:!1};window.attachEvent&&window.attachEvent("onbeforeunload",function(){__flash_unloadHandler=function(){},__flash_savedUnloadHandler=function(){}}),window.flashembed=function(t,o,i){return"string"==typeof t&&(t=document.getElementById(t.replace("#",""))),t?("string"==typeof o&&(o={src:o}),new n(t,e(e({},a),o),i)):void 0};var c=e(window.flashembed,{conf:a,getVersion:function(){var e;try{e=navigator.plugins["Shockwave Flash"].description.slice(16)}catch(t){try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");e=n&&n.GetVariable("$version")}catch(o){}}return(e=s.exec(e))?[e[1],e[3]]:[0,0]},asString:function(e){if(null===e||void 0===e)return null;var n=typeof e;switch("object"==n&&e.push&&(n="array"),n){case"string":return e=e.replace(RegExp('(["\\\\])',"g"),"\\$1"),e=e.replace(/^\s?(\d+\.?\d+)%/,"$1pct"),'"'+e+'"';case"array":return"["+t(e,function(e){return c.asString(e)}).join(",")+"]";case"function":return'"function()"';case"object":n=[];for(var o in e)e.hasOwnProperty(o)&&n.push('"'+o+'":'+c.asString(e[o]));return"{"+n.join(",")+"}"}return(e+"").replace(/\s/g," ").replace(/\'/g,'"')},getHTML:function(t,n){t=e({},t);var i='<object width="'+t.width+'" height="'+t.height+'" id="'+t.id+'" name="'+t.id+'"';t.cachebusting&&(t.src+=(-1!=t.src.indexOf("?")?"&":"?")+Math.random()),i+=t.w3c||!o?' data="'+t.src+'" type="application/x-shockwave-flash"':' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"',i+=">",(t.w3c||o)&&(i+='<param name="movie" value="'+t.src+'" />'),t.width=t.height=t.id=t.w3c=t.src=null,t.onFail=t.version=t.expressInstall=null;for(var r in t)t[r]&&(i+='<param name="'+r+'" value="'+t[r]+'" />');if(t="",n){for(var s in n)n[s]&&(r=n[s],t+=s+"="+(/function|object/.test(typeof r)?c.asString(r):r)+"&");t=t.slice(0,-1),i+='<param name="flashvars" value=\''+t+"' />"}return i+="</object>"},isSupported:function(e){return l[0]>e[0]||l[0]==e[0]&&l[1]>=e[1]}}),l=c.getVersion();r&&($.tools=$.tools||{version:"1.2.2"},$.tools.flashembed={conf:a},$.fn.flashembed=function(e,t){return this.each(function(){$(this).data("flashembed",flashembed(this,e,t))})})}(),function(){function FlashAudio(e,t,n){this.type="flash",this.config=Phono.util.extend({protocol:"rtmfp",swf:"//"+MD5.hexdigest(window.location.host+e.config.apiKey)+".u.phono.com/releases/"+Phono.version+"/plugins/audio/phono.audio.swf",cirrus:"rtmfp://phono-fms1-ext.voxeolabs.net/phono",direct:!0,media:{audio:!0,video:!0}},t),Phono.events.bind(this,t);var o=this.config.containerId;o||(this.config.containerId=o=this.createContainer()),Phono.events.bind(this,{onPermissionBoxShow:function(){var e=$("#"+o).position();$("#"+o).css("left",parseInt(e.left)),$("#"+o).css("top",parseInt(e.top))}});var i=this;FABridge.addInitializationCallback(o,function(){Phono.log.info("FlashAudio Ready"),i.$flash=this.create("Wrapper").getAudio(),i.$flash.addEventListener(null,function(t){var n=t.getType()+"";Phono.events.trigger(i,n,{reason:t.getReason()}),"mediaError"==n&&Phono.events.trigger(e,"error",{reason:t.getReason()})}),i.$flash.setVersion(Phono.version),n(i),i.config.direct&&window.setTimeout(10,i.$flash.doCirrusConnect(i.config.cirrus))}),wmodeSetting="opaque",(-1!=navigator.appVersion.indexOf("X11")||-1!=navigator.appVersion.indexOf("Linux")||$.browser.opera)&&(wmodeSetting="window"),flashembed(o,{id:o+"id",src:this.config.swf+"?rnd="+(new Date).getTime(),wmode:wmodeSetting},{bridgeName:o})}function JavaAudio(phono,config,callback){if(this.type="java",JavaAudio.exists()){this.config=Phono.util.extend({jar:"//s.phono.com/releases/"+Phono.version+"/plugins/audio/phono.audio.jar"},config),Phono.events.bind(this,config);var containerId=this.config.containerId;containerId||(this.config.containerId=containerId=_createContainer());var plugin=this;plugin.$applet=_loadApplet(containerId,this.config.jar,callback,plugin),window.setInterval(function(){var str="Loading...";try{var json=plugin.$applet[0].getJSONStatus();if(json){var statusO=eval("("+json+")");statusO.userTrust?(eps=statusO.endpoints,eps.length>0&&(eps[0].sent>50&&0==eps[0].rcvd&&Phono.events.trigger(phono,"error",{reason:"Java Applet detected firewall."}),str="share: "+eps[0].uri,str+=" sent "+eps[0].sent,str+=" rcvd "+eps[0].rcvd,str+=" error "+eps[0].error,Phono.log.debug("[JAVA RTP] "+str))):Phono.events.trigger(phono,"error",{reason:"Java Applet not trusted by user - cannot continue"})}else Phono.events.trigger(phono,"error",{reason:"Java applet did not load."}),Phono.log.debug("[JAVA Load errror] no status returned.")}catch(e){Phono.events.trigger(phono,"error",{reason:"Can not communicate with Java Applet - perhaps it did not load."}),Phono.log.debug("[JAVA Load error] "+e)}},25e3)}else Phono.events.trigger(phono,"error",{reason:"Java not available in this browser."})}function PhonegapIOSAudio(e,t,n){this.type="phonegap-ios",Phono.events.bind(this,t);var o=this;this.initState(n,o)}function PhonegapAndroidAudio(e,t,n){this.type="phonegap-android",Phono.events.bind(this,t);var o=this;PhoneGap.exec(null,null,"App","addService",["PhonogapAudio","com.phono.android.phonegap.Phono"]),this.allocateEndpoint(),this.initState(n,o)}function WebRTCAudio(e,t,n){console.log("Initialize WebRTC"),WebRTCAudio.peerConnection="function"==typeof webkitDeprecatedPeerConnection?webkitDeprecatedPeerConnection:webkitPeerConnection,this.config=Phono.util.extend({media:{audio:!0,video:!0}},t);var o=this,i=this.config.localContainerId;i||(this.config.localContainerId=this.createContainer()),WebRTCAudio.localVideo=document.getElementById(this.config.localContainerId);try{console.log("Request access to local media, use new syntax"),navigator.webkitGetUserMedia(this.config.media,function(e){WebRTCAudio.localStream=e,console.log("We have a stream");var t=webkitURL.createObjectURL(e);WebRTCAudio.localVideo.style.opacity=1,WebRTCAudio.localVideo.src=t,n(o)},function(e){console.log("Failed to get access to local media. Error code was "+e.code),alert("Failed to get access to local media. Error code was "+e.code+".")})}catch(r){console.log("getUserMedia error, try old syntax"),navigator.webkitGetUserMedia("video,audio",function(e){WebRTCAudio.localStream=e,console.log("We have a stream");var t=webkitURL.createObjectURL(e);WebRTCAudio.localVideo.style.opacity=1,WebRTCAudio.localVideo.src=t,n(o)},function(e){console.log("Failed to get access to local media. Error code was "+e.code),alert("Failed to get access to local media. Error code was "+e.code+".")})}}FlashAudio.count=0,FlashAudio.prototype.showPermissionBox=function(){this.$flash.showPermissionBox()},FlashAudio.prototype.permission=function(){return this.$flash.getHasPermission()},FlashAudio.prototype.play=function(e,t){url=e.uri.replace("protocol",this.config.protocol);var n=url,o=Phono.util.parseUri(url),i=Phono.util.parseUri(document.location);if("rtp"==o.protocol)return null;0==url.indexOf("//")?n=i.protocol+":"+url:2>o.protocol.length&&(n=i.protocol+"://"+i.authority+i.directoryPath+url);var r;return 1==this.config.direct&&void 0!=e.peerID&&void 0!=this.config.cirrus?(Phono.log.info("Direct media play with peer "+e.peerID),r=this.$flash.play(n,t,e.peerID,this.config.video)):r=this.$flash.play(n,t),{url:function(){return r.getUrl()},start:function(){r.start()},stop:function(){r.stop()},volume:function(e){return 0===arguments.length?r.getVolume():(r.setVolume(e),void 0)}}},FlashAudio.prototype.share=function(e,t,n){var o=e.uri.replace("protocol",this.config.protocol),i="";1==this.config.direct&&void 0!=e.peerID&&void 0!=this.config.cirrus&&(i=e.peerID,Phono.log.info("Direct media share with peer "+e.peerID));var r=!1,s=this.$flash.share(o,t,n.id,n.name,n.rate,!0,i,this.config.video);0==o.indexOf("rtmfp://")&&(r=!0);var a={url:function(){return s.getUrl()},codec:function(){var e=s.getCodec();return{id:e.getId(),name:e.getName(),rate:e.getRate()}},start:function(){s.start()},stop:function(){s.stop()},digit:function(e,t,n){s.digit(e,t,n)},gain:function(e){return 0===arguments.length?s.getGain():(s.setGain(e),void 0)},mute:function(e){return 0===arguments.length?s.getMute():(s.setMute(e),void 0)},suppress:function(e){return 0===arguments.length?s.getSuppress():(s.setSuppress(e),void 0)},energy:function(){return{mic:0,spk:0}},secure:function(){return r}};return s.addEventListener(null,function(e){var t=e.getType()+"";Phono.events.trigger(a,t,{reason:e.getReason()})}),a},FlashAudio.prototype.transport=function(){var e=this.$flash,t=this.config,n=this.config.cirrus;return{name:this.$flash.getTransport(),description:this.$flash.getDescription(),buildTransport:function(o,i,r){var s="";t.direct&&(s=e.nearID(n)),""!=s?i.c("transport",{xmlns:this.name,peerID:s}):i.c("transport",{xmlns:this.name}),r()},processTransport:function(e){var t,n=e.attr("peerid");return void 0!=n&&(t={input:{uri:"rtmfp://invalid/invalid",peerID:n},output:{uri:"rtmfp://invalid/invalid",peerID:n}}),e.find("candidate").each(function(){t={input:{uri:$(this).attr("rtmpUri")+"/"+$(this).attr("playName"),peerID:n},output:{uri:$(this).attr("rtmpUri")+"/"+$(this).attr("publishName"),peerID:n}}}),t}}},FlashAudio.prototype.codecs=function(){var e=Array(),t=this.$flash.getCodecs();return Phono.util.each(t,function(){e.push({id:this.getId(),name:this.getName(),rate:this.getRate()})}),e},FlashAudio.prototype.createContainer=function(){var e=$("<div>").attr("id","_phono-audio-flash"+FlashAudio.count++).addClass("phono_FlashHolder").appendTo("body");e.css({width:"1px",height:"1px",position:"absolute",top:"50%",left:"50%","margin-top":"-69px","margin-left":"-107px","z-index":"10001",visibility:"visible"});var t=$(e).attr("id");return Phono.events.bind(this,{onPermissionBoxShow:function(){$("#"+t).css({width:"215px",height:"138px"})},onPermissionBoxHide:function(){$("#"+t).css({width:"1px",height:"1px"})}}),t},JavaAudio.exists=function(){return navigator.javaEnabled()},JavaAudio.count=0,JavaAudio.prototype.play=function(e,t){var n,o=e.uri,i=this.$applet[0],r=o,s=Phono.util.parseUri(o),a=Phono.util.parseUri(document.location);return"rtp"==s.protocol?null:(0==o.indexOf("//")?r=a.protocol+":"+o:2>s.protocol.length&&(r=a.protocol+"://"+a.authority+a.directoryPath+o),void 0===t&&(t=!1),n=i.play(r,t),{url:function(){return n.getUrl()},start:function(){n.start()},stop:function(){n.stop()},volume:function(){return 0===arguments.length?n.volume():(n.volume(value),void 0)}})},JavaAudio.prototype.share=function(e,t,n,o,i){var r=e.uri,s=this.$applet[0];Phono.log.debug("[JAVA share codec ] "+n.p.pt+" id = "+n.id);var a,c=s.mkCodec(n.p,n.id),l=!1;return void 0!=o&&void 0!=i?(a=s.share(r,c,t,o,i),l=!0):a=s.share(r,c,t),{url:function(){return a.getUrl()},codec:function(){var e=a.getCodec();return{id:e.getId(),name:e.getName(),rate:e.getRate()}},start:function(){a.start()},stop:function(){a.stop()},digit:function(e,t,n){a.digit(e,t,n)},gain:function(e){return 0===arguments.length?a.gain():(a.gain(e),void 0)},mute:function(e){return 0===arguments.length?a.mute():(a.mute(e),void 0)},suppress:function(e){return 0===arguments.length?a.doES():(a.doES(e),void 0)},energy:function(){var e=a.energy();return{mic:Math.floor(Math.max(Math.LOG2E*Math.log(e[0])-4,0)),spk:Math.floor(Math.max(Math.LOG2E*Math.log(e[1])-4,0))}},secure:function(){return l}}},JavaAudio.prototype.permission=function(){return!0},JavaAudio.prototype.transport=function(){var e=this.$applet[0],t=e.allocateEndpoint();return{name:"urn:xmpp:jingle:transports:raw-udp:1",description:"urn:xmpp:jingle:apps:rtp:1",supportsSRTP:!0,buildTransport:function(e,n,o){var i=Phono.util.parseUri(t);n.c("transport",{xmlns:"urn:xmpp:jingle:transports:raw-udp:1"}).c("candidate",{ip:i.domain,port:i.port,generation:"1"}),o()},processTransport:function(e){var n;return e.find("candidate").each(function(){n=t+":"+$(this).attr("ip")+":"+$(this).attr("port")}),{input:{uri:n},output:{uri:n}}}}},String.prototype.startsWith=function(e){return this.match("^"+e)==e},JavaAudio.prototype.codecs=function(){var e=Array(),t=this.$applet[0],n=t.codecs();for(l=0;n.length>l;l++){var o;o=n[l].name.startsWith("SPEEX")?"SPEEX":n[l].name,e.push({id:n[l].pt,name:o,rate:n[l].rate,p:n[l]})}return e},JavaAudio.prototype.audioIn=function(e){var t=this.$applet[0];t.setAudioIn(e)},JavaAudio.prototype.audioInDevices=function(){var result=Array(),devs=eval("("+this.audioDeviceList+")"),mixers=devs.mixers;for(result.push("Let my system choose"),l=0;mixers.length>l;l++)mixers[l].targets.length>0&&result.push(mixers[l].name);return result},_createContainer=function(){var e=$("<div>").attr("id","_phono-appletHolder"+JavaAudio.count++).addClass("phono_AppletHolder").appendTo("body");e.css({width:"1px",height:"1px",position:"absolute",top:"50%",left:"50%","margin-top":"-69px","margin-left":"-107px","z-index":"10001",visibility:"visible"});var t=$(e).attr("id");return t},_loadApplet=function(e,n,o,i){var r="_phonoAudio"+JavaAudio.count++,s=r+"Callback";window[s]=function(e){i.audioDeviceList=e,t=window.setTimeout(function(){o(i)},10)};var a=$("<applet>").attr("id",r).attr("name",r).attr("code","com.phono.applet.rtp.RTPApplet").attr("archive",n).attr("width","1px").attr("height","1px").attr("mayscript","true").append($("<param>").attr("name","doEC").attr("value","true")).append($("<param>").attr("name","callback").attr("value",s)).appendTo("#"+e);return a},PhonegapIOSAudio.exists=function(){return"undefined"!=typeof PhoneGap&&Phono.util.isIOS()},PhonegapIOSAudio.codecs=Array(),PhonegapIOSAudio.endpoint="rtp://0.0.0.0",PhonegapIOSAudio.prototype.allocateEndpoint=function(){PhonegapIOSAudio.endpoint="rtp://0.0.0.0",PhoneGap.exec(function(e){console.log("endpoint success: "+e),PhonegapIOSAudio.endpoint=e},function(e){console.log("endpoint fail:"+e)},"Phono","allocateEndpoint",[])},PhonegapIOSAudio.prototype.initState=function(e,t){this.allocateEndpoint(),PhoneGap.exec(function(n){console.log("codec success: "+n);var o=$.parseJSON(n);for(l=0;o.length>l;l++){var i;i=o[l].name.startsWith("SPEEX")?"SPEEX":o[l].name,PhonegapIOSAudio.codecs.push({id:o[l].ptype,name:i,rate:o[l].rate,p:o[l]})}e(t)},function(e){console.log("codec fail:"+e)},"Phono","codecs",[])},PhonegapIOSAudio.prototype.play=function(e,t){var n=e.uri,o=n,i=Phono.util.parseUri(n),r=Phono.util.parseUri(document.location);return"rtp"==i.protocol?null:(0==n.indexOf("//")?o=r.protocol+":"+n:2>i.protocol.length&&(o=r.protocol+"://"+r.directoryPath.substring(0,r.directoryPath.length)+n,o=encodeURI(o)),console.log("play("+o+","+t+")"),PhoneGap.exec(function(e){console.log("play success: "+e)},function(e){console.log("play fail:"+e)},"Phono","play",[{uri:o,autoplay:1==t?"YES":"NO"}]),{url:function(){return o},start:function(){console.log("play.start "+o),PhoneGap.exec(function(e){console.log("start success: "+e)},function(e){console.log("start fail:"+e)},"Phono","start",[{uri:o}])},stop:function(){PhoneGap.exec(function(e){console.log("stop success: "+e)},function(e){console.log("stop fail:"+e)},"Phono","stop",[{uri:o}])},volume:function(){0===arguments.length}})},PhonegapIOSAudio.prototype.share=function(e,t,n,o,i){var r,s=e.uri,a=""+n.name+":"+n.rate+":"+n.id,c=!1;void 0!=o&&void 0!=i?(r=[{uri:s,autoplay:1==t?"YES":"NO",codec:a,srtpPropsl:o,srtpPropsr:i}],c=!0):r=[{uri:s,autoplay:1==t?"YES":"NO",codec:a}],PhoneGap.exec(function(e){console.log("share success: "+e)},function(e){console.log("share fail:"+e)},"Phono","share",r);var l=Phono.util.localUri(s),u=!1,h=50,p=0,d=0;return{url:function(){return s},codec:function(){var e;return{id:e.getId(),name:e.getName(),rate:e.getRate()}},start:function(){console.log("share.start "+l),PhoneGap.exec(function(e){console.log("start success: "+e)},function(e){console.log("start fail:"+e)},"Phono","start",[{uri:l}])},stop:function(){PhoneGap.exec(function(e){console.log("stop success: "+e)},function(e){console.log("stop fail:"+e)},"Phono","stop",[{uri:l}])},digit:function(e,t,n){PhoneGap.exec(function(e){console.log("digit success: "+e)},function(e){console.log("digit fail:"+e)},"Phono","digit",[{uri:l,digit:e,duration:t,audible:1==n?"YES":"NO"}])},gain:function(e){return 0===arguments.length?h:(PhoneGap.exec(function(t){console.log("gain success: "+t+" "+e),h=e},function(e){console.log("gain fail:"+e)},"Phono","gain",[{uri:l,value:e}]),void 0)},mute:function(e){return 0===arguments.length?u:(PhoneGap.exec(function(t){console.log("mute success: "+t+" "+e),u=e},function(e){console.log("mute fail:"+e)},"Phono","mute",[{uri:l,value:1==e?"YES":"NO"}]),void 0)},suppress:function(){0===arguments.length},energy:function(){return PhoneGap.exec(function(e){console.log("energy success: "+e);var t=$.parseJSON(e);p=Math.floor(Math.max(Math.LOG2E*Math.log(t[0])-4,0)),d=Math.floor(Math.max(Math.LOG2E*Math.log(t[1])-4,0))},function(e){console.log("energy fail:"+e)},"Phono","energy",[{uri:l}]),{mic:p,spk:d}},secure:function(){return c}}},PhonegapIOSAudio.prototype.permission=function(){return!0},PhonegapIOSAudio.prototype.transport=function(){var e=PhonegapIOSAudio.endpoint;return this.allocateEndpoint(),{name:"urn:xmpp:jingle:transports:raw-udp:1",description:"urn:xmpp:jingle:apps:rtp:1",supportsSRTP:!0,buildTransport:function(t,n,o){console.log("buildTransport: "+e);var i=Phono.util.parseUri(e);n.c("transport",{xmlns:"urn:xmpp:jingle:transports:raw-udp:1"}).c("candidate",{ip:i.domain,port:i.port,generation:"1"}),o()},processTransport:function(t){var n;return t.find("candidate").each(function(){n=e+":"+$(this).attr("ip")+":"+$(this).attr("port")}),{input:{uri:n},output:{uri:n}}}}},String.prototype.startsWith=function(e){return this.match("^"+e)==e},PhonegapIOSAudio.prototype.codecs=function(){return PhonegapIOSAudio.codecs},PhonegapAndroidAudio.exists=function(){return"undefined"!=typeof PhoneGap&&Phono.util.isAndroid()},PhonegapAndroidAudio.codecs=Array(),PhonegapAndroidAudio.endpoint="rtp://0.0.0.0",PhonegapAndroidAudio.prototype.allocateEndpoint=function(){PhonegapAndroidAudio.endpoint="rtp://0.0.0.0",PhoneGap.exec(function(e){console.log("endpoint: success"),PhonegapAndroidAudio.endpoint=e.uri},function(){console.log("endpoint: fail")},"PhonogapAudio","allocateEndpoint",[{}])},PhonegapAndroidAudio.prototype.initState=function(e,t){this.allocateEndpoint();var n=function(n){console.log("codec: success");var o=n.codecs;for(l=0;o.length>l;l++){var i;i=o[l].name.startsWith("SPEEX")?"SPEEX":o[l].name,PhonegapAndroidAudio.codecs.push({id:o[l].ptype,name:i,rate:o[l].rate,p:o[l]})}e(t)},o=function(){console.log("codec:fail")};PhoneGap.exec(n,o,"PhonogapAudio","codecs",[{}])},PhonegapAndroidAudio.prototype.play=function(e,t){var n=e.uri,o=n,i=Phono.util.parseUri(n),r=Phono.util.parseUri(document.location);return"rtp"==i.protocol?null:(0==n.indexOf("//")?o=r.protocol+":"+n:2>i.protocol.length&&(o=r.protocol+"://"+r.directoryPath.substring(0,r.directoryPath.length)+n,o=encodeURI(o)),PhoneGap.exec(function(){console.log("play: success")},function(){console.log("play: fail")},"PhonogapAudio","play",[{uri:o,autoplay:1==t?"YES":"NO"}]),{url:function(){return o},start:function(){console.log("play.start "+o),PhoneGap.exec(function(){console.log("start: success")},function(){console.log("start: fail")},"PhonogapAudio","start",[{uri:o}])},stop:function(){console.log("play.stop "+o),PhoneGap.exec(function(){console.log("stop: success")},function(){console.log("stop: fail")},"PhonogapAudio","stop",[{uri:o}])},volume:function(){0===arguments.length}})},PhonegapAndroidAudio.prototype.share=function(e,t,n,o,i){var r,s=e.uri,a=""+n.name+":"+n.rate+":"+n.id,c=!1;void 0!=o&&void 0!=i?(r=[{uri:s,autoplay:1==t?"YES":"NO",codec:a,lsrtp:o,rsrtp:i}],c=!0):r=[{uri:s,autoplay:1==t?"YES":"NO",codec:a}],PhoneGap.exec(function(){console.log("share: success")},function(){console.log("share: fail")},"PhonogapAudio","share",r);var l=Phono.util.localUri(s),u=!1,h=50,p=0,d=0;return{url:function(){return s},codec:function(){var e;return{id:e.getId(),name:e.getName(),rate:e.getRate()}},start:function(){console.log("share.start "+l),PhoneGap.exec(function(){console.log("start: success")},function(){console.log("start: fail")},"PhonogapAudio","start",[{uri:l}])},stop:function(){console.log("share.stop "+l),PhoneGap.exec(function(){console.log("stop: success")},function(){console.log("stop: fail")},"PhonogapAudio","stop",[{uri:l}])},digit:function(e,t,n){console.log("share.digit "+l),PhoneGap.exec(function(){console.log("digit: success")},function(){console.log("digit: fail")},"PhonogapAudio","digit",[{uri:l,digit:e,duration:t,audible:1==n?"YES":"NO"}])},gain:function(e){return 0===arguments.length?h:(console.log("share.gain "+l),PhoneGap.exec(function(){console.log("gain: success")},function(){console.log("gain: fail")},"PhonogapAudio","gain",[{uri:l,value:e}]),void 0)},mute:function(e){return 0===arguments.length?u:(console.log("share.mute "+l),PhoneGap.exec(function(){console.log("mute: success")},function(){console.log("mute: fail")},"PhonogapAudio","mute",[{uri:l,value:1==e?"YES":"NO"}]),void 0)},suppress:function(){0===arguments.length},energy:function(){return PhoneGap.exec(function(e){console.log("energy success: "+e);var t=$.parseJSON(e);null!=t&&(p=Math.floor(Math.max(Math.LOG2E*Math.log(t.mic)-4,0)),d=Math.floor(Math.max(Math.LOG2E*Math.log(t.spk)-4,0)))},function(e){console.log("energy fail:"+e)},"PhonogapAudio","energy",[{uri:l}]),{mic:p,spk:d}},secure:function(){return c}}},PhonegapAndroidAudio.prototype.permission=function(){return!0},PhonegapAndroidAudio.prototype.transport=function(){var e=PhonegapAndroidAudio.endpoint;return this.allocateEndpoint(),{name:"urn:xmpp:jingle:transports:raw-udp:1",description:"urn:xmpp:jingle:apps:rtp:1",supportsSRTP:device.version.charAt(0)>="4",buildTransport:function(t,n,o){console.log("buildTransport: "+e);var i=Phono.util.parseUri(e);n.c("transport",{xmlns:"urn:xmpp:jingle:transports:raw-udp:1"}).c("candidate",{ip:i.domain,port:i.port,generation:"1"}),o()},processTransport:function(t){var n;return t.find("candidate").each(function(){n=e+":"+$(this).attr("ip")+":"+$(this).attr("port")}),{input:{uri:n},output:{uri:n}}}}},String.prototype.startsWith=function(e){return this.match("^"+e)==e
},PhonegapAndroidAudio.prototype.codecs=function(){return PhonegapAndroidAudio.codecs},WebRTCAudio.exists=function(){return"function"==typeof webkitDeprecatedPeerConnection||"function"==typeof webkitPeerConnection},WebRTCAudio.stun="STUN stun.l.google.com:19302",WebRTCAudio.count=0,WebRTCAudio.prototype.play=function(e){var t=e.uri,n=t,o=null;return{url:function(){return n},start:function(){null!=o&&$(o).remove(),o=$("<audio>").attr("id","_phono-audioplayer-webrtc"+WebRTCAudio.count++).attr("autoplay","autoplay").attr("src",t).attr("loop","loop").appendTo("body")},stop:function(){$(o).remove(),o=null},volume:function(){}}},WebRTCAudio.prototype.share=function(e){return e.uri,{url:function(){return null},codec:function(){return null},start:function(){},stop:function(){console.log("Closing PeerConnection"),null!=e.getPC()&&(e.getPC().close(),console.log("closed"))},digit:function(){},gain:function(){return null},mute:function(){return null},suppress:function(){return null},energy:function(){return{mic:0,spk:0}},secure:function(){return!0}}},WebRTCAudio.prototype.permission=function(){return!0},WebRTCAudio.prototype.transport=function(e){var t,n,o,i,r;r=e&&e.remoteContainerId?e.remoteContainerId:this.config.remoteContainerId?this.config.remoteContainerId:this.createContainer();var s=document.getElementById(r);return{name:"http://phono.com/webrtc/transport",description:"http://phono.com/webrtc/description",buildTransport:function(e,r,a,c,l){"answer"==e?(null!=t&&(t.close(),t=null),t=new WebRTCAudio.peerConnection(WebRTCAudio.stun,function(e){console.log("C->S SDP: "+e);var s=$.parseJSON(e.substring(4,e.length));"ANSWER"==s.messageType?(console.log("Received ANSWER from PeerConnection: "+e),e=e.replace("s=","s=Canary"),o=e,r.c("transport",{xmlns:"http://phono.com/webrtc/transport"}).c("roap",Base64.encode(o)),i='SDP\n{\n"answererSessionId":"'+s.offererSessionId+'",\n'+'"messageType":"OK",\n'+'"offererSessionId":"'+s.answererSessionId+'",\n'+'"seq":1\n}',setTimeout(function(){console.log("H->C SDP: "+i),t.processSignalingMessage(i)},1),a()):"OFFER"==s.messageType?-1!=n.indexOf("video")?(n=e,c.c("transport",{xmlns:"http://phono.com/webrtc/transport"}).c("roap",Base64.encode(n)),l()):(roapAnswer=$.parseJSON(WebRTCAudio.offer.substring(4,e.length)),fakeAnswer='SDP\n{\n"answererSessionId":"'+s.answererSessionId+'",\n'+'"messageType":"ANSWER",\n'+'"offererSessionId":"'+s.offererSessionId+'",\n'+'"seq":2,\n'+'"sdp":"'+roapAnswer.sdp+'"}',console.log("H->C SDP: "+fakeAnswer),t.processSignalingMessage(fakeAnswer)):console.log("Recieved unexpected ROAP: "+e)}),t.onaddstream=function(e){console.log("Remote stream added."),console.log("Local stream is: "+WebRTCAudio.localStream);var t=webkitURL.createObjectURL(e.stream);s.style.opacity=1,s.src=t},t.onremovestream=function(){conole.log("Remote stream removed.")},console.log("Created new PeerConnection, passing it :"+n),t.addStream(WebRTCAudio.localStream),t.processSignalingMessage(n)):(null!=t&&(t.close(),t=null),t=new WebRTCAudio.peerConnection(WebRTCAudio.stun,function(e){console.log("C->S SDP: "+e),e=e.replace("s=","s=Canary");var t=$.parseJSON(e.substring(4,e.length));"OFFER"==t.messageType?(r.c("transport",{xmlns:"http://phono.com/webrtc/transport"}).c("roap",Base64.encode(e)),n=e,a()):"OK"==t.messageType||("ANSWER"==t.messageType?(o=e,c.c("transport",{xmlns:"http://phono.com/webrtc/transport"}).c("roap",Base64.encode(o)),l()):console.log("Recieved unexpected ROAP: "+e))}),t.onaddstream=function(e){console.log("Remote stream added."),console.log("Local stream is: "+WebRTCAudio.localStream);var t=webkitURL.createObjectURL(e.stream);s.style.opacity=1,s.src=t},t.addStream(WebRTCAudio.localStream),console.log("Created PeerConnection for new OUTBOUND CALL"))},processTransport:function(e,o){var i,r;return e.find("roap").each(function(){var e=this.textContent;r=Base64.decode(e),console.log("S->C SDP: "+r),i=$.parseJSON(r.substring(4,r.length))}),"OFFER"==i.messageType?(n=r,null!=t&&1==o&&t.processSignalingMessage(r)):"ANSWER"==i.messageType&&t.processSignalingMessage(r),{input:{uri:"webrtc"},output:{getPC:function(){return t}}}}}},WebRTCAudio.prototype.codecs=function(){var e=Array();return e.push({id:1,name:"webrtc",rate:16e3,p:20}),e},WebRTCAudio.prototype.audioInDevices=function(){var e=Array();return e},WebRTCAudio.prototype.createContainer=function(){var e=$("<video>").attr("id","_phono-audio-webrtc"+WebRTCAudio.count++).attr("autoplay","autoplay").appendTo("body"),t=$(e).attr("id");return t},Phono.registerPlugin("audio",{create:function(e,t,n){return t=Phono.util.extend({type:"auto"},t),"java"===t.type?Phono.util.loggify("JavaAudio",new JavaAudio(e,t,n)):"phonegap-ios"===t.type?Phono.util.loggify("PhonegapIOSAudio",new PhonegapIOSAudio(e,t,n)):"phonegap-android"===t.type?Phono.util.loggify("PhonegapAndroidAudio",new PhonegapAndroidAudio(e,t,n)):"flash"===t.type?Phono.util.loggify("FlashAudio",new FlashAudio(e,t,n)):"webrtc"===t.type?Phono.util.loggify("WebRTCAudio",new WebRTCAudio(e,t,n)):"jsep"===t.type?Phono.util.loggify("JSEPAudio",new JSEPAudio(e,t,n)):"none"===t.type?(window.setTimeout(n,10),null):"auto"===t.type?(console.log("Detecting Audio Plugin"),PhonegapIOSAudio.exists()?(console.log("Detected iOS"),Phono.util.loggify("PhonegapIOSAudio",new PhonegapIOSAudio(e,t,n))):PhonegapAndroidAudio.exists()?(console.log("Detected Android"),Phono.util.loggify("PhonegapAndroidAudio",new PhonegapAndroidAudio(e,t,n))):(console.log("Detected Flash"),Phono.util.loggify("FlashAudio",new FlashAudio(e,t,n)))):void 0}})}(),function(){function e(e){this.from=null,this.body=null,this.connection=e}function t(e,t,n){this.connection=e.connection,this.connection.addHandler(this.handleMessage.bind(this),null,"message","chat"),Phono.events.bind(this,t),n(this)}e.prototype.reply=function(e){this.connection.send($msg({to:this.from,type:"chat"}).c("body").t(e))},t.prototype.send=function(e,t){this.connection.send($msg({to:e,type:"chat"}).c("body").t(t))},t.prototype.handleMessage=function(t){var n=new e(this.connection);return n.from=Strophe.getBareJidFromJid($(t).attr("from")),n.body=$(t).find("body").text(),Phono.events.trigger(this,"message",{message:n},[n]),!0},Phono.registerPlugin("messaging",{create:function(e,n,o){return new t(e,n,o)}})}(),function(){function e(e,t,o,i){var r=this;this.phone=e,this.phono=e.phono,this.audioLayer=this.phono.audio,this.transport=this.audioLayer.transport(i),this.connection=this.phono.connection,this.config=Phono.util.extend({pushToTalk:!1,mute:!1,talking:!1,hold:!1,volume:50,gain:50,tones:!1,codecs:e.config.codecs,security:e._security},i),Phono.util.each(this.config,function(e,t){"function"==typeof r[e]&&r[e](t)}),this.id=t,this.direction=o,this.state=n.INITIAL,this.remoteJid=null,this.initiator=null,this.codec=null,this.srtpPropsr=void 0,this.srtpPropsl=void 0,"disabled"!=this._security&&1==this.transport.supportsSRTP&&(this.tag="1",this.crypto="AES_CM_128_HMAC_SHA1_80",this.keyparams="inline:"+Phono.util.genKey(30),this.srtpPropsl=Phono.util.srtpProps(this.tag,this.crypto,this.keyparams)),this.headers=[],this.config.headers&&(this.headers=this.config.headers),Phono.events.bind(this,i),this.ringer=this.audioLayer.play({uri:e.ringTone()}),this.ringback=this.audioLayer.play({uri:e.ringbackTone()}),this.audioLayer.audioIn&&this.audioLayer.audioIn(e.audioInput())}function t(e,t,n){var o=this;this.phono=e,this.connection=e.connection,this.calls={},this._wideband=!0,this.config=Phono.util.extend({audioInput:"System Default",ringTone:"//s.phono.com/ringtones/Diggztone_Marimba.mp3",ringbackTone:"//s.phono.com/ringtones/ringback-us.mp3",wideband:!0,headset:!1,codecs:function(e){return e},security:"optional"},t),Phono.util.each(this.config,function(e,t){"function"==typeof o[e]&&o[e](t)}),Phono.events.bind(this,t),this.connection.addHandler(this.doJingle.bind(this),Strophe.NS.JINGLE,"iq","set"),n(this)}Strophe.addNamespace("JINGLE","urn:xmpp:jingle:1"),Strophe.addNamespace("JINGLE_SESSION_INFO","urn:xmpp:jingle:apps:rtp:1:info");var n={CONNECTED:0,RINGING:1,DISCONNECTED:2,PROGRESS:3,INITIAL:4},o={OUTBOUND:0,INBOUND:1};e.prototype.bind=function(e){Phono.events.bind(this,e)},e.prototype.startAudio=function(){this.input&&this.input.start(),this.output&&this.output.start()},e.prototype.stopAudio=function(){this.input&&this.input.stop(),this.output&&this.output.stop()},e.prototype.start=function(){var e=this;if(e.state==n.INITIAL){var t=$iq({type:"set",to:e.remoteJid}),o=t.c("jingle",{xmlns:Strophe.NS.JINGLE,action:"session-initiate",initiator:e.initiator,sid:e.id});$(e.headers).each(function(){o.c("custom-header",{name:this.name,data:this.value}).up()});var i=o.c("content",{creator:"initiator"}).c("description",{xmlns:this.transport.description});Phono.util.each(this.config.codecs(Phono.util.filterWideband(this.audioLayer.codecs(),this.phone.wideband())),function(){i=i.c("payload-type",{id:this.id,name:this.name,clockrate:this.rate}).up()});var r="0";"mandatory"==e._security&&(r="1"),"disabled"!=e._security&&1==this.transport.supportsSRTP&&(i=i.c("encryption",{required:r}).c("crypto",{tag:e.tag,"crypto-suite":e.crypto,"key-params":e.keyparams}).up());var s=$iq({type:"set",to:e.remoteJid}),a=s.c("jingle",{xmlns:Strophe.NS.JINGLE,action:"transport-accept",initiator:e.initiator,sid:e.id}),c=a.c("content",{creator:"initiator"}).c("description",{xmlns:this.transport.description});this.transport.buildTransport("offer",i.up(),function(){e.connection.sendIQ(t,function(){e.state=n.PROGRESS})},c.up(),function(){e.connection.sendIQ(s,function(){})})}},e.prototype.accept=function(){var e=this;if(e.state==n.PROGRESS){var t=$iq({type:"set",to:e.remoteJid}).c("jingle",{xmlns:Strophe.NS.JINGLE,action:"session-info",initiator:e.initiator,sid:e.id}).c("ringing",{xmlns:Strophe.NS.JINGLE_SESSION_INFO});this.connection.sendIQ(t,function(){e.state=n.RINGING,Phono.events.trigger(e,"ring")})}},e.prototype.answer=function(){var e=this;if(e.state==n.RINGING||e.state==n.PROGRESS){var t=$iq({type:"set",to:e.remoteJid}),o=t.c("jingle",{xmlns:Strophe.NS.JINGLE,action:"session-accept",initiator:e.initiator,sid:e.id}),i=o.c("content",{creator:"initiator"}).c("description",{xmlns:this.transport.description});i=i.c("payload-type",{id:e.codec.id,name:e.codec.name,clockrate:e.codec.rate}).up(),$.each(e.audioLayer.codecs(),function(){"telephone-event"==this.name&&(i=i.c("payload-type",{id:this.id,name:this.name,clockrate:this.rate}).up())}),void 0!=e.srtpPropsl&&void 0!=e.srtpPropsr&&(i=i.c("encryption").c("crypto",{tag:e.tag,"crypto-suite":e.crypto,"key-params":e.keyparams}).up());var r=$iq({type:"set",to:e.remoteJid}),s=r.c("jingle",{xmlns:Strophe.NS.JINGLE,action:"transport-replace",initiator:e.initiator,sid:e.id}),a=s.c("content",{creator:"initiator"}).c("description",{xmlns:this.transport.description});this.transport.buildTransport("answer",i.up(),function(){e.connection.sendIQ(t,function(){e.state=n.CONNECTED,Phono.events.trigger(e,"answer"),null!=e.ringer&&e.ringer.stop(),e.startAudio()})},a.up(),function(){e.connection.sendIQ(r,function(){})})}},e.prototype.bindAudio=function(e){this.input=e.input,this.output=e.output,this.volume(this.volume()),this.gain(this.gain()),this.mute(this.mute()),this.hold(this.hold()),this.headset(this.headset()),this.pushToTalkStateChanged(),Phono.events.bind(this.output,{onMediaReady:function(){Phono.events.trigger(call,"mediaReady")}})},e.prototype.hangup=function(){var e=this;if(e.state==n.CONNECTED||e.state==n.RINGING||e.state==n.PROGRESS){var t=$iq({type:"set",to:e.remoteJid}).c("jingle",{xmlns:Strophe.NS.JINGLE,action:"session-terminate",initiator:e.initiator,sid:e.id});this.connection.sendIQ(t,function(){e.state=n.DISCONNECTED,Phono.events.trigger(e,"hangup"),e.stopAudio(),null!=e.ringer&&e.ringer.stop(),null!=e.ringback&&e.ringback.stop()})}},e.prototype.digit=function(e,t){t||(t=349),this.output.digit(e,t,this._tones)},e.prototype.pushToTalk=function(e){return 0===arguments.length?this._pushToTalk:(this._pushToTalk=e,this.pushToTalkStateChanged(),void 0)},e.prototype.talking=function(e){return 0===arguments.length?this._talking:(this._talking=e,this.pushToTalkStateChanged(),void 0)},e.prototype.mute=function(e){return 0===arguments.length?this._mute:(this._mute=e,this.output&&this.output.mute(e),void 0)},e.prototype.hold=function(){},e.prototype.volume=function(e){return 0===arguments.length?this._volume:(this._volume=e,this.input&&this.input.volume(e),void 0)},e.prototype.tones=function(e){return 0===arguments.length?this._tones:(this._tones=e,void 0)},e.prototype.gain=function(e){return 0===arguments.length?this._gain:(this._gain=e,this.output&&this.output.gain(e),void 0)},e.prototype.energy=function(){return this.output&&(ret=this.output.energy()),ret},e.prototype.secure=function(){var e=!1;return this.output&&(e=this.output.secure()),e},e.prototype.security=function(e){return 0===arguments.length?this._security:(this._security=e,void 0)},e.prototype.headset=function(e){return 0===arguments.length?this._headset:(this._headset=e,this.output&&this.output.suppress(!e),void 0)},e.prototype.pushToTalkStateChanged=function(){this.input&&this.output&&(this._pushToTalk?this._talking?(this.input.volume(20),this.output.mute(!1)):(this.input.volume(this._volume),this.output.mute(!0)):(this.input.volume(this._volume),this.output.mute(!1)))},e.prototype.negotiate=function(e){var t=this,n=$(e).find("description"),o=null;if(n.find("payload-type").each(function(){var e=$(this).attr("name"),n=$(this).attr("clockrate"),i=$(this).attr("id");$.each(t.config.codecs(Phono.util.filterWideband(t.audioLayer.codecs(),t.phone.wideband())),function(){return this.name==e&&this.rate==n&&"telephone-event"!=this.name||90>parseInt(this.id)&&this.id==i?(null==o&&(o={id:i,name:this.name,rate:this.rate,p:this.p}),!1):void 0})}),o||(Phono.log.error("No matching jingle codec (not a problem if using WebRTC)"),o={id:1,name:"webrtc-ulaw",rate:8e3,p:20}),"disabled"!=t._security&&1==this.transport.supportsSRTP&&n.find("crypto").each(function(){$(this).attr("crypto-suite")==t.crypto&&(t.srtpPropsr=Phono.util.srtpProps($(this).attr("tag"),$(this).attr("crypto-suite"),$(this).attr("key-params"),$(this).attr("session-params")),t.tag=$(this).attr("tag"))}),"mandatory"==t._security&&void 0==t.srtpPropsr)return Phono.log.error("No security when mandatory specified"),null;var i=!1;return $(e).find("transport").each(function(){if(t.transport.name==$(this).attr("xmlns")&&0==i){var e=t.transport.processTransport($(this),!1);void 0!=e?(t.bindAudio({input:t.audioLayer.play(e.input,!1),output:t.audioLayer.share(e.output,!1,o,t.srtpPropsl,t.srtpPropsr)}),i=!0):Phono.log.error("No valid candidate in transport")}}),"mandatory"==t._security&&0==t.output.secure()?(Phono.log.error("Security error, share not secure when mandatory specified"),null):0==i?(Phono.log.error("No matching valid transport"),null):o},t.prototype.doJingle=function(t){var i=this,r=this.phono.audio,s=$(t).find("jingle"),a=s.attr("action")||"",c=s.attr("sid")||"",l=this.calls[c]||null;switch(a){case"session-initiate":if(l=Phono.util.loggify("Call",new e(i,c,o.INBOUND)),l.phone=i,l.remoteJid=$(t).attr("from"),l.initiator=s.attr("initiator"),i.calls[l.id]=l,l.state=n.PROGRESS,l.codec=l.negotiate(t),null==l.codec){Phono.log.warn("Failed to negotiate incoming call",t),l.hangup();break}l.headers=Array(),s.find("custom-header").each(function(){l.headers.push({name:$(this).attr("name"),value:$(this).attr("data")})}),null!=l.ringer&&l.ringer.start(),l.accept(),Phono.events.trigger(this,"incomingCall",{call:l}),r.permission()||Phono.events.trigger(r,"permissionBoxShow");break;case"session-accept":if(l.codec=l.negotiate(t),null==l.codec){Phono.log.warn("Failed to negotiate outbound call",t),l.hangup();break}l.state=n.CONNECTED,null!=l.ringback&&l.ringback.stop(),l.startAudio(),Phono.events.trigger(l,"answer");break;case"transport-replace":case"transport-accept":l.transport.processTransport($(t),!0);break;case"session-terminate":l.state=n.DISCONNECTED,l.stopAudio(),null!=l.ringer&&l.ringer.stop(),null!=l.ringback&&l.ringback.stop(),Phono.events.trigger(l,"hangup");break;case"session-info":$(t).find("ringing")&&(l.state=n.RINGING,null!=l.ringback&&l.ringback.start(),Phono.events.trigger(l,"ring"))}return this.connection.send($iq({type:"result",id:$(t).attr("id"),to:l.remoteJid})),!0},t.prototype.dial=function(t,n){var i=Phono.util.guid();n=Phono.util.extend({headset:this.headset()},n||{});var r=new Phono.util.loggify("Call",new e(this,i,o.OUTBOUND,n));return r.phone=this,r.remoteJid=t,r.initiator=this.connection.jid,this.beforeDial(r),this.calls[r.id]=r,r.start(),r},t.prototype.beforeDial=function(e){var t=e.remoteJid;if(t.match("^sip:")||t.match("^sips:"))e.remoteJid=Phono.util.escapeXmppNode(t.substr(4))+"@sip";else if(t.match("^xmpp:"))e.remoteJid=t.substr(5);else if(t.match("^app:"))e.remoteJid=Phono.util.escapeXmppNode(t.substr(4))+"@app";else if(t.match("^tel:"))e.remoteJid="9996182316@app",e.headers.push({name:"x-numbertodial",value:t.substr(4)});else{var n=t.replace(/[\(\)\-\.\ ]/g,"");n.match(/^\+?\d+$/)?(e.remoteJid="9996182316@app",e.headers.push({name:"x-numbertodial",value:n})):t.indexOf("@")>0&&(e.remoteJid=Phono.util.escapeXmppNode(t)+"@sip")}},t.prototype.audioInput=function(e){return 0==arguments.length?this._audioInput:(this._audioInput=e,void 0)},t.prototype.audioInDevices=function(){var e=this.phono.audio,t=Object();return e.audioInDevices&&(t=e.audioInDevices()),t},t.prototype.ringTone=function(e){return 0==arguments.length?this._ringTone:(this._ringTone=e,void 0)},t.prototype.ringbackTone=function(e){return 0==arguments.length?this._ringbackTone:(this._ringbackTone=e,void 0)},t.prototype.headset=function(e){return 0==arguments.length?this._headset:(this._headset=e,Phono.util.each(this.calls,function(){this.headset(e)}),void 0)},t.prototype.wideband=function(e){return 0==arguments.length?this._wideband:(this._wideband=e,void 0)},t.prototype.security=function(e){return 0==arguments.length?this._security:(this._security=e,void 0)},Phono.registerPlugin("phone",{create:function(e,n,o){return Phono.util.loggify("Phone",new t(e,n,o))}})}(),Strophe.log=function(e,t){Phono.log.debug("[STROPHE] "+t)},Phono.events.add(Phono.log,"log",function(e){var t=e.timeStamp,n=Phono.util.padWithZeroes(t.getHours(),2)+":"+Phono.util.padWithZeroes(t.getMinutes(),2)+":"+Phono.util.padWithZeroes(t.getSeconds(),2)+"."+Phono.util.padWithZeroes(t.getMilliseconds(),3),o=n+" "+Phono.util.padWithSpaces(e.level.name,5)+" - "+e.getCombinedMessages(),i=e.getThrowableStrRep();i&&(o+=newLine+i),console.log(o)}),PluginManager.prototype.init=function(){this.chain()},PluginManager.prototype.chain=function(){var e=this,t=e.pluginNames[this.index];Phono.plugins[t].create(e.phono,e.config[t],function(n){e.phono[t]=n,e.index++,e.index===e.pluginNames.length?e.readyHandler.apply(e.phono):e.chain()})}})(),window.Phono=Phono,$.phono=function(e){return new Phono(e)}})(jQuery);var io="undefined"==typeof module?{}:module.exports;(function(){if(function(e,t){var n=e;n.version="0.9.11",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,o){var i,r,s=n.util.parseUri(e);t&&t.location&&(s.protocol=s.protocol||t.location.protocol.slice(0,-1),s.host=s.host||(t.document?t.document.domain:t.location.hostname),s.port=s.port||t.location.port),i=n.util.uniqueUri(s);var a={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return n.util.merge(a,o),(a["force new connection"]||!n.sockets[i])&&(r=new n.Socket(a)),!a["force new connection"]&&r&&(n.sockets[i]=r),r=r||n.sockets[i],r.of(s.path.length>1?s.path:"")}}("object"==typeof module?module.exports:this.io={},this),function(e,t){var n=e.util={},o=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=o.exec(e||""),n={},r=14;r--;)n[i[r]]=t[r]||"";return n},n.uniqueUri=function(e){var n=e.protocol,o=e.host,i=e.port;return"document"in t?(o=o||document.domain,i=i||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(o=o||"localhost",i||"https"!=n||(i=443)),(n||"http")+"://"+o+":"+(i||80)},n.query=function(e,t){var o=n.chunkQuery(e||""),i=[];n.merge(o,n.chunkQuery(t||""));for(var r in o)o.hasOwnProperty(r)&&i.push(r+"="+o[r]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(e){for(var t,n={},o=e.split("&"),i=0,r=o.length;r>i;++i)t=o[i].split("="),t[0]&&(n[t[0]]=t[1]);return n};var r=!1;n.load=function(e){return"document"in t&&"complete"===document.readyState||r?e():(n.on(t,"load",e,!1),void 0)},n.on=function(e,t,n,o){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,o)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!n.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null},"undefined"!=typeof window&&n.load(function(){r=!0}),n.defer=function(e){return n.ua.webkit&&"undefined"==typeof importScripts?(n.load(function(){setTimeout(e,100)}),void 0):e()},n.merge=function(e,t,o,i){var r,s=i||[],a=o===void 0?2:o;for(r in t)t.hasOwnProperty(r)&&0>n.indexOf(s,r)&&("object"==typeof e[r]&&a?n.merge(e[r],t[r],a-1,s):(e[r]=t[r],s.push(t[r])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var o=[],i=e.length>t.length?e:t,r=e.length>t.length?t:e,s=0,a=r.length;a>s;s++)~n.indexOf(i,r[s])&&o.push(r[s]);return o},n.indexOf=function(e,t,n){for(var o=e.length,n=0>n?0>n+o?0:n+o:n||0;o>n&&e[n]!==t;n++);return n>=o?-1:n},n.toArray=function(e){for(var t=[],n=0,o=e.length;o>n;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return void 0!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),n.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}(io!==void 0?io:module.exports,this),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){o.removeListener(e,n),t.apply(this,arguments)}var o=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var o=this.$events[e];if(t.util.isArray(o)){for(var i=-1,r=0,s=o.length;s>r;r++)if(o[r]===n||o[r].listener&&o[r].listener===n){i=r;break}if(0>i)return this;o.splice(i,1),o.length||delete this.$events[e]}else(o===n||o.listener&&o.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return void 0===e?(this.$events={},this):(this.$events&&this.$events[e]&&(this.$events[e]=null),this)},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var o=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,o);else{if(!t.util.isArray(n))return!1;for(var i=n.slice(),r=0,s=i.length;s>r;r++)i[r].apply(this,o)}return!0}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(e){return 10>e?"0"+e:e}function date(e){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,o,i,r,s,a=gap,c=t[e];switch(c instanceof Date&&(c=date(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?c+"":"null";case"boolean":case"null":return c+"";case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(r=c.length,n=0;r>n;n+=1)s[n]=str(n,c)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,i}if(rep&&"object"==typeof rep)for(r=rep.length,n=0;r>n;n+=1)"string"==typeof rep[n]&&(o=rep[n],i=str(o,c),i&&s.push(quote(o)+(gap?": ":":")+i));else for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(i=str(o,c),i&&s.push(quote(o)+(gap?": ":":")+i));return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,i}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var o;if(gap="",indent="","number"==typeof n)for(o=0;n>o;o+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw Error("JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){function walk(e,t){var n,o,i=e[t];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(o=walk(i,n),void 0!==o?i[n]=o:delete i[n]);return reviver.call(e,t,i)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(io!==void 0?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},o=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],r=n.advice=["reconnect"],s=t.JSON,a=t.util.indexOf;n.encodePacket=function(e){var t=a(o,e.type),n=e.id||"",c=e.endpoint||"",l=e.ack,u=null;switch(e.type){case"error":var h=e.reason?a(i,e.reason):"",p=e.advice?a(r,e.advice):"";(""!==h||""!==p)&&(u=h+(""!==p?"+"+p:""));break;case"message":""!==e.data&&(u=e.data);break;case"event":var d={name:e.name};e.args&&e.args.length&&(d.args=e.args),u=s.stringify(d);break;case"json":u=s.stringify(e.data);break;case"connect":e.qs&&(u=e.qs);break;case"ack":u=e.ackId+(e.args&&e.args.length?"+"+s.stringify(e.args):"")}var f=[t,n+("data"==l?"+":""),c];return null!==u&&void 0!==u&&f.push(u),f.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,o=e.length;o>n;n++){var i=e[n];t+="�"+i.length+"�"+e[n]}return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){var t=e.match(c);if(!t)return{};var n=t[2]||"",e=t[5]||"",a={type:o[t[1]],endpoint:t[4]||""};switch(n&&(a.id=n,a.ack=t[3]?"data":!0),a.type){case"error":var t=e.split("+");a.reason=i[t[0]]||"",a.advice=r[t[1]]||"";break;case"message":a.data=e||"";break;case"event":try{var l=s.parse(e);a.name=l.name,a.args=l.args}catch(u){}a.args=a.args||[];break;case"json":try{a.data=s.parse(e)}catch(u){}break;case"connect":a.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t&&(a.ackId=t[1],a.args=[],t[3]))try{a.args=t[3]?s.parse(t[3]):[]}catch(u){}break;case"disconnect":case"heartbeat":}return a},n.decodePayload=function(e){if("�"==e.charAt(0)){for(var t=[],o=1,i="";e.length>o;o++)"�"==e.charAt(o)?(t.push(n.decodePacket(e.substr(o+1).substr(0,i))),o+=Number(i)+1,i=""):i+=e.charAt(o);return t}return[n.decodePacket(e)]}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.heartbeats=function(){return!0},n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var o=0,i=n.length;i>o;o++)this.onPacket(n[o])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpen=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(e,t,n){function o(e){if(this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var o=this;t.util.on(n,"beforeunload",function(){o.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=o,t.util.mixin(o,t.EventEmitter),o.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},o.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},o.prototype.handshake=function(e){function n(t){t instanceof Error?(o.connecting=!1,o.onError(t.message)):e.apply(null,t.split(":"))}var o=this,r=this.options,s=["http"+(r.secure?"s":"")+":/",r.host+":"+r.port,r.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");
if(this.isXDomain()&&!t.util.ua.hasCORS){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+t.j.length,a.parentNode.insertBefore(c,a),t.j.push(function(e){n(e),c.parentNode.removeChild(c)})}else{var l=t.util.request();l.open("GET",s,!0),this.isXDomain()&&(l.withCredentials=!0),l.onreadystatechange=function(){4==l.readyState&&(l.onreadystatechange=i,200==l.status?n(l.responseText):403==l.status?o.onError(l.responseText):(o.connecting=!1,!o.reconnecting&&o.onError(l.responseText)))},l.send(null)}},o.prototype.getTransport=function(e){for(var n,o=e||this.transports,i=0;n=o[i];i++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck(this)))return new t.Transport[n](this,this.sessionid);return null},o.prototype.connect=function(e){if(this.connecting)return this;var n=this;return n.connecting=!0,this.handshake(function(o,i,r,s){function a(e){return n.transport&&n.transport.clearTimeouts(),n.transport=n.getTransport(e),n.transport?(n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected&&(n.connecting=!1,n.options["try multiple transports"])){for(var e=n.transports;e.length>0&&e.splice(0,1)[0]!=n.transport.name;);e.length?a(e):n.publish("connect_failed")}},n.options["connect timeout"]))}),void 0):n.publish("connect_failed")}n.sessionid=o,n.closeTimeout=1e3*r,n.heartbeatTimeout=1e3*i,n.transports||(n.transports=n.origTransports=s?t.util.intersect(s.split(","),n.options.transports):n.options.transports),n.setHeartbeatTimeout(),a(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},o.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)}},o.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},o.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},o.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},o.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},o.prototype.disconnectSync=function(){var e=t.util.request(),n=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",n,!1),e.send(null),this.onDisconnect("booted")},o.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},o.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},o.prototype.onOpen=function(){this.open=!0},o.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},o.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},o.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},o.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},o.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=i}function t(){return n.reconnecting?n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):(n.reconnectionAttempts++>=o?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transports=n.origTransports,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(r>n.reconnectionDelay&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)),void 0):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,o=this.options["max reconnection attempts"],i=this.options["try multiple transports"],r=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports,this),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new o(this,"json"),this.ackPackets=0,this.acks={}}function o(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],o={type:"event",name:e};return"function"==typeof n&&(o.id=++this.ackPackets,o.ack="data",this.acks[o.id]=n,t=t.slice(0,t.length-1)),o.args=t,this.packet(o)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){o.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var o=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var i=["message",e.data];"data"==e.ack?i.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":var i=[e.name].concat(e.args);"data"==e.ack&&i.push(n),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},o.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},o.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(e,t,n){function o(){t.Transport.apply(this,arguments)}e.websocket=o,t.util.inherit(o,t.Transport),o.prototype.name="websocket",o.prototype.open=function(){var e,o=t.util.query(this.socket.options.query),i=this;return e||(e=n.MozWebSocket||n.WebSocket),this.websocket=new e(this.prepareUrl()+o),this.websocket.onopen=function(){i.onOpen(),i.socket.setBuffer(!1)},this.websocket.onmessage=function(e){i.onData(e.data)},this.websocket.onclose=function(){i.onClose(),i.socket.setBuffer(!0)},this.websocket.onerror=function(e){i.onError(e)},this},o.prototype.send=t.util.ua.iDevice?function(e){var t=this;return setTimeout(function(){t.websocket.send(e)},0),this}:function(e){return this.websocket.send(e),this},o.prototype.payload=function(e){for(var t=0,n=e.length;n>t;t++)this.packet(e[t]);return this},o.prototype.close=function(){return this.websocket.close(),this},o.prototype.onError=function(e){this.socket.onError(e)},o.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},o.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},o.xdomainCheck=function(){return!0},t.transports.push("websocket")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,this),function(e,t){function n(){t.Transport.websocket.apply(this,arguments)}e.flashsocket=n,t.util.inherit(n,t.Transport.websocket),n.prototype.name="flashsocket",n.prototype.open=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.open.apply(e,n)}),this},n.prototype.send=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.send.apply(e,n)}),this},n.prototype.close=function(){return WebSocket.__tasks.length=0,t.Transport.websocket.prototype.close.call(this),this},n.prototype.ready=function(e,o){function i(){var t=e.options,i=t["flash policy port"],s=["http"+(t.secure?"s":"")+":/",t.host+":"+t.port,t.resource,"static/flashsocket","WebSocketMain"+(e.isXDomain()?"Insecure":"")+".swf"];n.loaded||("undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=s.join("/")),843!==i&&WebSocket.loadFlashPolicyFile("xmlsocket://"+t.host+":"+i),WebSocket.__initialize(),n.loaded=!0),o.call(r)}var r=this;return document.body?i():(t.util.load(i),void 0)},n.check=function(){return"undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject?swfobject.getFlashPlayerVersion().major>=10:!1},n.xdomainCheck=function(){return!0},"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),t.transports.push("flashsocket")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports),"undefined"!=typeof window)var swfobject=function(){function e(){if(!B){try{var e=F.getElementsByTagName("body")[0].appendChild(m("span"));e.parentNode.removeChild(e)}catch(t){return}B=!0;for(var n=j.length,o=0;n>o;o++)j[o]()}}function t(e){B?e():j[j.length]=e}function n(e){if(typeof L.addEventListener!=I)L.addEventListener("load",e,!1);else if(typeof F.addEventListener!=I)F.addEventListener("load",e,!1);else if(typeof L.attachEvent!=I)v(L,"onload",e);else if("function"==typeof L.onload){var t=L.onload;L.onload=function(){t(),e()}}else L.onload=e}function o(){M?i():r()}function i(){var e=F.getElementsByTagName("body")[0],t=m(O);t.setAttribute("type",x);var n=e.appendChild(t);if(n){var o=0;(function(){if(typeof n.GetVariable!=I){var i=n.GetVariable("$version");i&&(i=i.split(" ")[1].split(","),$.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)])}else if(10>o)return o++,setTimeout(arguments.callee,10),void 0;e.removeChild(t),n=null,r()})()}else r()}function r(){var e=H.length;if(e>0)for(var t=0;e>t;t++){var n=H[t].id,o=H[t].callbackFn,i={success:!1,id:n};if($.pv[0]>0){var r=g(n);if(r)if(!y(H[t].swfVersion)||$.wk&&312>$.wk)if(H[t].expressInstall&&a()){var u={};u.data=H[t].expressInstall,u.width=r.getAttribute("width")||"0",u.height=r.getAttribute("height")||"0",r.getAttribute("class")&&(u.styleclass=r.getAttribute("class")),r.getAttribute("align")&&(u.align=r.getAttribute("align"));for(var h={},p=r.getElementsByTagName("param"),d=p.length,f=0;d>f;f++)"movie"!=p[f].getAttribute("name").toLowerCase()&&(h[p[f].getAttribute("name")]=p[f].getAttribute("value"));c(u,h,n,o)}else l(r),o&&o(i);else S(n,!0),o&&(i.success=!0,i.ref=s(n),o(i))}else if(S(n,!0),o){var m=s(n);m&&typeof m.SetVariable!=I&&(i.success=!0,i.ref=m),o(i)}}}function s(e){var t=null,n=g(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=I)t=n;else{var o=n.getElementsByTagName(O)[0];o&&(t=o)}return t}function a(){return!W&&y("6.0.65")&&($.win||$.mac)&&!($.wk&&312>$.wk)}function c(e,t,n,o){W=!0,C=o||null,R={success:!1,id:n};var i=g(n);if(i){"OBJECT"==i.nodeName?(T=u(i),b=null):(T=i,b=n),e.id=D,(typeof e.width==I||!/%$/.test(e.width)&&310>parseInt(e.width,10))&&(e.width="310"),(typeof e.height==I||!/%$/.test(e.height)&&137>parseInt(e.height,10))&&(e.height="137"),F.title=F.title.slice(0,47)+" - Flash Player Installation";var r=$.ie&&$.win?["Active"].concat("").join("X"):"PlugIn",s="MMredirectURL="+(""+L.location).replace(/&/g,"%26")+"&MMplayerType="+r+"&MMdoctitle="+F.title;if(typeof t.flashvars!=I?t.flashvars+="&"+s:t.flashvars=s,$.ie&&$.win&&4!=i.readyState){var a=m("div");n+="SWFObjectNew",a.setAttribute("id",n),i.parentNode.insertBefore(a,i),i.style.display="none",function(){4==i.readyState?i.parentNode.removeChild(i):setTimeout(arguments.callee,10)}()}h(e,t,n)}}function l(e){if($.ie&&$.win&&4!=e.readyState){var t=m("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(u(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(u(e),e)}function u(e){var t=m("div");if($.win&&$.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(O)[0];if(n){var o=n.childNodes;if(o)for(var i=o.length,r=0;i>r;r++)1==o[r].nodeType&&"PARAM"==o[r].nodeName||8==o[r].nodeType||t.appendChild(o[r].cloneNode(!0))}}return t}function h(e,t,n){var o,i=g(n);if($.wk&&312>$.wk)return o;if(i)if(typeof e.id==I&&(e.id=n),$.ie&&$.win){var r="";for(var s in e)e[s]!=Object.prototype[s]&&("data"==s.toLowerCase()?t.movie=e[s]:"styleclass"==s.toLowerCase()?r+=' class="'+e[s]+'"':"classid"!=s.toLowerCase()&&(r+=" "+s+'="'+e[s]+'"'));var a="";for(var c in t)t[c]!=Object.prototype[c]&&(a+='<param name="'+c+'" value="'+t[c]+'" />');i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+r+">"+a+"</object>",q[q.length]=e.id,o=g(e.id)}else{var l=m(O);l.setAttribute("type",x);for(var u in e)e[u]!=Object.prototype[u]&&("styleclass"==u.toLowerCase()?l.setAttribute("class",e[u]):"classid"!=u.toLowerCase()&&l.setAttribute(u,e[u]));for(var h in t)t[h]!=Object.prototype[h]&&"movie"!=h.toLowerCase()&&p(l,h,t[h]);i.parentNode.replaceChild(l,i),o=l}return o}function p(e,t,n){var o=m("param");o.setAttribute("name",t),o.setAttribute("value",n),e.appendChild(o)}function d(e){var t=g(e);t&&"OBJECT"==t.nodeName&&($.ie&&$.win?(t.style.display="none",function(){4==t.readyState?f(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function f(e){var t=g(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}function g(e){var t=null;try{t=F.getElementById(e)}catch(n){}return t}function m(e){return F.createElement(e)}function v(e,t,n){e.attachEvent(t,n),G[G.length]=[e,t,n]}function y(e){var t=$.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function _(e,t,n,o){if(!$.ie||!$.mac){var i=F.getElementsByTagName("head")[0];if(i){var r=n&&"string"==typeof n?n:"screen";if(o&&(A=null,w=null),!A||w!=r){var s=m("style");s.setAttribute("type","text/css"),s.setAttribute("media",r),A=i.appendChild(s),$.ie&&$.win&&typeof F.styleSheets!=I&&F.styleSheets.length>0&&(A=F.styleSheets[F.styleSheets.length-1]),w=r}$.ie&&$.win?A&&typeof A.addRule==O&&A.addRule(e,t):A&&typeof F.createTextNode!=I&&A.appendChild(F.createTextNode(e+" {"+t+"}"))}}}function S(e,t){if(J){var n=t?"visible":"hidden";B&&g(e)?g(e).style.visibility=n:_("#"+e,"visibility:"+n)}}function E(e){var t=/[\\\"<>\.;]/,n=null!=t.exec(e);return n&&typeof encodeURIComponent!=I?encodeURIComponent(e):e}var T,b,C,R,A,w,I="undefined",O="object",N="Shockwave Flash",P="ShockwaveFlash.ShockwaveFlash",x="application/x-shockwave-flash",D="SWFObjectExprInst",k="onreadystatechange",L=window,F=document,U=navigator,M=!1,j=[o],H=[],q=[],G=[],B=!1,W=!1,J=!0,$=function(){var e=typeof F.getElementById!=I&&typeof F.getElementsByTagName!=I&&typeof F.createElement!=I,t=U.userAgent.toLowerCase(),n=U.platform.toLowerCase(),o=n?/win/.test(n):/win/.test(t),i=n?/mac/.test(n):/mac/.test(t),r=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,s=!1,a=[0,0,0],c=null;if(typeof U.plugins!=I&&typeof U.plugins[N]==O)c=U.plugins[N].description,!c||typeof U.mimeTypes!=I&&U.mimeTypes[x]&&!U.mimeTypes[x].enabledPlugin||(M=!0,s=!1,c=c.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),a[0]=parseInt(c.replace(/^(.*)\..*$/,"$1"),10),a[1]=parseInt(c.replace(/^.*\.(.*)\s.*$/,"$1"),10),a[2]=/[a-zA-Z]/.test(c)?parseInt(c.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof L[["Active"].concat("Object").join("X")]!=I)try{var l=new(window[["Active"].concat("Object").join("X")])(P);l&&(c=l.GetVariable("$version"),c&&(s=!0,c=c.split(" ")[1].split(","),a=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]))}catch(u){}return{w3:e,pv:a,wk:r,ie:s,win:o,mac:i}}();return function(){$.w3&&((typeof F.readyState!=I&&"complete"==F.readyState||typeof F.readyState==I&&(F.getElementsByTagName("body")[0]||F.body))&&e(),B||(typeof F.addEventListener!=I&&F.addEventListener("DOMContentLoaded",e,!1),$.ie&&$.win&&(F.attachEvent(k,function(){"complete"==F.readyState&&(F.detachEvent(k,arguments.callee),e())}),L==top&&function(){if(!B){try{F.documentElement.doScroll("left")}catch(t){return setTimeout(arguments.callee,0),void 0}e()}}()),$.wk&&function(){return B?void 0:/loaded|complete/.test(F.readyState)?(e(),void 0):(setTimeout(arguments.callee,0),void 0)}(),n(e)))}(),function(){$.ie&&$.win&&window.attachEvent("onunload",function(){for(var e=G.length,t=0;e>t;t++)G[t][0].detachEvent(G[t][1],G[t][2]);for(var n=q.length,o=0;n>o;o++)d(q[o]);for(var i in $)$[i]=null;$=null;for(var r in swfobject)swfobject[r]=null;swfobject=null})}(),{registerObject:function(e,t,n,o){if($.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=o,H[H.length]=i,S(e,!1)}else o&&o({success:!1,id:e})},getObjectById:function(e){return $.w3?s(e):void 0},embedSWF:function(e,n,o,i,r,s,l,u,p,d){var f={success:!1,id:n};$.w3&&!($.wk&&312>$.wk)&&e&&n&&o&&i&&r?(S(n,!1),t(function(){o+="",i+="";var t={};if(p&&typeof p===O)for(var g in p)t[g]=p[g];t.data=e,t.width=o,t.height=i;var m={};if(u&&typeof u===O)for(var v in u)m[v]=u[v];if(l&&typeof l===O)for(var _ in l)typeof m.flashvars!=I?m.flashvars+="&"+_+"="+l[_]:m.flashvars=_+"="+l[_];if(y(r)){var E=h(t,m,n);t.id==n&&S(n,!0),f.success=!0,f.ref=E}else{if(s&&a())return t.data=s,c(t,m,n,d),void 0;S(n,!0)}d&&d(f)})):d&&d(f)},switchOffAutoHideShow:function(){J=!1},ua:$,getFlashPlayerVersion:function(){return{major:$.pv[0],minor:$.pv[1],release:$.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(e,t,n){return $.w3?h(e,t,n):void 0},showExpressInstall:function(e,t,n,o){$.w3&&a()&&c(e,t,n,o)},removeSWF:function(e){$.w3&&d(e)},createCSS:function(e,t,n,o){$.w3&&_(e,t,n,o)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t=F.location.search||F.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return E(t);for(var n=t.split("&"),o=0;n.length>o;o++)if(n[o].substring(0,n[o].indexOf("="))==e)return E(n[o].substring(n[o].indexOf("=")+1))}return""},expressInstallCallback:function(){if(W){var e=g(D);e&&T&&(e.parentNode.replaceChild(T,e),b&&(S(b,!0),$.ie&&$.win&&(T.style.display="block")),C&&C(R)),W=!1}}}}();(function(){if("undefined"!=typeof window&&!window.WebSocket){var e=window.console;if(e&&e.log&&e.error||(e={log:function(){},error:function(){}}),!swfobject.hasFlashPlayerVersion("10.0.0"))return e.error("Flash Player >= 10.0.0 is required."),void 0;"file:"==location.protocol&&e.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(e,t,n,o,i){var r=this;r.__id=WebSocket.__nextId++,WebSocket.__instances[r.__id]=r,r.readyState=WebSocket.CONNECTING,r.bufferedAmount=0,r.__events={},t?"string"==typeof t&&(t=[t]):t=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(r.__id,e,t,n||null,o||0,i||null)})},0)},WebSocket.prototype.send=function(e){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var t=WebSocket.__flash.send(this.__id,encodeURIComponent(e));return 0>t?!0:(this.bufferedAmount+=t,!1)},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(e,t){e in this.__events||(this.__events[e]=[]),this.__events[e].push(t)},WebSocket.prototype.removeEventListener=function(e,t){if(e in this.__events)for(var n=this.__events[e],o=n.length-1;o>=0;--o)if(n[o]===t){n.splice(o,1);break}},WebSocket.prototype.dispatchEvent=function(e){for(var t=this.__events[e.type]||[],n=0;t.length>n;++n)t[n](e);var o=this["on"+e.type];o&&o(e)},WebSocket.prototype.__handleEvent=function(e){"readyState"in e&&(this.readyState=e.readyState),"protocol"in e&&(this.protocol=e.protocol);var t;if("open"==e.type||"error"==e.type)t=this.__createSimpleEvent(e.type);else if("close"==e.type)t=this.__createSimpleEvent("close");else{if("message"!=e.type)throw"unknown event type: "+e.type;var n=decodeURIComponent(e.message);t=this.__createMessageEvent("message",n)}this.dispatchEvent(t)},WebSocket.prototype.__createSimpleEvent=function(e){if(document.createEvent&&window.Event){var t=document.createEvent("Event");return t.initEvent(e,!1,!1),t}return{type:e,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera){var n=document.createEvent("MessageEvent");return n.initMessageEvent("message",!1,!1,t,null,null,window,null),n}return{type:e,data:t,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(e){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(e)})},WebSocket.__initialize=function(){if(!WebSocket.__flash){if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),!window.WEB_SOCKET_SWF_LOCATION)return e.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf"),void 0;var t=document.createElement("div");t.id="webSocketContainer",t.style.position="absolute",WebSocket.__isFlashLite()?(t.style.left="0px",t.style.top="0px"):(t.style.left="-100px",t.style.top="-100px");var n=document.createElement("div");n.id="webSocketFlash",t.appendChild(n),document.body.appendChild(t),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(t){t.success||e.error("[WebSocket] swfobject.embedSWF failed")})}},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var e=0;WebSocket.__tasks.length>e;++e)WebSocket.__tasks[e]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var t=WebSocket.__flash.receiveEvents(),n=0;t.length>n;++n)WebSocket.__instances[t[n].webSocketId].__handleEvent(t[n])}catch(o){e.error(o)}},0),!0},WebSocket.__log=function(t){e.log(decodeURIComponent(t))},WebSocket.__error=function(t){e.error(decodeURIComponent(t))},WebSocket.__addTask=function(e){WebSocket.__flash?e():WebSocket.__tasks.push(e)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var e=window.navigator.mimeTypes["application/x-shockwave-flash"];return e&&e.enabledPlugin&&e.enabledPlugin.filename?e.enabledPlugin.filename.match(/flashlite/i)?!0:!1:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))}})(),function(e,t,n){function o(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}e.XHR=o,t.util.inherit(o,t.Transport),o.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},o.prototype.payload=function(e){for(var n=[],o=0,i=e.length;i>o;o++)n.push(t.parser.encodePacket(e[o]));this.send(t.parser.encodePayload(n))},o.prototype.send=function(e){return this.post(e),this},o.prototype.post=function(e){function t(){4==this.readyState&&(this.onreadystatechange=i,r.posting=!1,200==this.status?r.socket.setBuffer(!1):r.onClose())}function o(){this.onload=i,r.socket.setBuffer(!1)}var r=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=o:this.sendXHR.onreadystatechange=t,this.sendXHR.send(e)},o.prototype.close=function(){return this.onClose(),this},o.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),o=t.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(e||"GET",this.prepareUrl()+o,!0),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(i){}return n},o.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},o.check=function(e,o){try{var i=t.util.request(o),r=n.XDomainRequest&&i instanceof XDomainRequest,s=e&&e.options&&e.options.secure?"https:":"http:",a=n.location&&s!=n.location.protocol;if(i&&(!r||!a))return!0}catch(c){}return!1},o.xdomainCheck=function(e){return o.check(e,!0)}}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,this),function(e,t){function n(){t.Transport.XHR.apply(this,arguments)}e.htmlfile=n,t.util.inherit(n,t.Transport.XHR),n.prototype.name="htmlfile",n.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var e=this.doc.createElement("div");e.className="socketio",this.doc.body.appendChild(e),this.iframe=this.doc.createElement("iframe"),e.appendChild(this.iframe);var n=this,o=t.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+o,t.util.on(window,"unload",function(){n.destroy()})},n.prototype._=function(e,t){this.onData(e);try{var n=t.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(o){}},n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},n.prototype.close=function(){return this.destroy(),t.Transport.XHR.prototype.close.call(this)},n.check=function(e){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{var n=new(window[["Active"].concat("Object").join("X")])("htmlfile");return n&&t.Transport.XHR.check(e)}catch(o){}return!1},n.xdomainCheck=function(){return!1},t.transports.push("htmlfile")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports),function(e,t,n){function o(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=o,t.util.inherit(o,t.Transport.XHR),t.util.merge(o,t.Transport.XHR),o.prototype.name="xhr-polling",o.prototype.heartbeats=function(){return!1},o.prototype.open=function(){var e=this;return t.Transport.XHR.prototype.open.call(e),!1},o.prototype.get=function(){function e(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(r.onData(this.responseText),r.get()):r.onClose())}function t(){this.onload=i,this.onerror=i,r.retryCounter=1,r.onData(this.responseText),r.get()}function o(){r.retryCounter++,!r.retryCounter||r.retryCounter>3?r.onClose():r.get()}if(this.isOpen){var r=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=t,this.xhr.onerror=o):this.xhr.onreadystatechange=e,this.xhr.send(null)}},o.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},o.prototype.ready=function(e,n){var o=this;t.util.defer(function(){n.call(o)})},t.transports.push("xhr-polling")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,this),function(e,t,n){function o(){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var e=this;t.j.push(function(t){e._(t)})}var i=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=o,t.util.inherit(o,t.Transport["xhr-polling"]),o.prototype.name="jsonp-polling",o.prototype.post=function(e){function n(){o(),i.socket.setBuffer(!1)}function o(){i.iframe&&i.form.removeChild(i.iframe);try{s=document.createElement('<iframe name="'+i.iframeId+'">')}catch(e){s=document.createElement("iframe"),s.name=i.iframeId}s.id=i.iframeId,i.form.appendChild(s),i.iframe=s}var i=this,r=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var s,a=document.createElement("form"),c=document.createElement("textarea"),l=this.iframeId="socketio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="0px",a.style.left="0px",a.style.display="none",a.target=l,a.method="POST",a.setAttribute("accept-charset","utf-8"),c.name="d",a.appendChild(c),document.body.appendChild(a),this.form=a,this.area=c}this.form.action=this.prepareUrl()+r,o(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(u){}this.iframe.attachEvent?s.onreadystatechange=function(){"complete"==i.iframe.readyState&&n()}:this.iframe.onload=n,this.socket.setBuffer(!0)},o.prototype.get=function(){var e=this,n=document.createElement("script"),o=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+o,n.onerror=function(){e.onClose()};var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(n,r),this.script=n,i&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},o.prototype._=function(e){return this.onData(e),this.isOpen&&this.get(),this},o.prototype.ready=function(e,n){var o=this;return i?(t.util.load(function(){n.call(o)}),void 0):n.call(this)},o.check=function(){return"document"in n},o.xdomainCheck=function(){return!0},t.transports.push("jsonp-polling")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define([],function(){return io})})(),function(){function e(){this.callbacks={}}function t(t){var n=this,o=t||{},i=this.config={version:"a1",token:"",user:r.uuid(),jid:"",log:!0,ringTone:"",ringbackTone:""},s={onReady:"ready",onUnReady:"unready",onIncomingCall:"incomingCall",onError:"error",onCallBegin:"callBegin",onCallEnd:"callEnd"};r.extend(this.config,o),"a1"===this.config.version?this.config.url="https://api.foundry.att.com/a1/webrtc":"a2"===this.config.version?this.config.url="https://api.foundry.att.com/a2/webrtc":this.config.phono=!0,i.token&&this.login(i.token),e.call(this),r.each(s,function(e,t){r.isFunc(n.config[e])&&n.on(t,n.config[e])}),this.config.log&&this.on("*",function(e,t){console.log("event:",e,t)})}function n(t){var n=this,o=t||{},i=this.config={url:"https://webrtc.spectrum.io:443",token:""};for(var r in i)o.hasOwnProperty(r)&&(i[r]=o[r]);this.debug=!0,this.chats={};var s=this.socket=new io.connect(this.config.url);s.on("connect",function(e){n.emit("connect",e)}),s.on("ready",function(e){n.profile=e,n.emit("ready",e)
});for(var a=["joinedRoom","leftRoom","offline","online","message","directChat","newTopic"],c=0,l=a.length;l>c;c++)this.socket.on(a[c],function(e){return function(t){n.emit(e,t)}}(a[c]));i.token&&this.login(i.token),e.call(this),this.debug&&this.on("*",function(e,t){console.log("e:",e,t)})}var o=this,i={},r=i.util={_uuidCounter:0,uuid:function(){return Math.random().toString(16).substring(2)+(r._uuidCounter++).toString(16)},slice:Array.prototype.slice,isFunc:function(e){return"[object Function]"==Object.prototype.toString.call(e)},extend:function(e){return this.slice.call(arguments,1).forEach(function(t){if(t)for(var n in t)e[n]=t[n]}),e},each:function(e,t){if(e)if(e instanceof Array)e.forEach(t);else for(var n in e)t(n,e[n])}},s={};s.stringify=function(e){var t,n=s.parse(e),o=n.length,i="1"===n.charAt(0),r=n.split("");return o>(i?11:10)?n:!i&&4>o?n:(i&&r.splice(0,1),i?o>1&&(t=4-o,t=t>0?t:0,r.splice(0,0," ("),r.splice(4,0,Array(t+1).join(" ")+") "),o>7&&r.splice(8,0,"-")):o>7?(r.splice(0,0,"("),r.splice(4,0,") "),r.splice(8,0,"-")):o>3&&r.splice(3,0,"-"),(i?"1":"")+r.join(""))},s.parse=function(e){return(e+"").toUpperCase().replace(/[A-Z]/g,function(e){return 0|(e.charCodeAt(0)-65)/3+2-("SVYZ".indexOf(e)>-1)}).replace(/\D/g,"")},s.getCallable=function(e,t){var n=t||"us",o=s.parse(e);return 10!==o.length?"us"==n&&11===o.length&&"1"===o.charAt(0)?o:!1:"us"==n?"1"+o:void 0},i.phoneNumber=s,e.prototype.on=function(e){var t=3===arguments.length,n=t?arguments[1]:void 0,o=t?arguments[2]:arguments[1];return o._groupName=n,(this.callbacks[e]=this.callbacks[e]||[]).push(o),this},e.prototype.once=function(e,t){function n(){o.off(e,n),t.apply(this,arguments)}var o=this;return this.on(e,n),this},e.prototype.releaseGroup=function(e){var t,n,o,i;for(t in this.callbacks)for(i=this.callbacks[t],n=0,o=i.length;o>n;n++)i[n]._groupName===e&&(i.splice(n,1),n--,o--);return this},e.prototype.off=function(e,t){var n,o=this.callbacks[e];return o?1===arguments.length?(delete this.callbacks[e],this):(n=o.indexOf(t),o.splice(n,1),this):this},e.prototype.emit=function(e){var t,n,o=[].slice.call(arguments,1),i=this.callbacks[e],r=this.getWildcardCallbacks(e);if(i)for(t=0,n=i.length;n>t;++t)i[t].apply(this,o);if(r)for(t=0,n=r.length;n>t;++t)r[t].apply(this,[e].concat(o));return this},e.prototype.getWildcardCallbacks=function(e){var t,n,o=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[1].length)===n[1])&&(o=o.concat(this.callbacks[t]));return o},t.prototype=new e,t.prototype.login=function(e){var t=this,n=this.config,o=this.config.token=e;n.phono?(console.log("setting up phono"),this.phono=$.phono({apiKey:"7826110523f1241fcfd001859a67128d",gateway:"gw.phono.com",connectionUrl:"http://bosh.spectrum.tfoundry.com:8080/http-bind",audio:{type:"webrtc"},onReady:function(){t.emit("ready",t)},onUnready:function(){t.emit("unready",t)},phone:{ringTone:n.ringTone,ringbackTone:n.ringbackTone,onIncomingCall:function(e){t.emit("incomingCall",e)}},onError:function(e){t.emit("error",e)}})):(this.ms=new MediaServices(this.config.url,this.config.user,"oauth "+o||this.config.token,"audio,video"),this.ms.oninvite=function(e){t._normalizeH2SCallHandlers(e.call),t.emit("incomingCall",e.call),window.call=e.call},this.ms.onready=function(){t.emit("ready",t)})},t.prototype.dial=function(e){var t=i.phoneNumber.getCallable(e);if(this.phono)return n=this.phono.phone.dial(t);var n=this.ms.createCall("sip:"+t+"@vims1.com",{audio:!0,video:!1});return this._normalizeH2SCallHandlers(n),n.ring(),n},t.prototype._normalizeH2SCallHandlers=function(t){var n=this;e.call(t),r.extend(t,e.prototype),t.onbegin=function(){n.emit("callBegin",t),t.emit("callBegin",t)},t.onend=function(){n.emit("callEnd",t),t.emit("callEnd",t)},t.onaddstream=function(){n.emit("addStream",t),t.emit("addStream",t)}},i.Phone=t,o.jQuery&&(o.jQuery.phone=function(e){return new t(e)}),n.prototype=new e,n.prototype.login=function(e,t){console.log("login called",e),this.socket.emit("login",e,t)},n.prototype.sendMessage=function(e,t){this.socket.emit("sendMessage",{room:e,body:t})},n.prototype.sendDirectChat=function(e,t){this.socket.emit("sendDirectChat",{to:e,message:t})},n.prototype.addUserToRoom=function(e,t){this.socket.emit("addUserToRoom",{room:e,user:t})},n.prototype.leave=function(e){this.socket.emit("leaveRoom",e)},n.prototype.createGroupChat=function(e,t){this.socket.emit("createRoom",e,t)},n.prototype.setRoomTopic=function(e,t,n){this.socket.emit("setRoomTopic",{id:e,topic:t},n)},i.ChatSession=n,"undefined"!=typeof exports?module.exports=i:(o.att||(o.att={}),r.extend(o.att,i))}.call(this);